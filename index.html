<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <title>Navigational-Tracking Mitigations</title>
  <meta content="width=device-width" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 5edf5e459, updated Thu Jun 22 11:28:01 2023 -0700" name="generator">
  <link href="https://privacycg.github.io/nav-tracking-mitigations/" rel="canonical">
  <meta content="20eb245c270466e335709015b48da5251ae6e1ec" name="document-revision">
<style>
#example-link-decoration-tracking code em {background-color: cyan}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
var { cursor: pointer; }
var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body>
  <header>
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="no-ref" id="title">Navigational-Tracking Mitigations</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time datetime="2023-06-22">22 June 2023</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Participate:
     <dd><a href="https://github.com/privacycg/nav-tracking-mitigations">Github Repository</a>
     <dd><a href="https://github.com/privacycg/meetings/">Privacy CG Meetings</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/privacycg/nav-tracking-mitigations/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="109401"><a class="p-name fn u-email email" href="mailto:psnyder@brave.com">Pete Snyder</a> (<a class="p-org org" href="https://brave.com/">Brave</a>)
     <dd class="editor p-author h-card vcard" data-editor-id="72192"><a class="p-name fn u-email email" href="mailto:jyasskin@google.com">Jeffrey Yasskin</a> (<a class="p-org org" href="https://google.com/">Google</a>)
     <dt>This version:
     <dd><a class="u-url" href="https://privacycg.github.io/nav-tracking-mitigations/">https://privacycg.github.io/nav-tracking-mitigations/</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 the Contributors to “Navigational-Tracking Mitigations”, published by the <a href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.

This document is licensed under the <a href="http://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">W3C Software and Document License</a>.

Contributions to this document are made under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. </p>
   <hr title="Separator for header">
  </header>
  <div data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines navigational tracking and when and how browsers are required to prevent it from happening.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>This specification is intended to be migrated to the W3C standards track. It is not a W3C standard.</p>
   <p>It was published by the <a href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.
Please note that under the <a href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.
Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#infra"><span class="secno">2</span> <span class="content">Infrastructure</span></a>
    <li><a href="#terminology"><span class="secno">3</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#threat-model"><span class="secno">4</span> <span class="content">Threat model</span></a>
     <ol class="toc">
      <li><a href="#threat-actors"><span class="secno">4.1</span> <span class="content">Threat actors</span></a>
     </ol>
    <li>
     <a href="#alternatives"><span class="secno">5</span> <span class="content">Considered Alternatives</span></a>
     <ol class="toc">
      <li>
       <a href="#deployed-mitigations"><span class="secno">5.1</span> <span class="content">Deployed Mitigations</span></a>
       <ol class="toc">
        <li><a href="#mitigations-safari"><span class="secno">5.1.1</span> <span class="content">Safari</span></a>
        <li><a href="#mitigations-firefox"><span class="secno">5.1.2</span> <span class="content">Firefox</span></a>
        <li><a href="#mitigations-brave"><span class="secno">5.1.3</span> <span class="content">Brave</span></a>
       </ol>
     </ol>
    <li>
     <a href="#bounce-tracking-mitigations"><span class="secno">6</span> <span class="content">Bounce Tracking Mitigations</span></a>
     <ol class="toc">
      <li>
       <a href="#bounce-tracking-mitigations-data-model"><span class="secno">6.1</span> <span class="content">Data Model</span></a>
       <ol class="toc">
        <li><a href="#bounce-tracking-mitigations-data-model-global"><span class="secno">6.1.1</span> <span class="content">Global Data</span></a>
        <li><a href="#bounce-tracking-mitigations-data-model-per-tab"><span class="secno">6.1.2</span> <span class="content">Per-Tab Data</span></a>
        <li><a href="#bounce-tracking-mitigations-data-model-constants"><span class="secno">6.1.3</span> <span class="content">Constants</span></a>
       </ol>
      <li>
       <a href="#bounce-tracking-mitigations-algorithms"><span class="secno">6.2</span> <span class="content">Algorithms</span></a>
       <ol class="toc">
        <li><a href="#bounce-tracking-mitigations-activation-monkey-patch"><span class="secno">6.2.1</span> <span class="content">User Activation
Monkey Patch</span></a>
        <li><a href="#bounce-tracking-mitigations-web-authentication-monkey-patch"><span class="secno">6.2.2</span> <span class="content">Web Authentication Monkey Patch</span></a>
        <li>
         <a href="#bounce-tracking-mitigation-stateful-bounce-detection"><span class="secno">6.2.3</span> <span class="content">Stateful Bounce
Detection</span></a>
         <ol class="toc">
          <li><a href="#bounce-tracking-mitigations-nav-start-monkey-patch"><span class="secno">6.2.3.1</span> <span class="content">Start Navigation
Monkey Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-network-cookie-write-monkey-patch"><span class="secno">6.2.3.2</span> <span class="content">Network
Cookie Write Monkey Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-service-worker-activation-monkey-patch"><span class="secno">6.2.3.3</span> <span class="content">Service Worker Activation Monkey Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-storage-access-monkey-patch"><span class="secno">6.2.3.4</span> <span class="content">Storage Access Monkey Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-response-received-monkey-patch"><span class="secno">6.2.3.5</span> <span class="content">Response Received Monkey
Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-document-load-monkey-patch"><span class="secno">6.2.3.6</span> <span class="content">Document Loaded Monkey
Patch</span></a>
         </ol>
        <li><a href="#bounce-tracking-mitigations-timers"><span class="secno">6.2.4</span> <span class="content">Timers</span></a>
        <li><a href="#bounce-tracking-mitigations-deletion"><span class="secno">6.2.5</span> <span class="content">Deletion</span></a>
       </ol>
     </ol>
    <li><a href="#privacy-and-security-considerations"><span class="secno">7</span> <span class="content">Privacy and Security Considerations</span></a>
    <li><a href="#acknowledgements"><span class="secno"></span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section class="non-normative">
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>Browsers are working to prevent cross-site <a data-link-type="dfn" href="https://www.w3.org/TR/tracking-dnt/#dfn-tracking" id="ref-for-dfn-tracking">tracking</a>, which threatens user
privacy. In addition to third-party cookies and storage, other client-side
methods exist that enable cross-site tracking. <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking">Navigational tracking</a> correlates user identities across sites during navigations between those sites. <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①">Navigational tracking</a> uses <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration">link decoration</a> to convey information, but
not all <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration①">link decoration</a> is tracking. This project attempts to distinguish
tracking from non-tracking navigation and to prevent the tracking without
damaging similar but benign navigations.</p>
   </section>
   <h2 class="heading settled" data-level="2" id="infra"><span class="secno">2. </span><span class="content">Infrastructure</span><a class="self-link" href="#infra"></a></h2>
   <p>This specification depends on the Infra standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
   <h2 class="heading settled" data-level="3" id="terminology"><span class="secno">3. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="link-decoration">Link decoration</dfn> is when the source of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#hyperlink" id="ref-for-hyperlink">hyperlink</a> "decorates" its <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a> with extra information beyond what’s necessary to identify the page a user wants
to navigate to. This information can be placed almost anywhere inside the URL.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="navigational-tracking">Navigational tracking</dfn> refers to the general use of one or more <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigating-across-documents">navigations</a> to identify that a user on one
site is the same person as a user on another site. Navigations transmit information
cross-site in a few different ways, including in the target URL, which might be <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration②">decorated</a>, and in the timing of the request.</p>
   <div class="example" id="example-link-decoration-tracking">
    <a class="self-link" href="#example-link-decoration-tracking"></a> 
    <p>Examples and non-examples of <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration③">link decoration</a> and <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking②">navigational tracking</a>,
with the potential decoration or tracking element emphasized:</p>
    <dl>
     <dt data-md><code>https://publisher.example/page?userId=<em>5789rhkdsaf8urfnsd</em></code>
     <dd data-md>
      <p><a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration④">Link decoration</a>, and also <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking③">navigational tracking</a>.</p>
     <dt data-md><code>https://bookshop.org/a/<em>1122</em>/9780062252074</code>
     <dd data-md>
      <p><a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑤">Link decoration</a> but <strong>not</strong> <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking④">navigational tracking</a>: This number
identifies an affiliate to credit with a book sale. Replacing this with
another number gets to the same target page.</p>
     <dt data-md><code>https://bookshop.org/a/1122/<em>9780062252074</em></code>
     <dd data-md>
      <p><strong>Not</strong> decoration: This number identifies a particular book. Changing it
yields a different target page.</p>
     <dt data-md><code>https://bugzilla.mozilla.org/show_bug.cgi?id=<em>1460058</em></code>
     <dd data-md>
      <p><strong>Not</strong> decoration: changing the number changes which bug the user sees.</p>
     <dt data-md><code>https://www.google.com/maps/@<em>37.4220328,-122.0847584,17.12z</em></code>
     <dd data-md>
      <p class="issue" id="issue-9458c4e5"><a class="self-link" href="#issue-9458c4e5"></a> Changing the numbers changes what map the user sees, and embedding
a user ID would not successfully transfer that user ID to the target site,
but it’s hard for an automated system inside a browser to prove
that, and even hard for humans reading the URL to be confident of it. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/4">[Issue #4]</a></p>
     <dt data-md><code>https://publisher.example/unsubscribe?userId=<em>5789rhkdsaf8urfnsd</em></code>
     <dd data-md>
      <p class="issue" id="issue-fc2127e1"><a class="self-link" href="#issue-fc2127e1"></a> The URL identifies an action rather than a page, and the user ID
might be essential for that action to happen. However, this is also clearly
a user ID and sufficient to track a user if the source and target
collaborate. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a></p>
     <dt data-md><code>https://example.com/auth/callback?token=<em>1234567</em></code>
     <dd data-md>
      <p class="issue" id="issue-0c501704"><a class="self-link" href="#issue-0c501704"></a> This is probably the same case as the unsubscribe link. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a></p>
     <dt data-md><code>https://example.com/login?returnto=<em>item/12345</em></code>
     <dd data-md>
      <p>Assuming a request for this URL shows a login page instead of immediately
redirecting to <code>item/12345</code>, this is a <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑥">link decoration</a> but not <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑤">navigational tracking</a>.</p>
    </dl>
   </div>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking">Bounce tracking</dfn> refers to the use of redirects in a top-level context
(including <a data-link-type="dfn" href="https://httpwg.org/specs/rfc7231.html#status.3xx" id="ref-for-status.3xx">HTTP 3xx statuses</a>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta">meta</a></code> elements with <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv" id="ref-for-attr-meta-http-equiv">http-equiv</a></code>=<code><a data-link-type="attr-value" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh" id="ref-for-attr-meta-http-equiv-keyword-refresh">refresh</a></code> attributes, and script-directed
navigation that doesn’t wait for user input) along with <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑦">link decoration</a> to
join user identities between sites. <a data-link-type="dfn" href="#bounce-tracking" id="ref-for-bounce-tracking">Bounce tracking</a> is a subset of <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑥">navigational tracking</a> and can include automated navigation through the same
or different sites from the source or ultimate destination of a link.</p>
   <div class="example" id="example-bounce-tracking-to-self">
    <a class="self-link" href="#example-bounce-tracking-to-self"></a> 
    <p>Tracking via a bounce through an aggregation domain:</p>
    <ol>
     <li data-md>
      <p>The content publisher’s page (on <code>publisher.example</code>) embeds a third-party
script from <code>tracker.example</code>.</p>
     <li data-md>
      <p>The third-party script tries to read an already-stored identifier, for
example one it has set into <code>publisher.example</code>'s storage or one read from a
third-party <code>tracker.example</code> <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>.</p>
     <li data-md>
      <p>If it can’t, it redirects the top level page to <code>tracker.example</code> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location" id="ref-for-dom-location">window.location</a></code>.</p>
     <li data-md>
      <p>During this load <code>tracker.example</code> is the first party and can read and write
its cookie jar.</p>
     <li data-md>
      <p><code>tracker.example</code> redirects back to the original page URL, with that URL <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑧">decorated</a> with its user ID in a query parameter.</p>
     <li data-md>
      <p>The <code>tracker.example</code> user ID is now available on <code>publisher.example</code> and can
be saved into its first-party storage so that future visits don’t need to
bounce.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="4" id="threat-model"><span class="secno">4. </span><span class="content">Threat model</span><a class="self-link" href="#threat-model"></a></h2>
   <p>This section will precisely define the goals and non-goals of this
specification’s mitigations. It will define a few classes of actors with the
ability to modify websites in particular ways. Then it will define what
cross-site information each of these actors can or cannot learn.</p>
   <h3 class="heading settled" data-level="4.1" id="threat-actors"><span class="secno">4.1. </span><span class="content">Threat actors</span><a class="self-link" href="#threat-actors"></a></h3>
   <p>TODO</p>
   <section class="informative">
    <h2 class="heading settled" data-level="5" id="alternatives"><span class="secno">5. </span><span class="content">Considered Alternatives</span><a class="self-link" href="#alternatives"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>So far, the alternative designs consist of mitigations that various browsers
have already deployed.</p>
    <h3 class="heading settled" data-level="5.1" id="deployed-mitigations"><span class="secno">5.1. </span><span class="content">Deployed Mitigations</span><a class="self-link" href="#deployed-mitigations"></a></h3>
    <p>Some browsers have deployed and announced protections against <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑦">navigational tracking</a>. This section is a work in progress to detail what
protections have been shipped and / or are planned. This section is not
comprehensive.</p>
    <h4 class="heading settled" data-level="5.1.1" id="mitigations-safari"><span class="secno">5.1.1. </span><span class="content">Safari</span><a class="self-link" href="#mitigations-safari"></a></h4>
    <p>Safari uses an algorithmic approach to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑧">navigational tracking</a>. Safari
classifies a site as having cross-site tracking capabilities if the <a href="https://webkit.org/tracking-prevention/#classification-as-having-cross-site-tracking-capabilities">following
criteria</a> are met within a particular client:</p>
    <ul>
     <li data-md>
      <p>The site appears as a third-party resource under enough different <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain">registrable domains</a>.</p>
     <li data-md>
      <p>The site automatically redirects the user to enough other sites, immediately
or after a short delay.</p>
     <li data-md>
      <p>The site redirects to sites that are classified as trackers, recursively.</p>
      <div class="example" id="example-safari-recursive-trackers">
       <a class="self-link" href="#example-safari-recursive-trackers"></a> 
       <p>For example, consider the case of a user clicking on a link on <code>start.example</code>, which redirects to <code>second.example</code>, which redirects to <code>third.example</code>, which redirects to <code>end.example</code>. If Safari has classified <code>third.example</code> as having tracking capabilities, the above behavior can
result in Safari classifying <code>second.example</code> as having cross-site tracking
capabilities.</p>
      </div>
    </ul>
    <p>If a user navigates or is redirected from a classified tracker with a URL that
includes either query parameters or a URL fragment, the lifetime of client-side
set cookies on the <em>destination</em> page is capped at <a href="https://webkit.org/tracking-prevention/#detection-of-cross-site-tracking-via-link-decoration">24
hours</a>.</p>
    <h4 class="heading settled" data-level="5.1.2" id="mitigations-firefox"><span class="secno">5.1.2. </span><span class="content">Firefox</span><a class="self-link" href="#mitigations-firefox"></a></h4>
    <p>Firefox uses a list-based approach to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑨">navigational tracking</a>. Sites on the
Disconnect list are considered tracking sites. All storage
for tracking sites is cleared after 24 hours, unless the user has interacted
with the site in the first-party context in the last 45 days.</p>
    <p>Firefox is also starting to remove query parameters known to be used for
cross-site tracking. (<a data-link-type="biblio" href="#biblio-fsn-2021-q4" title="Firefox Security Newsletter 2021 Q4">[FSN-2021-Q4]</a>) The affected query parameters are chosen
using the criteria on the <a data-biblio-display="inline" data-link-type="biblio" href="https://wiki.mozilla.org/Security/Anti_tracking_policy"><cite>Mozilla Anti Tracking Policy</cite></a>, which includes:</p>
    <ul>
     <li data-md>
      <p>High-entropy parameters that might identify a user or encode user data,
except:</p>
      <ul>
       <li data-md>
        <p>Parameters exclusively identifying specific elements or actions on the
navigating page (per-click or per-element identifiers), as long as those
parameters assign a different value to each click or element they are
identifying.</p>
       <li data-md>
        <p>Identifiers necessary to complete a user-initiated task such as logging in
or submitting a form.</p>
      </ul>
     <li data-md>
      <p>High-entropy parameters that are broadly included in nearly all outgoing
navigations from a site, even if the parameters don’t uniquely identify a
user.</p>
    </ul>
    <p>As of May 2022, this query-parameter stripping is applied by default in the
Firefox Nightly build, and planned to be enabled in strict <abbr title="Enhanced Tracking Protection">ETP</abbr> mode and in private browsing.</p>
    <h4 class="heading settled" data-level="5.1.3" id="mitigations-brave"><span class="secno">5.1.3. </span><span class="content">Brave</span><a class="self-link" href="#mitigations-brave"></a></h4>
     Brave uses four list-based approaches to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①⓪">navigational tracking</a>. 
    <p>First, Brave strips query parameters commonly used for <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①①">navigational tracking</a> from URLs on navigation. This list is maintained by Brave.</p>
    <p>Second, by default, when i) the user is about to visit a list-identified
bounce-tracking URL, and ii) the current profile does not contain any cookies
or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage" id="ref-for-dom-localstorage">localStorage</a></code> for that site, Brave will create a new, "ephemeral", empty storage
area for the site. This storage area persists as long as the user has
any top-level frames open for the site. As soon as the user has no
top-level frames for the labeled bounce-tracking site, the ephemeral storage
area is deleted.</p>
    <p>Third, in the non-default, "aggressive blocking" configuration, Brave uses
popular crowd-sourced filter lists (e.g., EasyList, EasyPrivacy, uBlock Origin)
to identify URLs that are used for bounce tracking, and will preempt the
navigation with an interstitial (similar to Google SafeBrowsing), giving
the user the option to continue the navigation or cancel it.</p>
    <p>Fourth, Brave uses a list-based approach for identifying bounce tracking
URLs where the destination URL is present in the URL of the intermediate
tracking URL. In such cases, Brave will skip the intermediate navigation
and request the destination URL instead. For example, if Brave
Browser observes the user about to navigate to the URL <code>https://tracker.example/bounce?dest=https://destination.example/</code>,
the browser might replace the navigation to <code>tracker.example/bounce</code>,
with a navigation to <code>https://destination.example/</code>. This list
is maintained by Brave, and is drawn from a mix of crowd-sourcing and
existing open-source projects.</p>
   </section>
   <h2 class="heading settled" data-level="6" id="bounce-tracking-mitigations"><span class="secno">6. </span><span class="content">Bounce Tracking Mitigations</span><a class="self-link" href="#bounce-tracking-mitigations"></a></h2>
   <p>The content of this section will provide a "monkey patch" specification for bounce tracking
mitigations.  There is a <a href="https://github.com/privacycg/nav-tracking-mitigations/blob/main/bounce-tracking-explainer.md">Chromium-oriented
explainer</a> for this work, but the text in this section is intended for adoption across all browsers. This
section is not complete yet, and as the algorithms are developed, they will be specified here and
presented for review.</p>
   <p>This spec is written for the case where the following features are enabled:</p>
   <ul>
    <li data-md>
     <p>All third-party cookies are blocked.</p>
    <li data-md>
     <p>All cookies written by embedded third-party sites are partitioned.</p>
    <li data-md>
     <p>All storage written by embedded third-party sites is partitioned.</p>
   </ul>
   <p class="note" role="note"> The following is a work-in-progress and does not yet reflect any consensus in
the PrivacyCG. </p>
   <h3 class="heading settled" data-level="6.1" id="bounce-tracking-mitigations-data-model"><span class="secno">6.1. </span><span class="content">Data Model</span><a class="self-link" href="#bounce-tracking-mitigations-data-model"></a></h3>
   <h4 class="heading settled" data-level="6.1.1" id="bounce-tracking-mitigations-data-model-global"><span class="secno">6.1.1. </span><span class="content">Global Data</span><a class="self-link" href="#bounce-tracking-mitigations-data-model-global"></a></h4>
   <p>The user agent holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="user-activation-map">user activation map</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host">hosts</a> to <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment">moments</a>.  The <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment①">moments</a> represent the most recent <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock">wall clock</a> time at which the user activated a top-level document on the
associated <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①">host</a>.</p>
   <p>The user agent holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateful-bounce-tracking-map">stateful bounce tracking map</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site②">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②">hosts</a> to <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment②">moments</a>.  The <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment③">moments</a> represent the
first <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock①">wall clock</a> time since the last execution of the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer">bounce tracking timer</a> at which a page on the given <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site③">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host③">host</a> performed
an action that could indicate stateful bounce tracking took place.  For example,
if <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer①">bounce tracking timer</a> ran at time X and bounces occurred at times X-1,
X+1, and X+2, then the map value would be X+1.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Schemeless site is used as the data structure key because by default cookies
are sent to both <code>http://</code> and <code>https://</code> pages on the same domain.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Hosts are eagerly removed from the <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map">stateful bounce tracking map</a> when
a user activation occurs.  This means that a given host can exist in either the <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map">user activation map</a> or <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map①">stateful bounce tracking map</a>, but not both at
the same time.  The maps will have non-overlapping sets of keys.</p>
   <h4 class="heading settled" data-level="6.1.2" id="bounce-tracking-mitigations-data-model-per-tab"><span class="secno">6.1.2. </span><span class="content">Per-Tab Data</span><a class="self-link" href="#bounce-tracking-mitigations-data-model-per-tab"></a></h4>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="extended-navigation">extended navigation</dfn> is a contiguous sequence of navigations within a single <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable">top-level traversable</a>,
joined by client-side redirects, which the user agent expects its user to perceive as a single operation.</p>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable①">top-level traversable</a> has an associated <dfn class="dfn-paneled" data-dfn-for="top-level traversable" data-dfn-type="dfn" data-noexport id="top-level-traversable-bounce-tracking-record">bounce tracking record</dfn> which is a <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record">bounce tracking record</a> or null. This stores the data relevant
to bounce tracking enforcement for every <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation">extended navigation</a>.
It is non-null during an <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation①">extended navigation</a> and returns to null when the UA stops waiting for further
client-side redirects that might extend the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation②">extended navigation</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-record">bounce tracking record</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> whose items are:</p>
   <dl>
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-initial-host">initial host</dfn>
    <dd>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site④">site</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host④">host</a>. The initiator site of the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation③">extended navigation</a>.
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-final-host">final host</dfn>
    <dd>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑤">site</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑤">host</a> or null. The destination of the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation④">extended navigation</a>. Updated after every document load.
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-bounce-set">bounce set</dfn>
    <dd>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑥">sites</a>' <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑥">hosts</a>. All server-side and client-side redirects hit during this <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑤">extended navigation</a>.
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-storage-access-set">storage access set</dfn>
    <dd>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑦">sites</a>' <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑦">hosts</a>. All sites which accessed storage during this <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑥">extended navigation</a>.
   </dl>
   <h4 class="heading settled" data-level="6.1.3" id="bounce-tracking-mitigations-data-model-constants"><span class="secno">6.1.3. </span><span class="content">Constants</span><a class="self-link" href="#bounce-tracking-mitigations-data-model-constants"></a></h4>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-grace-period">bounce tracking grace period</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration">duration</a> that represents the length of time after a possible bounce tracking
event during which the user agent will wait for an interaction before deleting a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑧">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑧">host</a>'s storage.</p>
   <p class="note" role="note"><span class="marker">Note:</span> 1 hour is a reasonable <a data-link-type="dfn" href="#bounce-tracking-grace-period" id="ref-for-bounce-tracking-grace-period">bounce tracking grace period</a> value.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-activation-lifetime">bounce tracking activation lifetime</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration①">duration</a> that represents how long user
activations will protect a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑨">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑨">host</a> from storage deletion.</p>
   <p class="note" role="note"><span class="marker">Note:</span> 45 days is a reasonable <a data-link-type="dfn" href="#bounce-tracking-activation-lifetime" id="ref-for-bounce-tracking-activation-lifetime">bounce tracking activation lifetime</a> value.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-timer-period">bounce tracking timer period</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined②">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration②">duration</a> that represents how often to run the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer②">bounce tracking timer</a> algorithm.</p>
   <p class="note" role="note"><span class="marker">Note:</span> 1 hour is a reasonable <a data-link-type="dfn" href="#bounce-tracking-timer-period" id="ref-for-bounce-tracking-timer-period">bounce tracking timer period</a> value.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="client-bounce-detection-timer-period">client bounce detection timer period</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined③">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration③">duration</a> that represents how long to wait for a client redirect after a navigation ends.
The purpose is to catch all automated page-triggered redirects, which should be appended to
the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑦">extended navigation</a>, with high probability.</p>
   <p class="note" role="note"><span class="marker">Note:</span> 10 seconds is a reasonable <a data-link-type="dfn" href="#client-bounce-detection-timer-period" id="ref-for-client-bounce-detection-timer-period">client bounce detection timer period</a> value.</p>
   <h3 class="heading settled" data-level="6.2" id="bounce-tracking-mitigations-algorithms"><span class="secno">6.2. </span><span class="content">Algorithms</span><a class="self-link" href="#bounce-tracking-mitigations-algorithms"></a></h3>
   <h4 class="heading settled" data-level="6.2.1" id="bounce-tracking-mitigations-activation-monkey-patch"><span class="secno">6.2.1. </span><span class="content">User Activation
Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-activation-monkey-patch"></a></h4>
   <div class="algorithm" data-algorithm="record a user activation">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="record-a-user-activation">record a user activation</dfn> given a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">Document</a> <var>document</var>, perform
the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable">node navigable</a>.</p>
     <li data-md>
      <p>If <var>navigable</var> is null, then abort these steps.</p>
     <li data-md>
      <p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable②">top-level traversable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document">active document</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>topDocument</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque">opaque origin</a> then abort these steps.</p>
     <li data-md>
      <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site">obtain a site</a> given <var>origin</var>.</p>
     <li data-md>
      <p>Let <var>host</var> be <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⓪">host</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove">Remove</a> <var>host</var> from the <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map②">stateful bounce tracking map</a>.</p>
     <li data-md>
      <p>Set <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map①">user activation map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time">current wall time</a>.</p>
    </ol>
   </div>
   <p>Append the following steps to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#activation-notification" id="ref-for-activation-notification">activation notification</a> steps in the <a href="https://html.spec.whatwg.org/multipage/interaction.html#user-activation-processing-model">user activation processing
model</a>:</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#record-a-user-activation" id="ref-for-record-a-user-activation">record a user activation</a> given <var>document</var>.</p>
   </ol>
   <h4 class="heading settled" data-level="6.2.2" id="bounce-tracking-mitigations-web-authentication-monkey-patch"><span class="secno">6.2.2. </span><span class="content">Web Authentication Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-web-authentication-monkey-patch"></a></h4>
   <p>A successful credential access, using the Web Authentication API, is also treated as a user activation for bounce-tracking purposes.</p>
   <p>Add the following argument to the <a href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot">Discover From External Source</a> algorithm:</p>
   <dl>
    <dt>browsingContext
    <dd>The caller’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment" id="ref-for-environment">environment’s</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context">target browsing context</a>
   </dl>
   <p>Insert the following steps in the <a href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot">Discover From External Source</a> algorithm
    in step 17, under "If any authenticator indicates success":</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-a-web-authentication-assertion-for-bounce-tracking-mitigations" id="ref-for-process-a-web-authentication-assertion-for-bounce-tracking-mitigations">process a Web Authentication assertion for bounce tracking mitigations</a> given <var>callerOrigin</var> and <var>browsingContext</var>.</p>
   </ol>
   <div class="algorithm" data-algorithm="process a Web Authentication assertion for bounce tracking mitigations">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-a-web-authentication-assertion-for-bounce-tracking-mitigations">process a Web Authentication assertion for bounce tracking mitigations</dfn> given
    a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context">browsing context</a> <var>browsingContext</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>browsingContext</var> is null, then abort these steps.</p>
     <li data-md>
      <p>Let <var>topDocument</var> be <var>browsingContext</var>’s active document.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>topDocument</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin①">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque①">opaque origin</a> then abort these steps.</p>
     <li data-md>
      <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site①">obtain a site</a> given <var>origin</var>.</p>
     <li data-md>
      <p>Let <var>host</var> be <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①①">host</a>.</p>
     <li data-md>
      <p>Set <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map②">user activation map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time①">current wall time</a>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.3" id="bounce-tracking-mitigation-stateful-bounce-detection"><span class="secno">6.2.3. </span><span class="content">Stateful Bounce
Detection</span><a class="self-link" href="#bounce-tracking-mitigation-stateful-bounce-detection"></a></h4>
   <h5 class="heading settled" data-level="6.2.3.1" id="bounce-tracking-mitigations-nav-start-monkey-patch"><span class="secno">6.2.3.1. </span><span class="content">Start Navigation
Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-nav-start-monkey-patch"></a></h5>
   <p>At the start of a navigation, either initialize a new <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record①">bounce tracking record</a>,
or append a client-side redirect to the current <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record②">bounce tracking record</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate">navigate</a> algorithm before step 8,
"<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate-fragid">Navigate to a fragment</a> given navigable, url, historyHandling, and navigationId."</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-navigation-start-for-bounce-tracking" id="ref-for-process-navigation-start-for-bounce-tracking">process navigation start for bounce tracking</a> given <var>navigable</var>, <var>sourceDocument</var>, and <var>sourceSnapshotParams</var>.</p>
   </ol>
   <div class="algorithm" data-algorithm="process navigation start for bounce tracking">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-navigation-start-for-bounce-tracking">process navigation start for bounce tracking</dfn> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#navigable" id="ref-for-navigable">navigable</a> <var>navigable</var>, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">Document</a> <var>sourceDocument</var>, and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params" id="ref-for-source-snapshot-params">source snapshot params</a> <var>sourceSnapshotParams</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>navigable</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable③">top-level traversable</a>, then abort these steps.</p>
     <li data-md>
      <p>Remove any queued global tasks to <a data-link-type="dfn" href="#record-stateful-bounces-for-bounce-tracking" id="ref-for-record-stateful-bounces-for-bounce-tracking">record stateful bounces for bounce tracking</a> from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source" id="ref-for-networking-task-source">networking task source</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>sourceDocument</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin②">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque②">opaque origin</a>, set <var>initialHost</var> to <a data-link-type="dfn" href="https://url.spec.whatwg.org/#empty-host" id="ref-for-empty-host">empty host</a>.</p>
     <li data-md>
      <p>Otherwise,</p>
      <ol>
       <li data-md>
        <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site②">obtain a site</a> given <var>origin</var>.</p>
       <li data-md>
        <p>Set <var>initialHost</var> to <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①②">host</a>.</p>
      </ol>
     <li data-md>
      <p>If <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record">bounce tracking record</a> is null:</p>
      <ol>
       <li data-md>
        <p>Set <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①">bounce tracking record</a> to a new <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record③">bounce tracking record</a> with <a data-link-type="dfn" href="#bounce-tracking-record-initial-host" id="ref-for-bounce-tracking-record-initial-host">initial host</a> set to <var>initialHost</var>.</p>
      </ol>
     <li data-md>
      <p>Otherwise,</p>
      <ol>
       <li data-md>
        <p>If <var>sourceSnapshotParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation" id="ref-for-source-snapshot-params-activation">has transient activation</a> is true:</p>
        <ol>
         <li data-md>
          <p>Run <a data-link-type="dfn" href="#record-stateful-bounces-for-bounce-tracking" id="ref-for-record-stateful-bounces-for-bounce-tracking①">record stateful bounces for bounce tracking</a> given <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document①">active document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a>.</p>
         <li data-md>
          <p>Set <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record②">bounce tracking record</a> to a new <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record④">bounce tracking record</a> with <a data-link-type="dfn" href="#bounce-tracking-record-initial-host" id="ref-for-bounce-tracking-record-initial-host①">initial host</a> set to <var>initialHost</var>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, add <var>initialHost</var> to <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record③">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-bounce-set" id="ref-for-bounce-tracking-record-bounce-set">bounce set</a>.</p>
      </ol>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.3.2" id="bounce-tracking-mitigations-network-cookie-write-monkey-patch"><span class="secno">6.2.3.2. </span><span class="content">Network
Cookie Write Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-network-cookie-write-monkey-patch"></a></h5>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable④">top-level traversable</a> maintains a record of which sites it has saved cookies for in the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑧">extended navigation</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-fetch" id="ref-for-concept-http-network-fetch">HTTP-network fetch</a> algorithm after step 15,
"... run the "set-cookie-string" parsing algorithm (see <a href="https://httpwg.org/specs/rfc6265.html#set-cookie">section 5.2</a> of <a data-link-type="biblio" href="#biblio-cookies" title="HTTP State Management Mechanism">[COOKIES]</a>) ...":</p>
   <ol>
    <li data-md>
     <p>If cookies were stored in the cookie store in the previous step, then
run <a data-link-type="dfn" href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations">process a fetch storage access for bounce tracking mitigations</a> given <var>request</var>.</p>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> If the <code>Set-Cookie</code> header includes any cookies that the user agent ignores, for example because it’s blocking third-party cookies,
    they’re not considered "stored in the cookie store" in this algorithm.</p>
   <div class="algorithm" data-algorithm="process a fetch storage access for bounce tracking mitigations">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-a-fetch-storage-access-for-bounce-tracking-mitigations">process a fetch storage access for bounce tracking mitigations</dfn> given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> <var>request</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>origin</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque③">opaque origin</a>, then abort these steps.</p>
     <li data-md>
      <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#subresource-request" id="ref-for-subresource-request">subresource request</a>, then:</p>
      <ol>
       <li data-md>
        <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a> is null, or <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context①">target browsing context</a> is null, then abort these steps.</p>
       <li data-md>
        <p>Let <var>topLevelTraversable</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client②">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context②">target browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable" id="ref-for-bc-traversable">top-level traversable</a>.</p>
      </ol>
     <li data-md>
      <p>Otherwise,</p>
      <ol>
       <li data-md>
        <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client">reserved client</a> is null, or <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client①">reserved client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context③">target browsing context</a> is null, then abort these steps.</p>
       <li data-md>
        <p>Let <var>topLevelTraversable</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client②">reserved client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context④">target browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable" id="ref-for-bc-traversable①">top-level traversable</a>.</p>
      </ol>
     <li data-md>
      <p>If <var>topLevelTraversable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record④">bounce tracking record</a> is null, abort these steps.</p>
     <li data-md>
      <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site③">obtain a site</a> given <var>origin</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①③">host</a> to <var>topLevelTraversable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑤">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set">storage access set</a>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> We currently don’t treat cookie reads as stateful, but this would be a
reasonable future change. We could run <a data-link-type="dfn" href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations①">process a fetch storage access for bounce tracking mitigations</a> in the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" id="ref-for-concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a> algorithm after step 8.21.1.2,
"... <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-append" id="ref-for-concept-node-append">append</a> (<code>Cookie</code>, cookies) to httpRequest’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list" id="ref-for-concept-header-list">header list</a>. ..."</p>
   <h5 class="heading settled" data-level="6.2.3.3" id="bounce-tracking-mitigations-service-worker-activation-monkey-patch"><span class="secno">6.2.3.3. </span><span class="content">Service Worker Activation Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-service-worker-activation-monkey-patch"></a></h5>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑤">top-level traversable</a> maintains a record of which sites have activated service workers in the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑨">extended navigation</a>.</p>
   <p>Insert the following steps in the <a href="https://w3c.github.io/ServiceWorker/#on-fetch-request-algorithm">Handle Fetch</a> algorithm after step 23,
"If the result of running the <a href="https://w3c.github.io/ServiceWorker/#run-service-worker">Run Service Worker</a> algorithm...":</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations②">process a fetch storage access for bounce tracking mitigations</a> given <var>request</var>.</p>
   </ol>
   <h5 class="heading settled" data-level="6.2.3.4" id="bounce-tracking-mitigations-storage-access-monkey-patch"><span class="secno">6.2.3.4. </span><span class="content">Storage Access Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-storage-access-monkey-patch"></a></h5>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑥">top-level traversable</a> maintains a record of which sites have accessed storage in the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation①⓪">extended navigation</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map" id="ref-for-obtain-a-storage-bottle-map">obtain a storage bottle map</a> algorithm before step 10, "Return <var>proxyMap</var>":</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-a-general-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-general-storage-access-for-bounce-tracking-mitigations">process a general storage access for bounce tracking mitigations</a> given <var>environment</var>.</p>
   </ol>
   <p class="issue" id="issue-6bd6f4f1"><a class="self-link" href="#issue-6bd6f4f1"></a> This patch has to be run whenever a site accesses non-cookie storage. <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map" id="ref-for-obtain-a-storage-bottle-map①">Obtain a storage bottle map</a> is the intended hook for this, but it does not currently have full coverage across specs that use storage.
So this patch is not comprehensive. <a href="https://github.com/whatwg/storage/issues/165">[Issue #whatwg/storage#165]</a></p>
   <p></p>
   <div class="algorithm" data-algorithm="process a general storage access for bounce tracking mitigations">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-a-general-storage-access-for-bounce-tracking-mitigations">process a general storage access for bounce tracking mitigations</dfn> given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment" id="ref-for-environment①">environment</a> <var>environment</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>environment</var> is not an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a>, then abort these steps.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> At time of writing, <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map" id="ref-for-obtain-a-storage-bottle-map②">obtain a storage bottle map</a> can only accept an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> <var>environment</var>,
but this will be refactored to support <a data-link-type="dfn" href="https://w3c.github.io/ServiceWorker/#dfn-service-worker" id="ref-for-dfn-service-worker">service workers</a> which attempt to access storage on every navigation, and thus is not considered
when updating the <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set①">storage access set</a>.</p>
    <ol>
     <li data-md>
      <p>Let <var>origin</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is null or an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque④">opaque origin</a>, then abort these steps.</p>
     <li data-md>
      <p>Let <var>browsingContext</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context⑤">target browsing context</a>.</p>
     <li data-md>
      <p>If <var>browsingContext</var> is null, then abort these steps.</p>
     <li data-md>
      <p>Let <var>topLevelTraversable</var> be <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable" id="ref-for-bc-traversable②">top-level traversable</a>.</p>
     <li data-md>
      <p>If <var>topLevelTraversable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑥">bounce tracking record</a> is null,
then abort these steps.</p>
     <li data-md>
      <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site④">obtain a site</a> given <var>origin</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①">Append</a> <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①④">host</a> to <var>topLevelTraversable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑦">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set②">storage access set</a>.</p>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.3.5" id="bounce-tracking-mitigations-response-received-monkey-patch"><span class="secno">6.2.3.5. </span><span class="content">Response Received Monkey
Patch</span><a class="self-link" href="#bounce-tracking-mitigations-response-received-monkey-patch"></a></h5>
   <p>When the response is received at the end of a navigation, fill the <a data-link-type="dfn" href="#bounce-tracking-record-bounce-set" id="ref-for-bounce-tracking-record-bounce-set①">bounce set</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching" id="ref-for-create-navigation-params-by-fetching">create navigation params by fetching</a> algorithm, after Step 19.7,
"Wait until either response is non-null...", which is the point that <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url-list" id="ref-for-concept-response-url-list">url list</a> becomes available.</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-response-received-for-bounce-tracking" id="ref-for-process-response-received-for-bounce-tracking">process response received for bounce tracking</a> given <var>navigable</var> and <var>response</var>’s <var>URL list</var>.</p>
   </ol>
   <div class="algorithm" data-algorithm="process response received for bounce tracking">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-response-received-for-bounce-tracking">process response received for bounce tracking</dfn> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#navigable" id="ref-for-navigable①">navigable</a> <var>navigable</var> and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URLs</a> <var>URLs</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>navigable</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑦">top-level traversable</a>, then abort these steps.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑧">bounce tracking record</a> is not null.</p>
     <li data-md>
      <p>Let <var>global</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document②">active document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout" id="ref-for-run-steps-after-a-timeout">Run steps after a timeout</a> given:</p>
      <dl>
       <dt><var>global</var>
       <dd><var>global</var>
       <dt><var>milliseconds</var>
       <dd><a data-link-type="dfn" href="#client-bounce-detection-timer-period" id="ref-for-client-bounce-detection-timer-period①">client bounce detection timer period</a>
       <dt><var>completionSteps</var>
       <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source" id="ref-for-networking-task-source①">networking task source</a> with <var>global</var> to <a data-link-type="dfn" href="#record-stateful-bounces-for-bounce-tracking" id="ref-for-record-stateful-bounces-for-bounce-tracking②">record stateful bounces for bounce tracking</a> given <var>global</var>
      </dl>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>URL</var> in <var>URLs</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site⑤">obtain a site</a> given <var>URL</var>.</p>
       <li data-md>
        <p>Let <var>host</var> be the <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑤">host</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-insert" id="ref-for-concept-node-insert">Insert</a> <var>host</var> to the <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑨">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-bounce-set" id="ref-for-bounce-tracking-record-bounce-set②">bounce set</a>.</p>
      </ol>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.3.6" id="bounce-tracking-mitigations-document-load-monkey-patch"><span class="secno">6.2.3.6. </span><span class="content">Document Loaded Monkey
Patch</span><a class="self-link" href="#bounce-tracking-mitigations-document-load-monkey-patch"></a></h5>
   <p>When the document is loaded at the end of a navigation, update the <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host">final host</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host①">final host</a> is updated later than <a data-link-type="dfn" href="#process-response-received-for-bounce-tracking" id="ref-for-process-response-received-for-bounce-tracking①">process response received for bounce tracking</a> to ensure that the <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host②">final host</a> is a valid user destination. This is the one that has to be
compared against when deciding to exempt a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑥">host</a> in the <a data-link-type="dfn" href="#record-stateful-bounces-for-bounce-tracking" id="ref-for-record-stateful-bounces-for-bounce-tracking③">record stateful bounces for bounce tracking</a> algorithm.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#loading-a-document" id="ref-for-loading-a-document">load a document</a> algorithm,
before Step 5, "Return null", which is the point that the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">document</a> is loaded.</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-document-load-for-bounce-tracking" id="ref-for-process-document-load-for-bounce-tracking">process document load for bounce tracking</a> given <var>navigable</var> and <var>response</var>’s <var>URL list</var>.</p>
   </ol>
   <div class="algorithm" data-algorithm="process document load for bounce tracking">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-document-load-for-bounce-tracking">process document load for bounce tracking</dfn> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#navigable" id="ref-for-navigable②">navigable</a> <var>navigable</var> and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URLs</a> <var>URLs</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>navigable</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑧">top-level traversable</a>, then abort these steps.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⓪">bounce tracking record</a> is not null.</p>
     <li data-md>
      <p>If <var>URLs</var> is empty, then abort these steps.</p>
     <li data-md>
      <p>Let <var>finalSite</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site⑥">obtain a site</a> given the last entry in <var>URLs</var>.</p>
     <li data-md>
      <p>Set the <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①①">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host③">final host</a> to the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑦">host</a> of <var>finalSite</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.4" id="bounce-tracking-mitigations-timers"><span class="secno">6.2.4. </span><span class="content">Timers</span><a class="self-link" href="#bounce-tracking-mitigations-timers"></a></h4>
   <p>Every <a data-link-type="dfn" href="#bounce-tracking-timer-period" id="ref-for-bounce-tracking-timer-period①">bounce tracking timer period</a> the user agent should run the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer③">bounce tracking timer</a> algorithm given the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock②">wall clock</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time" id="ref-for-wall-clock-unsafe-current-time">unsafe current time</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Running the deletion algorithm on a global timer has the effect of adding fuzz to the
    delay between stateful bounce and data deletion. This mitigates adversarial leaks of
    interaction and bounce times. (See "Privacy and Security Considerations", below.)</p>
   <div class="algorithm" data-algorithm="bounce tracking timer">
    <p>To run the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-timer">bounce tracking timer</dfn> algorithm given a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment④">moment</a> on the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock③">wall clock</a> <var>now</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>host</var> -> <var>activationTime</var> of <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map③">user activation map</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a> that <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map③">stateful bounce tracking map</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">contain</a> <var>host</var>.</p>
       <li data-md>
        <p>If <var>activationTime</var> + <a data-link-type="dfn" href="#bounce-tracking-activation-lifetime" id="ref-for-bounce-tracking-activation-lifetime①">bounce tracking activation lifetime</a> is before <var>now</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove①">remove</a> <var>host</var> from <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map④">user activation map</a>.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate①">For each</a> <var>host</var> -> <var>bounceTime</var> of <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map④">stateful bounce tracking map</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a> that <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map⑤">user activation map</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">contain</a> <var>host</var>.</p>
       <li data-md>
        <p>If <var>bounceTime</var> + <a data-link-type="dfn" href="#bounce-tracking-grace-period" id="ref-for-bounce-tracking-grace-period①">bounce tracking grace period</a> is after <var>now</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
       <li data-md>
        <p>If there is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑨">top-level traversable</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document③">active document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin③">origin</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site⑦">site</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑧">host</a> equals <var>host</var>,
then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove②">Remove</a> <var>host</var> from <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map⑤">stateful bounce tracking map</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#clear-cookies-for-host" id="ref-for-clear-cookies-for-host">Clear cookies for host</a> given <var>host</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#clear-non-cookie-storage-for-host" id="ref-for-clear-non-cookie-storage-for-host">Clear non-cookie storage for host</a> given <var>host</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#clear-cache-for-host" id="ref-for-clear-cache-for-host">Clear cache for host</a> given <var>host</var>.</p>
      </ol>
    </ol>
    <p class="issue" id="issue-c8879d93"><a class="self-link" href="#issue-c8879d93"></a>TODO: Consider if we should do anything when the clock is moved
    forward or backward.</p>
   </div>
   <p>This algorithm is called when detecting the end of an <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation①①">extended navigation</a>. This could happen
if a user-initiated navigation is detected in <a data-link-type="dfn" href="#process-navigation-start-for-bounce-tracking" id="ref-for-process-navigation-start-for-bounce-tracking①">process navigation start for bounce tracking</a>,
or if the client bounce detection timer expires after <a data-link-type="dfn" href="#process-response-received-for-bounce-tracking" id="ref-for-process-response-received-for-bounce-tracking②">process response received for bounce tracking</a> without observing a client redirect.</p>
   <div class="algorithm" data-algorithm="record stateful bounces for bounce tracking">
    <p>To run the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="record-stateful-bounces-for-bounce-tracking">record stateful bounces for bounce tracking</dfn> algorithm
given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object" id="ref-for-global-object">global object</a> <var>global</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>navigable</var> be <var>global</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window">associated document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable①">node navigable</a>.</p>
     <li data-md>
      <p>If <var>navigable</var> is null, abort these steps.
This ensures that the global has not been detached from the navigable.</p>
     <li data-md>
      <p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document④">active document</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert④">Assert</a>: <var>topDocument</var> is the same as <var>global</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window①">associated document</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑤">Assert</a>: <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①②">bounce tracking record</a> is not null.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>host</var> in <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①③">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-bounce-set" id="ref-for-bounce-tracking-record-bounce-set③">bounce set</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>host</var> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host-equals" id="ref-for-concept-host-equals">equals</a> <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①④">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-initial-host" id="ref-for-bounce-tracking-record-initial-host②">initial host</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
       <li data-md>
        <p>If <var>host</var> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host-equals" id="ref-for-concept-host-equals①">equals</a> <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⑤">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host④">final host</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">continue</a>.</p>
       <li data-md>
        <p>If <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map⑥">user activation map</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">contains</a> <var>host</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④">continue</a>.</p>
       <li data-md>
        <p>If <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map⑥">stateful bounce tracking map</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">contains</a> <var>host</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑤">continue</a>. (Only the first bounce time since the
last execution of the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer④">bounce tracking timer</a> is tracked in the map.)</p>
       <li data-md>
        <p>If <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⑥">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set③">storage access set</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contain</a> <var>host</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑥">continue</a>.</p>
       <li data-md>
        <p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document⑤">active document</a>.</p>
       <li data-md>
        <p>Set <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map⑦">stateful bounce tracking map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time②">current wall time</a>.</p>
      </ol>
     <li data-md>
      <p>Set <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⑦">bounce tracking record</a> to null.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.5" id="bounce-tracking-mitigations-deletion"><span class="secno">6.2.5. </span><span class="content">Deletion</span><a class="self-link" href="#bounce-tracking-mitigations-deletion"></a></h4>
   <p class="note" role="note">The cookie and cache clearing algorithms were largely copied from
the <a href="https://w3c.github.io/webappsec-clear-site-data">Clear Site Data</a> spec.  It would be nice to unify these in the future.</p>
   <div class="algorithm" data-algorithm="clear cookies for host">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="clear-cookies-for-host">clear cookies for host</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑨">host</a> <var>host</var>, perform the
following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>cookieList</var> be the set of cookies from the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.3" id="ref-for-section-5.3">cookie store</a> whose
domain attribute is a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.1.3" id="ref-for-section-5.1.3">domain-match</a> with <var>host</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>cookie</var> in <var>cookieList</var>:</p>
      <ol>
       <li data-md>
        <p>Remove <var>cookie</var> from the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.3" id="ref-for-section-5.3①">cookie store</a>.</p>
      </ol>
    </ol>
   </div>
   <p class="issue" id="issue-a6c4e61d"><a class="self-link" href="#issue-a6c4e61d"></a> TODO: Verify that using <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.1.3" id="ref-for-section-5.1.3①">domain-match</a> catches all cookies for the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain①">registrable domain</a>.</p>
   <div class="algorithm" data-algorithm="clear non-cookie storage for host">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="clear-non-cookie-storage-for-host">clear non-cookie storage for host</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②⓪">host</a> <var>host</var>, perform
the following steps: 
    <ol>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-shed" id="ref-for-storage-shed">storage shed</a> <var>shed</var> held by the user agent or a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" id="ref-for-traversable-navigable">traversable navigable</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate②">For each</a> <var>storageKey</var> -> <var>storageShelf</var> of <var>shed</var>:</p>
        <ol>
         <li data-md>
          <p>If <var>storageKey</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-key-origin" id="ref-for-storage-key-origin">origin</a> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque⑤">opaque origin</a>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑦">continue</a>.</p>
         <li data-md>
          <p>If <var>storageKey</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-key-origin" id="ref-for-storage-key-origin①">origin</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host">host</a> does not equal <var>host</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑧">continue</a>.</p>
         <li data-md>
          <p>Delete all data stored in <var>storageShelf</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove③">Remove</a> <var>storageKey</var> from <var>shed</var>.</p>
        </ol>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="clear cache for host">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="clear-cache-for-host">clear cache for host</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②①">host</a> <var>host</var>, perform the
following steps: 
    <ol>
     <li data-md>
      <p>Let <var>cacheList</var> be the set of entries from the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7234/#section-2" id="ref-for-section-2">network cache</a> whose
target URI <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②②">host</a> equals <var>host</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>entry</var> in <var>cacheList</var>:</p>
      <ol>
       <li data-md>
        <p>Remove <var>entry</var> from the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7234/#section-2" id="ref-for-section-2①">network cache</a>.</p>
      </ol>
    </ol>
   </div>
   <h2 class="heading settled" data-level="7" id="privacy-and-security-considerations"><span class="secno">7. </span><span class="content">Privacy and Security Considerations</span><a class="self-link" href="#privacy-and-security-considerations"></a></h2>
   <p>This feature stores information about sites that have a user interaction, some amount of view time, or <a href="https://www.chromium.org/developers/design-documents/site-engagement/">engagement</a>. This information is
not directly exposed to sites, however, it can be indirectly observed.  For example, if <code>tracker.example</code> reports back its oldest existing state to <code>site1.example</code>, then <code>site1.example</code> could infer that <code>tracker.example</code> has had an interaction.  If it does not report any long-lived state, however, then <code>site1.example</code> could infer that the state was wiped.</p>
   <p>In addition, there are potential scenarios where the existence of an interaction could be accessed through
existing XS leaks in the platform.  Consider a scenario where a target site has an existing endpoint that
causes an automatic redirect that triggers the bounce tracking mitigations.  An attacker could use existing
XS leaks to determine if any logged-in state is present on a target site and then look to see if that state
disappears after triggering the bounce.</p>
   <p>The information leak from tracker to site does not seem very significant.  At a minimum, the proposed
mitigations do not make the situation worse and without the mitigations there is a greater potential for a
tracker to communicate state to the target site.</p>
   <p>The cross-site adversarial information leak is more concerning.  Solutions designed for this effort should
take this threat into account and attempt to mitigate it.  For example, delaying or fuzzing the timing of
storage wiping could lessen the impact of the leak.  Ultimately, though, it may be necessary to weigh the
cost of this 1 bit information leak against the gains in mitigating bounce tracking.</p>
   <p>Another threat that should be considered by any solution is the possibility that an attacker will trick a
user into visiting an existing redirect endpoint on a site that they care about and somehow trigger their
storage to be deleted.  The current plan, however, is to already look at signals that a user cares about a
site for legitimate use cases, in order to avoid wiping data they care about.  This threat just puts more
weight on getting these signals correct.</p>
   <p>Otherwise this effort does not store or expose any new types of information.  It does not create any new
cross-origin communication or storage capabilities.</p>
   <p>There is some implementation complexity to be aware of when wiping storage.  The browser must be careful
not to wipe storage out from under a site actively using it.  This could lead to poor interop and broken
web sites.</p>
   <h2 class="no-num heading settled" id="acknowledgements"><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p>Many thanks to the Privacy Community Group for many good discussions about this proposal.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#bounce-tracking-record-bounce-set">bounce set</a><span>, in § 6.1.2</span>
   <li><a href="#bounce-tracking">Bounce tracking</a><span>, in § 3</span>
   <li><a href="#bounce-tracking-activation-lifetime">bounce tracking activation lifetime</a><span>, in § 6.1.3</span>
   <li><a href="#bounce-tracking-grace-period">bounce tracking grace period</a><span>, in § 6.1.3</span>
   <li>
    bounce tracking record
    <ul>
     <li><a href="#bounce-tracking-record">definition of</a><span>, in § 6.1.2</span>
     <li><a href="#top-level-traversable-bounce-tracking-record">dfn for top-level traversable</a><span>, in § 6.1.2</span>
    </ul>
   <li><a href="#bounce-tracking-timer">bounce tracking timer</a><span>, in § 6.2.4</span>
   <li><a href="#bounce-tracking-timer-period">bounce tracking timer period</a><span>, in § 6.1.3</span>
   <li><a href="#clear-cache-for-host">clear cache for host</a><span>, in § 6.2.5</span>
   <li><a href="#clear-cookies-for-host">clear cookies for host</a><span>, in § 6.2.5</span>
   <li><a href="#clear-non-cookie-storage-for-host">clear non-cookie storage for host</a><span>, in § 6.2.5</span>
   <li><a href="#client-bounce-detection-timer-period">client bounce detection timer period</a><span>, in § 6.1.3</span>
   <li><a href="#extended-navigation">extended navigation</a><span>, in § 6.1.2</span>
   <li><a href="#bounce-tracking-record-final-host">final host</a><span>, in § 6.1.2</span>
   <li><a href="#bounce-tracking-record-initial-host">initial host</a><span>, in § 6.1.2</span>
   <li><a href="#link-decoration">Link decoration</a><span>, in § 3</span>
   <li><a href="#navigational-tracking">Navigational tracking</a><span>, in § 3</span>
   <li><a href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations">process a fetch storage access for bounce tracking mitigations</a><span>, in § 6.2.3.2</span>
   <li><a href="#process-a-general-storage-access-for-bounce-tracking-mitigations">process a general storage access for bounce tracking mitigations</a><span>, in § 6.2.3.4</span>
   <li><a href="#process-a-web-authentication-assertion-for-bounce-tracking-mitigations">process a Web Authentication assertion for bounce tracking mitigations</a><span>, in § 6.2.2</span>
   <li><a href="#process-document-load-for-bounce-tracking">process document load for bounce tracking</a><span>, in § 6.2.3.6</span>
   <li><a href="#process-navigation-start-for-bounce-tracking">process navigation start for bounce tracking</a><span>, in § 6.2.3.1</span>
   <li><a href="#process-response-received-for-bounce-tracking">process response received for bounce tracking</a><span>, in § 6.2.3.5</span>
   <li><a href="#record-a-user-activation">record a user activation</a><span>, in § 6.2.1</span>
   <li><a href="#record-stateful-bounces-for-bounce-tracking">record stateful bounces for bounce tracking</a><span>, in § 6.2.4</span>
   <li><a href="#stateful-bounce-tracking-map">stateful bounce tracking map</a><span>, in § 6.1.1</span>
   <li><a href="#bounce-tracking-record-storage-access-set">storage access set</a><span>, in § 6.1.2</span>
   <li><a href="#user-activation-map">user activation map</a><span>, in § 6.1.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[COOKIES]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="69ba1a02">cookie store</span>
     <li><span class="dfn-paneled" id="5ac0e3d4">domain-match</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="543878fa">append</span>
     <li><span class="dfn-paneled" id="a973e0fe">document</span>
     <li><span class="dfn-paneled" id="b9429bc2">insert</span>
     <li><span class="dfn-paneled" id="c62cd7cf">origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="857d5516">client</span>
     <li><span class="dfn-paneled" id="d85a6c84">header list</span>
     <li><span class="dfn-paneled" id="d75f6c27">http-network fetch</span>
     <li><span class="dfn-paneled" id="980528b0">http-network-or-cache fetch</span>
     <li><span class="dfn-paneled" id="f78d5b5c">origin</span>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
     <li><span class="dfn-paneled" id="abe352cd">reserved client</span>
     <li><span class="dfn-paneled" id="839611db">subresource request</span>
     <li><span class="dfn-paneled" id="ff8d2a6f">url list</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HR-TIME-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f16ee824">current wall time</span>
     <li><span class="dfn-paneled" id="4b2c8c72">duration</span>
     <li><span class="dfn-paneled" id="1e2edd5b">moment</span>
     <li><span class="dfn-paneled" id="12938d07">unsafe current time</span>
     <li><span class="dfn-paneled" id="05de5ae3">wall clock</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="36d15a6d">activation notification</span>
     <li><span class="dfn-paneled" id="35972864">active document</span>
     <li><span class="dfn-paneled" id="3349d69f">associated document</span>
     <li><span class="dfn-paneled" id="0d0390b4">browsing context</span>
     <li><span class="dfn-paneled" id="07ad3048">create navigation params by fetching</span>
     <li><span class="dfn-paneled" id="24cf98a1">environment</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="4b6086d7">global object</span>
     <li><span class="dfn-paneled" id="dfa9c14c">has transient activation</span>
     <li><span class="dfn-paneled" id="77a2ee6e">host</span>
     <li><span class="dfn-paneled" id="448c95f9">http-equiv</span>
     <li><span class="dfn-paneled" id="5423e8ff">hyperlink</span>
     <li><span class="dfn-paneled" id="87fcd40c">iframe</span>
     <li><span class="dfn-paneled" id="ba244b14">load a document</span>
     <li><span class="dfn-paneled" id="3a2db83f">localStorage</span>
     <li><span class="dfn-paneled" id="93ce1392">location</span>
     <li><span class="dfn-paneled" id="64b89595">meta</span>
     <li><span class="dfn-paneled" id="9c19b7fc">navigable</span>
     <li><span class="dfn-paneled" id="2594e562">navigate</span>
     <li><span class="dfn-paneled" id="b6ae4501">networking task source</span>
     <li><span class="dfn-paneled" id="13dd6cae">node navigable</span>
     <li><span class="dfn-paneled" id="602b1a68">obtain a site</span>
     <li><span class="dfn-paneled" id="b01b1359">opaque origin</span>
     <li><span class="dfn-paneled" id="48438eb3">queue a global task</span>
     <li><span class="dfn-paneled" id="e7b2fe41">refresh</span>
     <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="8596ac55">run steps after a timeout</span>
     <li><span class="dfn-paneled" id="fb9bb722">site</span>
     <li><span class="dfn-paneled" id="77093875">source snapshot params</span>
     <li><span class="dfn-paneled" id="085ddd0a">target browsing context</span>
     <li><span class="dfn-paneled" id="c63519ed">top-level origin</span>
     <li><span class="dfn-paneled" id="bd736ec6">top-level traversable</span>
     <li><span class="dfn-paneled" id="0ff9b6b9">top-level traversable <small>(for browsing context)</small></span>
     <li><span class="dfn-paneled" id="d0c1b934">traversable navigable</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTTP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4a139803">http 3xx statuses</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a3b18719">append</span>
     <li><span class="dfn-paneled" id="77b4c09a">assert</span>
     <li><span class="dfn-paneled" id="ae8def21">contain <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="a326add7">contain <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="16d07e10">for each <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="45209803">for each <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="7d4424b2">remove</span>
     <li><span class="dfn-paneled" id="15e48c39">set</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC7234]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4b7a6eea">network cache</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SERVICE-WORKERS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c60ed63a">service worker</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STORAGE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4473e129">obtain a storage bottle map</span>
     <li><span class="dfn-paneled" id="ef4a9b44">origin</span>
     <li><span class="dfn-paneled" id="660191f0">storage shed</span>
    </ul>
   <li>
    <a data-link-type="biblio">[TRACKING-DNT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0d21247b">tracking</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cfc67fdc">empty host</span>
     <li><span class="dfn-paneled" id="8ad2567a">equal</span>
     <li><span class="dfn-paneled" id="752d140b">host</span>
     <li><span class="dfn-paneled" id="bc9d7803">registrable domain</span>
     <li><span class="dfn-paneled" id="dcffbccd">url</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-cookies">[COOKIES]
   <dd>A. Barth. <a href="https://httpwg.org/specs/rfc6265.html"><cite>HTTP State Management Mechanism</cite></a>. April 2011. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc6265.html">https://httpwg.org/specs/rfc6265.html</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-hr-time-3">[HR-TIME-3]
   <dd>Yoav Weiss. <a href="https://w3c.github.io/hr-time/"><cite>High Resolution Time</cite></a>. URL: <a href="https://w3c.github.io/hr-time/">https://w3c.github.io/hr-time/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc7234">[RFC7234]
   <dd>R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. <a href="https://httpwg.org/specs/rfc7234.html"><cite>Hypertext Transfer Protocol (HTTP/1.1): Caching</cite></a>. June 2014. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc7234.html">https://httpwg.org/specs/rfc7234.html</a>
   <dt id="biblio-storage">[STORAGE]
   <dd>Anne van Kesteren. <a href="https://storage.spec.whatwg.org/"><cite>Storage Standard</cite></a>. Living Standard. URL: <a href="https://storage.spec.whatwg.org/">https://storage.spec.whatwg.org/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-fsn-2021-q4">[FSN-2021-Q4]
   <dd><a href="https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4"><cite>Firefox Security Newsletter 2021 Q4</cite></a>. 2022-03-09. URL: <a href="https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4">https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4</a>
   <dt id="biblio-mozilla-tracking-policy">[MOZILLA-TRACKING-POLICY]
   <dd><a href="https://wiki.mozilla.org/Security/Anti_tracking_policy"><cite>Mozilla Anti Tracking Policy</cite></a>. URL: <a href="https://wiki.mozilla.org/Security/Anti_tracking_policy">https://wiki.mozilla.org/Security/Anti_tracking_policy</a>
   <dt id="biblio-service-workers">[SERVICE-WORKERS]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
   <dt id="biblio-tracking-dnt">[TRACKING-DNT]
   <dd>Roy Fielding; David Singer. <a href="https://w3c.github.io/dnt/drafts/tracking-dnt.html"><cite>Tracking Preference Expression (DNT)</cite></a>. URL: <a href="https://w3c.github.io/dnt/drafts/tracking-dnt.html">https://w3c.github.io/dnt/drafts/tracking-dnt.html</a>
   <dt id="biblio-webkit-tracking-prevention">[WEBKIT-TRACKING-PREVENTION]
   <dd><a href="https://webkit.org/tracking-prevention/"><cite>Tracking Prevention in WebKit</cite></a>. URL: <a href="https://webkit.org/tracking-prevention/">https://webkit.org/tracking-prevention/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Changing the numbers changes what map the user sees, and embedding
a user ID would not successfully transfer that user ID to the target site,
but it’s hard for an automated system inside a browser to prove
that, and even hard for humans reading the URL to be confident of it. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/4">[Issue #4]</a> <a class="issue-return" href="#issue-9458c4e5" title="Jump to section">↵</a></div>
   <div class="issue"> The URL identifies an action rather than a page, and the user ID
might be essential for that action to happen. However, this is also clearly
a user ID and sufficient to track a user if the source and target
collaborate. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a> <a class="issue-return" href="#issue-fc2127e1" title="Jump to section">↵</a></div>
   <div class="issue"> This is probably the same case as the unsubscribe link. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a> <a class="issue-return" href="#issue-0c501704" title="Jump to section">↵</a></div>
   <div class="issue"> This patch has to be run whenever a site accesses non-cookie storage. <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map">Obtain a storage bottle map</a> is the intended hook for this, but it does not currently have full coverage across specs that use storage.
So this patch is not comprehensive. <a href="https://github.com/whatwg/storage/issues/165">[Issue #whatwg/storage#165]</a> <a class="issue-return" href="#issue-6bd6f4f1" title="Jump to section">↵</a></div>
   <div class="issue">TODO: Consider if we should do anything when the clock is moved
    forward or backward. <a class="issue-return" href="#issue-c8879d93" title="Jump to section">↵</a></div>
   <div class="issue"> TODO: Verify that using <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.1.3">domain-match</a> catches all cookies for the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain">registrable domain</a>. <a class="issue-return" href="#issue-a6c4e61d" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['69ba1a02'] = {"dfnID": "69ba1a02", "url": "https://tools.ietf.org/html/rfc6265/#section-5.3", "dfnText": "cookie store", "refSections": [{"refs": [{"id": "ref-for-section-5.3"}, {"id": "ref-for-section-5.3\u2460"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['5ac0e3d4'] = {"dfnID": "5ac0e3d4", "url": "https://tools.ietf.org/html/rfc6265/#section-5.1.3", "dfnText": "domain-match", "refSections": [{"refs": [{"id": "ref-for-section-5.1.3"}, {"id": "ref-for-section-5.1.3\u2460"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['543878fa'] = {"dfnID": "543878fa", "url": "https://dom.spec.whatwg.org/#concept-node-append", "dfnText": "append", "refSections": [{"refs": [{"id": "ref-for-concept-node-append"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['a973e0fe'] = {"dfnID": "a973e0fe", "url": "https://dom.spec.whatwg.org/#concept-document", "dfnText": "document", "refSections": [{"refs": [{"id": "ref-for-concept-document"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-document\u2460"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-document\u2461"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}], "external": true};
window.dfnpanelData['b9429bc2'] = {"dfnID": "b9429bc2", "url": "https://dom.spec.whatwg.org/#concept-node-insert", "dfnText": "insert", "refSections": [{"refs": [{"id": "ref-for-concept-node-insert"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}], "external": true};
window.dfnpanelData['c62cd7cf'] = {"dfnID": "c62cd7cf", "url": "https://dom.spec.whatwg.org/#concept-document-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-document-origin"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-document-origin\u2460"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-concept-document-origin\u2461"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-document-origin\u2462"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['857d5516'] = {"dfnID": "857d5516", "url": "https://fetch.spec.whatwg.org/#concept-request-client", "dfnText": "client", "refSections": [{"refs": [{"id": "ref-for-concept-request-client"}, {"id": "ref-for-concept-request-client\u2460"}, {"id": "ref-for-concept-request-client\u2461"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['d85a6c84'] = {"dfnID": "d85a6c84", "url": "https://fetch.spec.whatwg.org/#concept-header-list", "dfnText": "header list", "refSections": [{"refs": [{"id": "ref-for-concept-header-list"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['d75f6c27'] = {"dfnID": "d75f6c27", "url": "https://fetch.spec.whatwg.org/#concept-http-network-fetch", "dfnText": "http-network fetch", "refSections": [{"refs": [{"id": "ref-for-concept-http-network-fetch"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['980528b0'] = {"dfnID": "980528b0", "url": "https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch", "dfnText": "http-network-or-cache fetch", "refSections": [{"refs": [{"id": "ref-for-concept-http-network-or-cache-fetch"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['f78d5b5c'] = {"dfnID": "f78d5b5c", "url": "https://fetch.spec.whatwg.org/#concept-request-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-request-origin"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['55213b5b'] = {"dfnID": "55213b5b", "url": "https://fetch.spec.whatwg.org/#concept-request", "dfnText": "request", "refSections": [{"refs": [{"id": "ref-for-concept-request"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['abe352cd'] = {"dfnID": "abe352cd", "url": "https://fetch.spec.whatwg.org/#concept-request-reserved-client", "dfnText": "reserved client", "refSections": [{"refs": [{"id": "ref-for-concept-request-reserved-client"}, {"id": "ref-for-concept-request-reserved-client\u2460"}, {"id": "ref-for-concept-request-reserved-client\u2461"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['839611db'] = {"dfnID": "839611db", "url": "https://fetch.spec.whatwg.org/#subresource-request", "dfnText": "subresource request", "refSections": [{"refs": [{"id": "ref-for-subresource-request"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}], "external": true};
window.dfnpanelData['ff8d2a6f'] = {"dfnID": "ff8d2a6f", "url": "https://fetch.spec.whatwg.org/#concept-response-url-list", "dfnText": "url list", "refSections": [{"refs": [{"id": "ref-for-concept-response-url-list"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}], "external": true};
window.dfnpanelData['f16ee824'] = {"dfnID": "f16ee824", "url": "https://w3c.github.io/hr-time/#dfn-eso-current-wall-time", "dfnText": "current wall time", "refSections": [{"refs": [{"id": "ref-for-dfn-eso-current-wall-time"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-dfn-eso-current-wall-time\u2460"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-dfn-eso-current-wall-time\u2461"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['4b2c8c72'] = {"dfnID": "4b2c8c72", "url": "https://w3c.github.io/hr-time/#dfn-duration", "dfnText": "duration", "refSections": [{"refs": [{"id": "ref-for-dfn-duration"}, {"id": "ref-for-dfn-duration\u2460"}, {"id": "ref-for-dfn-duration\u2461"}, {"id": "ref-for-dfn-duration\u2462"}], "title": "6.1.3. Constants"}], "external": true};
window.dfnpanelData['1e2edd5b'] = {"dfnID": "1e2edd5b", "url": "https://w3c.github.io/hr-time/#dfn-moment", "dfnText": "moment", "refSections": [{"refs": [{"id": "ref-for-dfn-moment"}, {"id": "ref-for-dfn-moment\u2460"}, {"id": "ref-for-dfn-moment\u2461"}, {"id": "ref-for-dfn-moment\u2462"}], "title": "6.1.1. Global Data"}, {"refs": [{"id": "ref-for-dfn-moment\u2463"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['12938d07'] = {"dfnID": "12938d07", "url": "https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time", "dfnText": "unsafe current time", "refSections": [{"refs": [{"id": "ref-for-wall-clock-unsafe-current-time"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['05de5ae3'] = {"dfnID": "05de5ae3", "url": "https://w3c.github.io/hr-time/#dfn-wall-clock", "dfnText": "wall clock", "refSections": [{"refs": [{"id": "ref-for-dfn-wall-clock"}, {"id": "ref-for-dfn-wall-clock\u2460"}], "title": "6.1.1. Global Data"}, {"refs": [{"id": "ref-for-dfn-wall-clock\u2461"}, {"id": "ref-for-dfn-wall-clock\u2462"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['36d15a6d'] = {"dfnID": "36d15a6d", "url": "https://html.spec.whatwg.org/multipage/interaction.html#activation-notification", "dfnText": "activation notification", "refSections": [{"refs": [{"id": "ref-for-activation-notification"}], "title": "6.2.1. User Activation\nMonkey Patch"}], "external": true};
window.dfnpanelData['35972864'] = {"dfnID": "35972864", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document", "dfnText": "active document", "refSections": [{"refs": [{"id": "ref-for-nav-document"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-nav-document\u2460"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-nav-document\u2461"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-nav-document\u2462"}, {"id": "ref-for-nav-document\u2463"}, {"id": "ref-for-nav-document\u2464"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['3349d69f'] = {"dfnID": "3349d69f", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window", "dfnText": "associated document", "refSections": [{"refs": [{"id": "ref-for-concept-document-window"}, {"id": "ref-for-concept-document-window\u2460"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['0d0390b4'] = {"dfnID": "0d0390b4", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context", "dfnText": "browsing context", "refSections": [{"refs": [{"id": "ref-for-browsing-context"}], "title": "6.2.2. Web Authentication Monkey Patch"}], "external": true};
window.dfnpanelData['07ad3048'] = {"dfnID": "07ad3048", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching", "dfnText": "create navigation params by fetching", "refSections": [{"refs": [{"id": "ref-for-create-navigation-params-by-fetching"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}], "external": true};
window.dfnpanelData['24cf98a1'] = {"dfnID": "24cf98a1", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment", "dfnText": "environment", "refSections": [{"refs": [{"id": "ref-for-environment"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-environment\u2460"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": true};
window.dfnpanelData['3e12e042'] = {"dfnID": "3e12e042", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object", "dfnText": "environment settings object", "refSections": [{"refs": [{"id": "ref-for-environment-settings-object"}, {"id": "ref-for-environment-settings-object\u2460"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": true};
window.dfnpanelData['4b6086d7'] = {"dfnID": "4b6086d7", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#global-object", "dfnText": "global object", "refSections": [{"refs": [{"id": "ref-for-global-object"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['dfa9c14c'] = {"dfnID": "dfa9c14c", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation", "dfnText": "has transient activation", "refSections": [{"refs": [{"id": "ref-for-source-snapshot-params-activation"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}], "external": true};
window.dfnpanelData['77a2ee6e'] = {"dfnID": "77a2ee6e", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host", "dfnText": "host", "refSections": [{"refs": [{"id": "ref-for-concept-origin-host"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['448c95f9'] = {"dfnID": "448c95f9", "url": "https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv", "dfnText": "http-equiv", "refSections": [{"refs": [{"id": "ref-for-attr-meta-http-equiv"}], "title": "3. Terminology"}], "external": true};
window.dfnpanelData['5423e8ff'] = {"dfnID": "5423e8ff", "url": "https://html.spec.whatwg.org/multipage/links.html#hyperlink", "dfnText": "hyperlink", "refSections": [{"refs": [{"id": "ref-for-hyperlink"}], "title": "3. Terminology"}], "external": true};
window.dfnpanelData['87fcd40c'] = {"dfnID": "87fcd40c", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element", "dfnText": "iframe", "refSections": [{"refs": [{"id": "ref-for-the-iframe-element"}], "title": "3. Terminology"}], "external": true};
window.dfnpanelData['ba244b14'] = {"dfnID": "ba244b14", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#loading-a-document", "dfnText": "load a document", "refSections": [{"refs": [{"id": "ref-for-loading-a-document"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}], "external": true};
window.dfnpanelData['3a2db83f'] = {"dfnID": "3a2db83f", "url": "https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage", "dfnText": "localStorage", "refSections": [{"refs": [{"id": "ref-for-dom-localstorage"}], "title": "5.1.3. Brave"}], "external": true};
window.dfnpanelData['93ce1392'] = {"dfnID": "93ce1392", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location", "dfnText": "location", "refSections": [{"refs": [{"id": "ref-for-dom-location"}], "title": "3. Terminology"}], "external": true};
window.dfnpanelData['64b89595'] = {"dfnID": "64b89595", "url": "https://html.spec.whatwg.org/multipage/semantics.html#meta", "dfnText": "meta", "refSections": [{"refs": [{"id": "ref-for-meta"}], "title": "3. Terminology"}], "external": true};
window.dfnpanelData['9c19b7fc'] = {"dfnID": "9c19b7fc", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#navigable", "dfnText": "navigable", "refSections": [{"refs": [{"id": "ref-for-navigable"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-navigable\u2460"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-navigable\u2461"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}], "external": true};
window.dfnpanelData['2594e562'] = {"dfnID": "2594e562", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate", "dfnText": "navigate", "refSections": [{"refs": [{"id": "ref-for-navigate"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}], "external": true};
window.dfnpanelData['b6ae4501'] = {"dfnID": "b6ae4501", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source", "dfnText": "networking task source", "refSections": [{"refs": [{"id": "ref-for-networking-task-source"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-networking-task-source\u2460"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}], "external": true};
window.dfnpanelData['13dd6cae'] = {"dfnID": "13dd6cae", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable", "dfnText": "node navigable", "refSections": [{"refs": [{"id": "ref-for-node-navigable"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-node-navigable\u2460"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['602b1a68'] = {"dfnID": "602b1a68", "url": "https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site", "dfnText": "obtain a site", "refSections": [{"refs": [{"id": "ref-for-obtain-a-site"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-obtain-a-site\u2460"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-obtain-a-site\u2461"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-obtain-a-site\u2462"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-obtain-a-site\u2463"}], "title": "6.2.3.4. Storage Access Monkey Patch"}, {"refs": [{"id": "ref-for-obtain-a-site\u2464"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-obtain-a-site\u2465"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}, {"refs": [{"id": "ref-for-obtain-a-site\u2466"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['b01b1359'] = {"dfnID": "b01b1359", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque", "dfnText": "opaque origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin-opaque"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-origin-opaque\u2460"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-concept-origin-opaque\u2461"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-origin-opaque\u2462"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-concept-origin-opaque\u2463"}], "title": "6.2.3.4. Storage Access Monkey Patch"}, {"refs": [{"id": "ref-for-concept-origin-opaque\u2464"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['48438eb3'] = {"dfnID": "48438eb3", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task", "dfnText": "queue a global task", "refSections": [{"refs": [{"id": "ref-for-queue-a-global-task"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}], "external": true};
window.dfnpanelData['e7b2fe41'] = {"dfnID": "e7b2fe41", "url": "https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh", "dfnText": "refresh", "refSections": [{"refs": [{"id": "ref-for-attr-meta-http-equiv-keyword-refresh"}], "title": "3. Terminology"}], "external": true};
window.dfnpanelData['e99bd18e'] = {"dfnID": "e99bd18e", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global", "dfnText": "relevant global object", "refSections": [{"refs": [{"id": "ref-for-concept-relevant-global"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-relevant-global\u2460"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}], "external": true};
window.dfnpanelData['9c4c1e66'] = {"dfnID": "9c4c1e66", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object", "dfnText": "relevant settings object", "refSections": [{"refs": [{"id": "ref-for-relevant-settings-object"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2460"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2461"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['8596ac55'] = {"dfnID": "8596ac55", "url": "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout", "dfnText": "run steps after a timeout", "refSections": [{"refs": [{"id": "ref-for-run-steps-after-a-timeout"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}], "external": true};
window.dfnpanelData['fb9bb722'] = {"dfnID": "fb9bb722", "url": "https://html.spec.whatwg.org/multipage/browsers.html#site", "dfnText": "site", "refSections": [{"refs": [{"id": "ref-for-site"}, {"id": "ref-for-site\u2460"}, {"id": "ref-for-site\u2461"}, {"id": "ref-for-site\u2462"}], "title": "6.1.1. Global Data"}, {"refs": [{"id": "ref-for-site\u2463"}, {"id": "ref-for-site\u2464"}, {"id": "ref-for-site\u2465"}, {"id": "ref-for-site\u2466"}], "title": "6.1.2. Per-Tab Data"}, {"refs": [{"id": "ref-for-site\u2467"}, {"id": "ref-for-site\u2468"}], "title": "6.1.3. Constants"}], "external": true};
window.dfnpanelData['77093875'] = {"dfnID": "77093875", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params", "dfnText": "source snapshot params", "refSections": [{"refs": [{"id": "ref-for-source-snapshot-params"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}], "external": true};
window.dfnpanelData['085ddd0a'] = {"dfnID": "085ddd0a", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context", "dfnText": "target browsing context", "refSections": [{"refs": [{"id": "ref-for-concept-environment-target-browsing-context"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-concept-environment-target-browsing-context\u2460"}, {"id": "ref-for-concept-environment-target-browsing-context\u2461"}, {"id": "ref-for-concept-environment-target-browsing-context\u2462"}, {"id": "ref-for-concept-environment-target-browsing-context\u2463"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-concept-environment-target-browsing-context\u2464"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": true};
window.dfnpanelData['c63519ed'] = {"dfnID": "c63519ed", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin", "dfnText": "top-level origin", "refSections": [{"refs": [{"id": "ref-for-concept-environment-top-level-origin"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": true};
window.dfnpanelData['bd736ec6'] = {"dfnID": "bd736ec6", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable", "dfnText": "top-level traversable", "refSections": [{"refs": [{"id": "ref-for-top-level-traversable"}, {"id": "ref-for-top-level-traversable\u2460"}], "title": "6.1.2. Per-Tab Data"}, {"refs": [{"id": "ref-for-top-level-traversable\u2461"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-top-level-traversable\u2462"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-top-level-traversable\u2463"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-top-level-traversable\u2464"}], "title": "6.2.3.3. Service Worker Activation Monkey Patch"}, {"refs": [{"id": "ref-for-top-level-traversable\u2465"}], "title": "6.2.3.4. Storage Access Monkey Patch"}, {"refs": [{"id": "ref-for-top-level-traversable\u2466"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-top-level-traversable\u2467"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}, {"refs": [{"id": "ref-for-top-level-traversable\u2468"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['0ff9b6b9'] = {"dfnID": "0ff9b6b9", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable", "dfnText": "top-level traversable (for browsing context)", "refSections": [{"refs": [{"id": "ref-for-bc-traversable"}, {"id": "ref-for-bc-traversable\u2460"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-bc-traversable\u2461"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": true};
window.dfnpanelData['d0c1b934'] = {"dfnID": "d0c1b934", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable", "dfnText": "traversable navigable", "refSections": [{"refs": [{"id": "ref-for-traversable-navigable"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['4a139803'] = {"dfnID": "4a139803", "url": "https://httpwg.org/specs/rfc7231.html#status.3xx", "dfnText": "http 3xx statuses", "refSections": [{"refs": [{"id": "ref-for-status.3xx"}], "title": "3. Terminology"}], "external": true};
window.dfnpanelData['a3b18719'] = {"dfnID": "a3b18719", "url": "https://infra.spec.whatwg.org/#set-append", "dfnText": "append", "refSections": [{"refs": [{"id": "ref-for-set-append"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-set-append\u2460"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": true};
window.dfnpanelData['77b4c09a'] = {"dfnID": "77b4c09a", "url": "https://infra.spec.whatwg.org/#assert", "dfnText": "assert", "refSections": [{"refs": [{"id": "ref-for-assert"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-assert\u2460"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}, {"refs": [{"id": "ref-for-assert\u2461"}, {"id": "ref-for-assert\u2462"}, {"id": "ref-for-assert\u2463"}, {"id": "ref-for-assert\u2464"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['ae8def21'] = {"dfnID": "ae8def21", "url": "https://infra.spec.whatwg.org/#list-contain", "dfnText": "contain (for list)", "refSections": [{"refs": [{"id": "ref-for-list-contain"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['a326add7'] = {"dfnID": "a326add7", "url": "https://infra.spec.whatwg.org/#map-exists", "dfnText": "contain (for map)", "refSections": [{"refs": [{"id": "ref-for-map-exists"}, {"id": "ref-for-map-exists\u2460"}, {"id": "ref-for-map-exists\u2461"}, {"id": "ref-for-map-exists\u2462"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['f937b7b6'] = {"dfnID": "f937b7b6", "url": "https://infra.spec.whatwg.org/#iteration-continue", "dfnText": "continue", "refSections": [{"refs": [{"id": "ref-for-iteration-continue"}, {"id": "ref-for-iteration-continue\u2460"}, {"id": "ref-for-iteration-continue\u2461"}, {"id": "ref-for-iteration-continue\u2462"}, {"id": "ref-for-iteration-continue\u2463"}, {"id": "ref-for-iteration-continue\u2464"}, {"id": "ref-for-iteration-continue\u2465"}], "title": "6.2.4. Timers"}, {"refs": [{"id": "ref-for-iteration-continue\u2466"}, {"id": "ref-for-iteration-continue\u2467"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['16d07e10'] = {"dfnID": "16d07e10", "url": "https://infra.spec.whatwg.org/#list-iterate", "dfnText": "for each (for list)", "refSections": [{"refs": [{"id": "ref-for-list-iterate"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-list-iterate\u2460"}], "title": "6.2.4. Timers"}, {"refs": [{"id": "ref-for-list-iterate\u2461"}, {"id": "ref-for-list-iterate\u2462"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['45209803'] = {"dfnID": "45209803", "url": "https://infra.spec.whatwg.org/#map-iterate", "dfnText": "for each (for map)", "refSections": [{"refs": [{"id": "ref-for-map-iterate"}, {"id": "ref-for-map-iterate\u2460"}], "title": "6.2.4. Timers"}, {"refs": [{"id": "ref-for-map-iterate\u2461"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['860300d4'] = {"dfnID": "860300d4", "url": "https://infra.spec.whatwg.org/#implementation-defined", "dfnText": "implementation-defined", "refSections": [{"refs": [{"id": "ref-for-implementation-defined"}, {"id": "ref-for-implementation-defined\u2460"}, {"id": "ref-for-implementation-defined\u2461"}, {"id": "ref-for-implementation-defined\u2462"}], "title": "6.1.3. Constants"}], "external": true};
window.dfnpanelData['649608b9'] = {"dfnID": "649608b9", "url": "https://infra.spec.whatwg.org/#list", "dfnText": "list", "refSections": [{"refs": [{"id": "ref-for-list"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-list\u2460"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}], "external": true};
window.dfnpanelData['3fca5a9e'] = {"dfnID": "3fca5a9e", "url": "https://infra.spec.whatwg.org/#ordered-map", "dfnText": "map", "refSections": [{"refs": [{"id": "ref-for-ordered-map"}, {"id": "ref-for-ordered-map\u2460"}], "title": "6.1.1. Global Data"}], "external": true};
window.dfnpanelData['7d4424b2'] = {"dfnID": "7d4424b2", "url": "https://infra.spec.whatwg.org/#map-remove", "dfnText": "remove", "refSections": [{"refs": [{"id": "ref-for-map-remove"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-map-remove\u2460"}, {"id": "ref-for-map-remove\u2461"}], "title": "6.2.4. Timers"}, {"refs": [{"id": "ref-for-map-remove\u2462"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['15e48c39'] = {"dfnID": "15e48c39", "url": "https://infra.spec.whatwg.org/#ordered-set", "dfnText": "set", "refSections": [{"refs": [{"id": "ref-for-ordered-set"}, {"id": "ref-for-ordered-set\u2460"}], "title": "6.1.2. Per-Tab Data"}], "external": true};
window.dfnpanelData['984221ca'] = {"dfnID": "984221ca", "url": "https://infra.spec.whatwg.org/#struct", "dfnText": "struct", "refSections": [{"refs": [{"id": "ref-for-struct"}], "title": "6.1.2. Per-Tab Data"}], "external": true};
window.dfnpanelData['4b7a6eea'] = {"dfnID": "4b7a6eea", "url": "https://tools.ietf.org/html/rfc7234/#section-2", "dfnText": "network cache", "refSections": [{"refs": [{"id": "ref-for-section-2"}, {"id": "ref-for-section-2\u2460"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['c60ed63a'] = {"dfnID": "c60ed63a", "url": "https://w3c.github.io/ServiceWorker/#dfn-service-worker", "dfnText": "service worker", "refSections": [{"refs": [{"id": "ref-for-dfn-service-worker"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": true};
window.dfnpanelData['4473e129'] = {"dfnID": "4473e129", "url": "https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map", "dfnText": "obtain a storage bottle map", "refSections": [{"refs": [{"id": "ref-for-obtain-a-storage-bottle-map"}, {"id": "ref-for-obtain-a-storage-bottle-map\u2460"}, {"id": "ref-for-obtain-a-storage-bottle-map\u2461"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": true};
window.dfnpanelData['ef4a9b44'] = {"dfnID": "ef4a9b44", "url": "https://storage.spec.whatwg.org/#storage-key-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-storage-key-origin"}, {"id": "ref-for-storage-key-origin\u2460"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['660191f0'] = {"dfnID": "660191f0", "url": "https://storage.spec.whatwg.org/#storage-shed", "dfnText": "storage shed", "refSections": [{"refs": [{"id": "ref-for-storage-shed"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['0d21247b'] = {"dfnID": "0d21247b", "url": "https://www.w3.org/TR/tracking-dnt/#dfn-tracking", "dfnText": "tracking", "refSections": [{"refs": [{"id": "ref-for-dfn-tracking"}], "title": "1. Introduction"}], "external": true};
window.dfnpanelData['cfc67fdc'] = {"dfnID": "cfc67fdc", "url": "https://url.spec.whatwg.org/#empty-host", "dfnText": "empty host", "refSections": [{"refs": [{"id": "ref-for-empty-host"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}], "external": true};
window.dfnpanelData['8ad2567a'] = {"dfnID": "8ad2567a", "url": "https://url.spec.whatwg.org/#concept-host-equals", "dfnText": "equal", "refSections": [{"refs": [{"id": "ref-for-concept-host-equals"}, {"id": "ref-for-concept-host-equals\u2460"}], "title": "6.2.4. Timers"}], "external": true};
window.dfnpanelData['752d140b'] = {"dfnID": "752d140b", "url": "https://url.spec.whatwg.org/#concept-host", "dfnText": "host", "refSections": [{"refs": [{"id": "ref-for-concept-host"}, {"id": "ref-for-concept-host\u2460"}, {"id": "ref-for-concept-host\u2461"}, {"id": "ref-for-concept-host\u2462"}], "title": "6.1.1. Global Data"}, {"refs": [{"id": "ref-for-concept-host\u2463"}, {"id": "ref-for-concept-host\u2464"}, {"id": "ref-for-concept-host\u2465"}, {"id": "ref-for-concept-host\u2466"}], "title": "6.1.2. Per-Tab Data"}, {"refs": [{"id": "ref-for-concept-host\u2467"}, {"id": "ref-for-concept-host\u2468"}], "title": "6.1.3. Constants"}, {"refs": [{"id": "ref-for-concept-host\u2460\u24ea"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-host\u2460\u2460"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-concept-host\u2460\u2461"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-concept-host\u2460\u2462"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-concept-host\u2460\u2463"}], "title": "6.2.3.4. Storage Access Monkey Patch"}, {"refs": [{"id": "ref-for-concept-host\u2460\u2464"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-concept-host\u2460\u2465"}, {"id": "ref-for-concept-host\u2460\u2466"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}, {"refs": [{"id": "ref-for-concept-host\u2460\u2467"}], "title": "6.2.4. Timers"}, {"refs": [{"id": "ref-for-concept-host\u2460\u2468"}, {"id": "ref-for-concept-host\u2461\u24ea"}, {"id": "ref-for-concept-host\u2461\u2460"}, {"id": "ref-for-concept-host\u2461\u2461"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['bc9d7803'] = {"dfnID": "bc9d7803", "url": "https://url.spec.whatwg.org/#host-registrable-domain", "dfnText": "registrable domain", "refSections": [{"refs": [{"id": "ref-for-host-registrable-domain"}], "title": "5.1.1. Safari"}, {"refs": [{"id": "ref-for-host-registrable-domain\u2460"}], "title": "6.2.5. Deletion"}], "external": true};
window.dfnpanelData['dcffbccd'] = {"dfnID": "dcffbccd", "url": "https://url.spec.whatwg.org/#concept-url", "dfnText": "url", "refSections": [{"refs": [{"id": "ref-for-concept-url"}], "title": "3. Terminology"}, {"refs": [{"id": "ref-for-concept-url\u2460"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-concept-url\u2461"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}], "external": true};
window.dfnpanelData['link-decoration'] = {"dfnID": "link-decoration", "url": "#link-decoration", "dfnText": "Link decoration", "refSections": [{"refs": [{"id": "ref-for-link-decoration"}, {"id": "ref-for-link-decoration\u2460"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-link-decoration\u2461"}, {"id": "ref-for-link-decoration\u2462"}, {"id": "ref-for-link-decoration\u2463"}, {"id": "ref-for-link-decoration\u2464"}, {"id": "ref-for-link-decoration\u2465"}, {"id": "ref-for-link-decoration\u2466"}, {"id": "ref-for-link-decoration\u2467"}], "title": "3. Terminology"}], "external": false};
window.dfnpanelData['navigational-tracking'] = {"dfnID": "navigational-tracking", "url": "#navigational-tracking", "dfnText": "Navigational tracking", "refSections": [{"refs": [{"id": "ref-for-navigational-tracking"}, {"id": "ref-for-navigational-tracking\u2460"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-navigational-tracking\u2461"}, {"id": "ref-for-navigational-tracking\u2462"}, {"id": "ref-for-navigational-tracking\u2463"}, {"id": "ref-for-navigational-tracking\u2464"}, {"id": "ref-for-navigational-tracking\u2465"}], "title": "3. Terminology"}, {"refs": [{"id": "ref-for-navigational-tracking\u2466"}], "title": "5.1. Deployed Mitigations"}, {"refs": [{"id": "ref-for-navigational-tracking\u2467"}], "title": "5.1.1. Safari"}, {"refs": [{"id": "ref-for-navigational-tracking\u2468"}], "title": "5.1.2. Firefox"}, {"refs": [{"id": "ref-for-navigational-tracking\u2460\u24ea"}, {"id": "ref-for-navigational-tracking\u2460\u2460"}], "title": "5.1.3. Brave"}], "external": false};
window.dfnpanelData['bounce-tracking'] = {"dfnID": "bounce-tracking", "url": "#bounce-tracking", "dfnText": "Bounce tracking", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking"}], "title": "3. Terminology"}], "external": false};
window.dfnpanelData['user-activation-map'] = {"dfnID": "user-activation-map", "url": "#user-activation-map", "dfnText": "user activation map", "refSections": [{"refs": [{"id": "ref-for-user-activation-map"}], "title": "6.1.1. Global Data"}, {"refs": [{"id": "ref-for-user-activation-map\u2460"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-user-activation-map\u2461"}], "title": "6.2.2. Web Authentication Monkey Patch"}, {"refs": [{"id": "ref-for-user-activation-map\u2462"}, {"id": "ref-for-user-activation-map\u2463"}, {"id": "ref-for-user-activation-map\u2464"}, {"id": "ref-for-user-activation-map\u2465"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['stateful-bounce-tracking-map'] = {"dfnID": "stateful-bounce-tracking-map", "url": "#stateful-bounce-tracking-map", "dfnText": "stateful bounce tracking map", "refSections": [{"refs": [{"id": "ref-for-stateful-bounce-tracking-map"}, {"id": "ref-for-stateful-bounce-tracking-map\u2460"}], "title": "6.1.1. Global Data"}, {"refs": [{"id": "ref-for-stateful-bounce-tracking-map\u2461"}], "title": "6.2.1. User Activation\nMonkey Patch"}, {"refs": [{"id": "ref-for-stateful-bounce-tracking-map\u2462"}, {"id": "ref-for-stateful-bounce-tracking-map\u2463"}, {"id": "ref-for-stateful-bounce-tracking-map\u2464"}, {"id": "ref-for-stateful-bounce-tracking-map\u2465"}, {"id": "ref-for-stateful-bounce-tracking-map\u2466"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['extended-navigation'] = {"dfnID": "extended-navigation", "url": "#extended-navigation", "dfnText": "extended navigation", "refSections": [{"refs": [{"id": "ref-for-extended-navigation"}, {"id": "ref-for-extended-navigation\u2460"}, {"id": "ref-for-extended-navigation\u2461"}, {"id": "ref-for-extended-navigation\u2462"}, {"id": "ref-for-extended-navigation\u2463"}, {"id": "ref-for-extended-navigation\u2464"}, {"id": "ref-for-extended-navigation\u2465"}], "title": "6.1.2. Per-Tab Data"}, {"refs": [{"id": "ref-for-extended-navigation\u2466"}], "title": "6.1.3. Constants"}, {"refs": [{"id": "ref-for-extended-navigation\u2467"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-extended-navigation\u2468"}], "title": "6.2.3.3. Service Worker Activation Monkey Patch"}, {"refs": [{"id": "ref-for-extended-navigation\u2460\u24ea"}], "title": "6.2.3.4. Storage Access Monkey Patch"}, {"refs": [{"id": "ref-for-extended-navigation\u2460\u2460"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['top-level-traversable-bounce-tracking-record'] = {"dfnID": "top-level-traversable-bounce-tracking-record", "url": "#top-level-traversable-bounce-tracking-record", "dfnText": "bounce tracking record", "refSections": [{"refs": [{"id": "ref-for-top-level-traversable-bounce-tracking-record"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2461"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2462"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-top-level-traversable-bounce-tracking-record\u2463"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2464"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-top-level-traversable-bounce-tracking-record\u2465"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2466"}], "title": "6.2.3.4. Storage Access Monkey Patch"}, {"refs": [{"id": "ref-for-top-level-traversable-bounce-tracking-record\u2467"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2468"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460\u24ea"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460\u2460"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}, {"refs": [{"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460\u2461"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460\u2462"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460\u2463"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460\u2464"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460\u2465"}, {"id": "ref-for-top-level-traversable-bounce-tracking-record\u2460\u2466"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['bounce-tracking-record'] = {"dfnID": "bounce-tracking-record", "url": "#bounce-tracking-record", "dfnText": "bounce tracking record", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-record"}], "title": "6.1.2. Per-Tab Data"}, {"refs": [{"id": "ref-for-bounce-tracking-record\u2460"}, {"id": "ref-for-bounce-tracking-record\u2461"}, {"id": "ref-for-bounce-tracking-record\u2462"}, {"id": "ref-for-bounce-tracking-record\u2463"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}], "external": false};
window.dfnpanelData['bounce-tracking-record-initial-host'] = {"dfnID": "bounce-tracking-record-initial-host", "url": "#bounce-tracking-record-initial-host", "dfnText": "initial host", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-record-initial-host"}, {"id": "ref-for-bounce-tracking-record-initial-host\u2460"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-bounce-tracking-record-initial-host\u2461"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['bounce-tracking-record-final-host'] = {"dfnID": "bounce-tracking-record-final-host", "url": "#bounce-tracking-record-final-host", "dfnText": "final host", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-record-final-host"}, {"id": "ref-for-bounce-tracking-record-final-host\u2460"}, {"id": "ref-for-bounce-tracking-record-final-host\u2461"}, {"id": "ref-for-bounce-tracking-record-final-host\u2462"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}, {"refs": [{"id": "ref-for-bounce-tracking-record-final-host\u2463"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['bounce-tracking-record-bounce-set'] = {"dfnID": "bounce-tracking-record-bounce-set", "url": "#bounce-tracking-record-bounce-set", "dfnText": "bounce set", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-record-bounce-set"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-bounce-tracking-record-bounce-set\u2460"}, {"id": "ref-for-bounce-tracking-record-bounce-set\u2461"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-bounce-tracking-record-bounce-set\u2462"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['bounce-tracking-record-storage-access-set'] = {"dfnID": "bounce-tracking-record-storage-access-set", "url": "#bounce-tracking-record-storage-access-set", "dfnText": "storage access set", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-record-storage-access-set"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-bounce-tracking-record-storage-access-set\u2460"}, {"id": "ref-for-bounce-tracking-record-storage-access-set\u2461"}], "title": "6.2.3.4. Storage Access Monkey Patch"}, {"refs": [{"id": "ref-for-bounce-tracking-record-storage-access-set\u2462"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['bounce-tracking-grace-period'] = {"dfnID": "bounce-tracking-grace-period", "url": "#bounce-tracking-grace-period", "dfnText": "bounce tracking grace period", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-grace-period"}], "title": "6.1.3. Constants"}, {"refs": [{"id": "ref-for-bounce-tracking-grace-period\u2460"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['bounce-tracking-activation-lifetime'] = {"dfnID": "bounce-tracking-activation-lifetime", "url": "#bounce-tracking-activation-lifetime", "dfnText": "bounce tracking activation lifetime", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-activation-lifetime"}], "title": "6.1.3. Constants"}, {"refs": [{"id": "ref-for-bounce-tracking-activation-lifetime\u2460"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['bounce-tracking-timer-period'] = {"dfnID": "bounce-tracking-timer-period", "url": "#bounce-tracking-timer-period", "dfnText": "bounce tracking timer period", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-timer-period"}], "title": "6.1.3. Constants"}, {"refs": [{"id": "ref-for-bounce-tracking-timer-period\u2460"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['client-bounce-detection-timer-period'] = {"dfnID": "client-bounce-detection-timer-period", "url": "#client-bounce-detection-timer-period", "dfnText": "client bounce detection timer period", "refSections": [{"refs": [{"id": "ref-for-client-bounce-detection-timer-period"}], "title": "6.1.3. Constants"}, {"refs": [{"id": "ref-for-client-bounce-detection-timer-period\u2460"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}], "external": false};
window.dfnpanelData['record-a-user-activation'] = {"dfnID": "record-a-user-activation", "url": "#record-a-user-activation", "dfnText": "record a user activation", "refSections": [{"refs": [{"id": "ref-for-record-a-user-activation"}], "title": "6.2.1. User Activation\nMonkey Patch"}], "external": false};
window.dfnpanelData['process-a-web-authentication-assertion-for-bounce-tracking-mitigations'] = {"dfnID": "process-a-web-authentication-assertion-for-bounce-tracking-mitigations", "url": "#process-a-web-authentication-assertion-for-bounce-tracking-mitigations", "dfnText": "process a Web Authentication assertion for bounce tracking mitigations", "refSections": [{"refs": [{"id": "ref-for-process-a-web-authentication-assertion-for-bounce-tracking-mitigations"}], "title": "6.2.2. Web Authentication Monkey Patch"}], "external": false};
window.dfnpanelData['process-navigation-start-for-bounce-tracking'] = {"dfnID": "process-navigation-start-for-bounce-tracking", "url": "#process-navigation-start-for-bounce-tracking", "dfnText": "process navigation start for bounce tracking", "refSections": [{"refs": [{"id": "ref-for-process-navigation-start-for-bounce-tracking"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-process-navigation-start-for-bounce-tracking\u2460"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['process-a-fetch-storage-access-for-bounce-tracking-mitigations'] = {"dfnID": "process-a-fetch-storage-access-for-bounce-tracking-mitigations", "url": "#process-a-fetch-storage-access-for-bounce-tracking-mitigations", "dfnText": "process a fetch storage access for bounce tracking mitigations", "refSections": [{"refs": [{"id": "ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations"}, {"id": "ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations\u2460"}], "title": "6.2.3.2. Network\nCookie Write Monkey Patch"}, {"refs": [{"id": "ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations\u2461"}], "title": "6.2.3.3. Service Worker Activation Monkey Patch"}], "external": false};
window.dfnpanelData['process-a-general-storage-access-for-bounce-tracking-mitigations'] = {"dfnID": "process-a-general-storage-access-for-bounce-tracking-mitigations", "url": "#process-a-general-storage-access-for-bounce-tracking-mitigations", "dfnText": "process a general storage access for bounce tracking mitigations", "refSections": [{"refs": [{"id": "ref-for-process-a-general-storage-access-for-bounce-tracking-mitigations"}], "title": "6.2.3.4. Storage Access Monkey Patch"}], "external": false};
window.dfnpanelData['process-response-received-for-bounce-tracking'] = {"dfnID": "process-response-received-for-bounce-tracking", "url": "#process-response-received-for-bounce-tracking", "dfnText": "process response received for bounce tracking", "refSections": [{"refs": [{"id": "ref-for-process-response-received-for-bounce-tracking"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-process-response-received-for-bounce-tracking\u2460"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}, {"refs": [{"id": "ref-for-process-response-received-for-bounce-tracking\u2461"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['process-document-load-for-bounce-tracking'] = {"dfnID": "process-document-load-for-bounce-tracking", "url": "#process-document-load-for-bounce-tracking", "dfnText": "process document load for bounce tracking", "refSections": [{"refs": [{"id": "ref-for-process-document-load-for-bounce-tracking"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}], "external": false};
window.dfnpanelData['bounce-tracking-timer'] = {"dfnID": "bounce-tracking-timer", "url": "#bounce-tracking-timer", "dfnText": "bounce tracking timer", "refSections": [{"refs": [{"id": "ref-for-bounce-tracking-timer"}, {"id": "ref-for-bounce-tracking-timer\u2460"}], "title": "6.1.1. Global Data"}, {"refs": [{"id": "ref-for-bounce-tracking-timer\u2461"}], "title": "6.1.3. Constants"}, {"refs": [{"id": "ref-for-bounce-tracking-timer\u2462"}, {"id": "ref-for-bounce-tracking-timer\u2463"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['record-stateful-bounces-for-bounce-tracking'] = {"dfnID": "record-stateful-bounces-for-bounce-tracking", "url": "#record-stateful-bounces-for-bounce-tracking", "dfnText": "record stateful bounces for bounce tracking", "refSections": [{"refs": [{"id": "ref-for-record-stateful-bounces-for-bounce-tracking"}, {"id": "ref-for-record-stateful-bounces-for-bounce-tracking\u2460"}], "title": "6.2.3.1. Start Navigation\nMonkey Patch"}, {"refs": [{"id": "ref-for-record-stateful-bounces-for-bounce-tracking\u2461"}], "title": "6.2.3.5. Response Received Monkey\nPatch"}, {"refs": [{"id": "ref-for-record-stateful-bounces-for-bounce-tracking\u2462"}], "title": "6.2.3.6. Document Loaded Monkey\nPatch"}], "external": false};
window.dfnpanelData['clear-cookies-for-host'] = {"dfnID": "clear-cookies-for-host", "url": "#clear-cookies-for-host", "dfnText": "clear cookies for host", "refSections": [{"refs": [{"id": "ref-for-clear-cookies-for-host"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['clear-non-cookie-storage-for-host'] = {"dfnID": "clear-non-cookie-storage-for-host", "url": "#clear-non-cookie-storage-for-host", "dfnText": "clear non-cookie storage for host", "refSections": [{"refs": [{"id": "ref-for-clear-non-cookie-storage-for-host"}], "title": "6.2.4. Timers"}], "external": false};
window.dfnpanelData['clear-cache-for-host'] = {"dfnID": "clear-cache-for-host", "url": "#clear-cache-for-host", "dfnText": "clear cache for host", "refSections": [{"refs": [{"id": "ref-for-clear-cache-for-host"}], "title": "6.2.4. Timers"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
/*
Color-choosing design:

Colors are ordered by goodness.
Each color has a usage count (initially zero).
Each variable has a last-used color.

* If the var has a last-used color, and that color's usage is 0,
    return that color.
* Otherwise, return the lowest-indexed color with the lowest usage.
    Increment the color's usage and set it as the last-used color
    for that var.
* On unclicking, decrement usage of the color.
*/
"use strict";
{
    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    const indexCounts = new Map();
    const indexNames = new Map();
    function highlightSameAlgoVars(v) {
        // Find the algorithm container.
        let algoContainer = null;
        let searchEl = v;
        while(algoContainer == null && searchEl != document.body) {
            searchEl = searchEl.parentNode;
            if(searchEl.hasAttribute("data-algorithm")) {
                algoContainer = searchEl;
            }
        }

        // Not highlighting document-global vars,
        // too likely to be unrelated.
        if(algoContainer == null) return;

        const algoName = algoContainer.getAttribute("data-algorithm");
        const varName = getVarName(v);
        const addClass = !v.classList.contains("selected");
        let highlightClass = null;
        if(addClass) {
            const index = chooseHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] += 1;
            indexNames.set(algoName+"///"+varName, index);
            highlightClass = nameFromIndex(index);
        } else {
            const index = previousHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] -= 1;
            highlightClass = nameFromIndex(index);
        }

        // Find all same-name vars, and toggle their class appropriately.
        for(const el of algoContainer.querySelectorAll("var")) {
            if(getVarName(el) == varName) {
                el.classList.toggle("selected", addClass);
                el.classList.toggle(highlightClass, addClass);
            }
        }
    }
    function getVarName(el) {
        return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
    }
    function chooseHighlightIndex(algoName, varName) {
        let indexes = null;
        if(indexCounts.has(algoName)) {
            indexes = indexCounts.get(algoName);
        } else {
            // 7 classes right now
            indexes = [0,0,0,0,0,0,0];
            indexCounts.set(algoName, indexes);
        }

        // If the element was recently unclicked,
        // *and* that color is still unclaimed,
        // give it back the same color.
        const lastIndex = previousHighlightIndex(algoName, varName);
        if(indexes[lastIndex] === 0) return lastIndex;

        // Find the earliest index with the lowest count.
        const minCount = Math.min.apply(null, indexes);
        let index = null;
        for(var i = 0; i < indexes.length; i++) {
            if(indexes[i] == minCount) {
                return i;
            }
        }
    }
    function previousHighlightIndex(algoName, varName) {
        return indexNames.get(algoName+"///"+varName);
    }
    function nameFromIndex(index) {
        return "selected" + index;
    }
}
</script>