<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <title>Navigational-Tracking Mitigations</title>
  <meta content="width=device-width" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 3febb7930, updated Tue Oct 15 11:33:47 2024 -0700" name="generator">
  <link href="https://privacycg.github.io/nav-tracking-mitigations/" rel="canonical">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="25abc2b4100c049d38e71482b358644c6ce444a2" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
#example-link-decoration-tracking code em {background-color: cyan}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body>
  <header>
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="no-ref" id="title">Navigational-Tracking Mitigations</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time datetime="2024-10-21">21 October 2024</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Participate:
     <dd><a href="https://github.com/privacycg/nav-tracking-mitigations">Github Repository</a>
     <dd><a href="https://github.com/privacycg/meetings/">Privacy CG Meetings</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/privacycg/nav-tracking-mitigations/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="109401"><a class="p-name fn u-email email" href="mailto:psnyder@brave.com">Pete Snyder</a> (<a class="p-org org" href="https://brave.com/">Brave</a>)
     <dd class="editor p-author h-card vcard" data-editor-id="72192"><a class="p-name fn u-email email" href="mailto:jyasskin@google.com">Jeffrey Yasskin</a> (<a class="p-org org" href="https://google.com/">Google</a>)
     <dt>This version:
     <dd><a class="u-url" href="https://privacycg.github.io/nav-tracking-mitigations/">https://privacycg.github.io/nav-tracking-mitigations/</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2024 the Contributors to “Navigational-Tracking Mitigations”, published by the <a href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.

This document is licensed under the <a href="http://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">W3C Software and Document License</a>.

Contributions to this document are made under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. </p>
   <hr title="Separator for header">
  </header>
  <div data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines navigational tracking and when and how browsers are required to prevent it from happening.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>This specification is intended to be migrated to the W3C standards track. It is not a W3C standard.</p>
   <p>It was published by the <a href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.
Please note that under the <a href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.
Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#infra"><span class="secno">2</span> <span class="content">Infrastructure</span></a>
    <li><a href="#terminology"><span class="secno">3</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#threat-model"><span class="secno">4</span> <span class="content">Threat model</span></a>
     <ol class="toc">
      <li><a href="#threat-actors"><span class="secno">4.1</span> <span class="content">Threat actors</span></a>
     </ol>
    <li>
     <a href="#alternatives"><span class="secno">5</span> <span class="content">Considered Alternatives</span></a>
     <ol class="toc">
      <li>
       <a href="#deployed-mitigations"><span class="secno">5.1</span> <span class="content">Deployed Mitigations</span></a>
       <ol class="toc">
        <li><a href="#mitigations-safari"><span class="secno">5.1.1</span> <span class="content">Safari</span></a>
        <li><a href="#mitigations-firefox"><span class="secno">5.1.2</span> <span class="content">Firefox</span></a>
        <li><a href="#mitigations-brave"><span class="secno">5.1.3</span> <span class="content">Brave</span></a>
       </ol>
     </ol>
    <li>
     <a href="#bounce-tracking-mitigations"><span class="secno">6</span> <span class="content">Bounce Tracking Mitigations</span></a>
     <ol class="toc">
      <li>
       <a href="#bounce-tracking-mitigations-data-model"><span class="secno">6.1</span> <span class="content">Data Model</span></a>
       <ol class="toc">
        <li><a href="#bounce-tracking-mitigations-data-model-global"><span class="secno">6.1.1</span> <span class="content">Global Data</span></a>
        <li><a href="#bounce-tracking-mitigations-data-model-per-tab"><span class="secno">6.1.2</span> <span class="content">Per-Tab Data</span></a>
        <li><a href="#bounce-tracking-mitigations-data-model-constants"><span class="secno">6.1.3</span> <span class="content">Constants</span></a>
       </ol>
      <li>
       <a href="#bounce-tracking-mitigations-algorithms"><span class="secno">6.2</span> <span class="content">Algorithms</span></a>
       <ol class="toc">
        <li><a href="#bounce-tracking-mitigations-activation-monkey-patch"><span class="secno">6.2.1</span> <span class="content">User Activation
Monkey Patch</span></a>
        <li><a href="#bounce-tracking-mitigations-web-authentication-monkey-patch"><span class="secno">6.2.2</span> <span class="content">Web Authentication Monkey Patch</span></a>
        <li>
         <a href="#bounce-tracking-mitigation-stateful-bounce-detection"><span class="secno">6.2.3</span> <span class="content">Stateful Bounce
Detection</span></a>
         <ol class="toc">
          <li><a href="#bounce-tracking-mitigations-nav-start-monkey-patch"><span class="secno">6.2.3.1</span> <span class="content">Start Navigation
Monkey Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-network-cookie-write-monkey-patch"><span class="secno">6.2.3.2</span> <span class="content">Network
Cookie Write Monkey Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-service-worker-activation-monkey-patch"><span class="secno">6.2.3.3</span> <span class="content">Service Worker Activation Monkey Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-storage-access-monkey-patch"><span class="secno">6.2.3.4</span> <span class="content">Storage Access Monkey Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-response-received-monkey-patch"><span class="secno">6.2.3.5</span> <span class="content">Response Received Monkey
Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-document-load-monkey-patch"><span class="secno">6.2.3.6</span> <span class="content">Document Loaded Monkey
Patch</span></a>
          <li><a href="#bounce-tracking-mitigations-navigation-state-diagram"><span class="secno">6.2.3.7</span> <span class="content">Navigation State Diagram</span></a>
         </ol>
        <li><a href="#bounce-tracking-mitigations-timers"><span class="secno">6.2.4</span> <span class="content">Timers</span></a>
        <li><a href="#bounce-tracking-mitigations-deletion"><span class="secno">6.2.5</span> <span class="content">Deletion</span></a>
       </ol>
      <li>
       <a href="#bounce-tracking-mitigations-automation"><span class="secno">6.3</span> <span class="content">User Agent Automation</span></a>
       <ol class="toc">
        <li><a href="#run-bounce-tracking-mitigations-command"><span class="secno">6.3.1</span> <span class="content">Run Bounce Tracking Mitigations</span></a>
       </ol>
     </ol>
    <li><a href="#privacy-and-security-considerations"><span class="secno">7</span> <span class="content">Privacy and Security Considerations</span></a>
    <li><a href="#acknowledgements"><span class="secno"></span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section class="non-normative">
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>Browsers are working to prevent cross-site <a data-link-type="dfn" href="https://www.w3.org/TR/tracking-dnt/#dfn-tracking" id="ref-for-dfn-tracking">tracking</a>, which threatens user
privacy. In addition to third-party cookies and storage, other client-side
methods exist that enable cross-site tracking. <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking">Navigational tracking</a> correlates user identities across sites during navigations between those sites. <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①">Navigational tracking</a> uses <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration">link decoration</a> to convey information, but
not all <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration①">link decoration</a> is tracking. This project attempts to distinguish
tracking from non-tracking navigation and to prevent the tracking without
damaging similar but benign navigations.</p>
   </section>
   <h2 class="heading settled" data-level="2" id="infra"><span class="secno">2. </span><span class="content">Infrastructure</span><a class="self-link" href="#infra"></a></h2>
   <p>This specification depends on the Infra standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
   <h2 class="heading settled" data-level="3" id="terminology"><span class="secno">3. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="link-decoration">Link decoration</dfn> is when the source of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#hyperlink" id="ref-for-hyperlink">hyperlink</a> "decorates" its <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a> with extra information beyond what’s necessary to identify the page a user wants
to navigate to. This information can be placed almost anywhere inside the URL.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="navigational-tracking">Navigational tracking</dfn> refers to the general use of one or more <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigating-across-documents">navigations</a> to identify that a user on one
site is the same person as a user on another site. Navigations transmit information
cross-site in a few different ways, including in the target URL, which might be <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration②">decorated</a>, and in the timing of the request.</p>
   <div class="example" id="example-link-decoration-tracking">
    <a class="self-link" href="#example-link-decoration-tracking"></a> 
    <p>Examples and non-examples of <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration③">link decoration</a> and <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking②">navigational tracking</a>,
with the potential decoration or tracking element emphasized:</p>
    <dl>
     <dt data-md><code>https://publisher.example/page?userId=<em>5789rhkdsaf8urfnsd</em></code>
     <dd data-md>
      <p><a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration④">Link decoration</a>, and also <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking③">navigational tracking</a>.</p>
     <dt data-md><code>https://bookshop.org/a/<em>1122</em>/9780062252074</code>
     <dd data-md>
      <p><a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑤">Link decoration</a> but <strong>not</strong> <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking④">navigational tracking</a>: This number
identifies an affiliate to credit with a book sale. Replacing this with
another number gets to the same target page.</p>
     <dt data-md><code>https://bookshop.org/a/1122/<em>9780062252074</em></code>
     <dd data-md>
      <p><strong>Not</strong> decoration: This number identifies a particular book. Changing it
yields a different target page.</p>
     <dt data-md><code>https://bugzilla.mozilla.org/show_bug.cgi?id=<em>1460058</em></code>
     <dd data-md>
      <p><strong>Not</strong> decoration: changing the number changes which bug the user sees.</p>
     <dt data-md><code>https://www.google.com/maps/@<em>37.4220328,-122.0847584,17.12z</em></code>
     <dd data-md>
      <p class="issue" id="issue-9458c4e5"><a class="self-link" href="#issue-9458c4e5"></a> Changing the numbers changes what map the user sees, and embedding
a user ID would not successfully transfer that user ID to the target site,
but it’s hard for an automated system inside a browser to prove
that, and even hard for humans reading the URL to be confident of it. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/4">[Issue #4]</a></p>
     <dt data-md><code>https://publisher.example/unsubscribe?userId=<em>5789rhkdsaf8urfnsd</em></code>
     <dd data-md>
      <p class="issue" id="issue-fc2127e1"><a class="self-link" href="#issue-fc2127e1"></a> The URL identifies an action rather than a page, and the user ID
might be essential for that action to happen. However, this is also clearly
a user ID and sufficient to track a user if the source and target
collaborate. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a></p>
     <dt data-md><code>https://example.com/auth/callback?token=<em>1234567</em></code>
     <dd data-md>
      <p class="issue" id="issue-0c501704"><a class="self-link" href="#issue-0c501704"></a> This is probably the same case as the unsubscribe link. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a></p>
     <dt data-md><code>https://example.com/login?returnto=<em>item/12345</em></code>
     <dd data-md>
      <p>Assuming a request for this URL shows a login page instead of immediately
redirecting to <code>item/12345</code>, this is a <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑥">link decoration</a> but not <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑤">navigational tracking</a>.</p>
    </dl>
   </div>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking">Bounce tracking</dfn> refers to the use of redirects in a top-level context
(including <a data-link-type="dfn" href="https://httpwg.org/specs/rfc7231.html#status.3xx" id="ref-for-status.3xx">HTTP 3xx statuses</a>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta">meta</a></code> elements with <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv" id="ref-for-attr-meta-http-equiv">http-equiv</a></code>=<code><a data-link-type="attr-value" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh" id="ref-for-attr-meta-http-equiv-keyword-refresh">refresh</a></code> attributes, and script-directed
navigation that doesn’t wait for user input) along with <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑦">link decoration</a> to
join user identities between sites. <a data-link-type="dfn" href="#bounce-tracking" id="ref-for-bounce-tracking">Bounce tracking</a> is a subset of <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑥">navigational tracking</a> and can include automated navigation through the same
or different sites from the source or ultimate destination of a link.</p>
   <div class="example" id="example-bounce-tracking-to-self">
    <a class="self-link" href="#example-bounce-tracking-to-self"></a> 
    <p>Tracking via a bounce through an aggregation domain:</p>
    <ol>
     <li data-md>
      <p>The content publisher’s page (on <code>publisher.example</code>) embeds a third-party
script from <code>tracker.example</code>.</p>
     <li data-md>
      <p>The third-party script tries to read an already-stored identifier, for
example one it has set into <code>publisher.example</code>’s storage or one read from a
third-party <code>tracker.example</code> <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>.</p>
     <li data-md>
      <p>If it can’t, it redirects the top level page to <code>tracker.example</code> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location" id="ref-for-dom-location">window.location</a></code>.</p>
     <li data-md>
      <p>During this load <code>tracker.example</code> is the first party and can read and write
its cookie jar.</p>
     <li data-md>
      <p><code>tracker.example</code> redirects back to the original page URL, with that URL <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑧">decorated</a> with its user ID in a query parameter.</p>
     <li data-md>
      <p>The <code>tracker.example</code> user ID is now available on <code>publisher.example</code> and can
be saved into its first-party storage so that future visits don’t need to
bounce.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="4" id="threat-model"><span class="secno">4. </span><span class="content">Threat model</span><a class="self-link" href="#threat-model"></a></h2>
   <p>This section will precisely define the goals and non-goals of this
specification’s mitigations. It will define a few classes of actors with the
ability to modify websites in particular ways. Then it will define what
cross-site information each of these actors can or cannot learn.</p>
   <h3 class="heading settled" data-level="4.1" id="threat-actors"><span class="secno">4.1. </span><span class="content">Threat actors</span><a class="self-link" href="#threat-actors"></a></h3>
   <p>TODO</p>
   <section class="informative">
    <h2 class="heading settled" data-level="5" id="alternatives"><span class="secno">5. </span><span class="content">Considered Alternatives</span><a class="self-link" href="#alternatives"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>So far, the alternative designs consist of mitigations that various browsers
have already deployed.</p>
    <h3 class="heading settled" data-level="5.1" id="deployed-mitigations"><span class="secno">5.1. </span><span class="content">Deployed Mitigations</span><a class="self-link" href="#deployed-mitigations"></a></h3>
    <p>Some browsers have deployed and announced protections against <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑦">navigational tracking</a>. This section is a work in progress to detail what
protections have been shipped and / or are planned. This section is not
comprehensive.</p>
    <h4 class="heading settled" data-level="5.1.1" id="mitigations-safari"><span class="secno">5.1.1. </span><span class="content">Safari</span><a class="self-link" href="#mitigations-safari"></a></h4>
    <p>Safari uses an algorithmic approach to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑧">navigational tracking</a>. Safari
classifies a site as having cross-site tracking capabilities if the <a href="https://webkit.org/tracking-prevention/#classification-as-having-cross-site-tracking-capabilities">following
criteria</a> are met within a particular client:</p>
    <ul>
     <li data-md>
      <p>The site appears as a third-party resource under enough different <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain">registrable domains</a>.</p>
     <li data-md>
      <p>The site automatically redirects the user to enough other sites, immediately
or after a short delay.</p>
     <li data-md>
      <p>The site redirects to sites that are classified as trackers, recursively.</p>
      <div class="example" id="example-safari-recursive-trackers">
       <a class="self-link" href="#example-safari-recursive-trackers"></a> 
       <p>For example, consider the case of a user clicking on a link on <code>start.example</code>, which redirects to <code>second.example</code>, which redirects to <code>third.example</code>, which redirects to <code>end.example</code>. If Safari has classified <code>third.example</code> as having tracking capabilities, the above behavior can
result in Safari classifying <code>second.example</code> as having cross-site tracking
capabilities.</p>
      </div>
    </ul>
    <p>If a user navigates or is redirected from a classified tracker with a URL that
includes either query parameters or a URL fragment, the lifetime of client-side
set cookies on the <em>destination</em> page is capped at <a href="https://webkit.org/tracking-prevention/#detection-of-cross-site-tracking-via-link-decoration">24
hours</a>.</p>
    <h4 class="heading settled" data-level="5.1.2" id="mitigations-firefox"><span class="secno">5.1.2. </span><span class="content">Firefox</span><a class="self-link" href="#mitigations-firefox"></a></h4>
    <p>Firefox uses a list-based approach to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑨">navigational tracking</a>. Sites on the
Disconnect list are considered tracking sites. All storage
for tracking sites is cleared after 24 hours, unless the user has interacted
with the site in the first-party context in the last 45 days.</p>
    <p>Firefox is also starting to remove query parameters known to be used for
cross-site tracking. (<a data-link-type="biblio" href="#biblio-fsn-2021-q4" title="Firefox Security Newsletter 2021 Q4">[FSN-2021-Q4]</a>) The affected query parameters are chosen
using the criteria on the <a data-biblio-display="inline" data-link-type="biblio" href="https://wiki.mozilla.org/Security/Anti_tracking_policy"><cite>Mozilla Anti Tracking Policy</cite></a>, which includes:</p>
    <ul>
     <li data-md>
      <p>High-entropy parameters that might identify a user or encode user data,
except:</p>
      <ul>
       <li data-md>
        <p>Parameters exclusively identifying specific elements or actions on the
navigating page (per-click or per-element identifiers), as long as those
parameters assign a different value to each click or element they are
identifying.</p>
       <li data-md>
        <p>Identifiers necessary to complete a user-initiated task such as logging in
or submitting a form.</p>
      </ul>
     <li data-md>
      <p>High-entropy parameters that are broadly included in nearly all outgoing
navigations from a site, even if the parameters don’t uniquely identify a
user.</p>
    </ul>
    <p>As of May 2022, this query-parameter stripping is applied by default in the
Firefox Nightly build, and planned to be enabled in strict <abbr title="Enhanced Tracking Protection">ETP</abbr> mode and in private browsing.</p>
    <h4 class="heading settled" data-level="5.1.3" id="mitigations-brave"><span class="secno">5.1.3. </span><span class="content">Brave</span><a class="self-link" href="#mitigations-brave"></a></h4>
     Brave uses four list-based approaches to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①⓪">navigational tracking</a>. 
    <p>First, Brave strips query parameters commonly used for <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①①">navigational tracking</a> from URLs on navigation. This list is maintained by Brave.</p>
    <p>Second, by default, when i) the user is about to visit a list-identified
bounce-tracking URL, and ii) the current profile does not contain any cookies
or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage" id="ref-for-dom-localstorage">localStorage</a></code> for that site, Brave will create a new, "ephemeral", empty storage
area for the site. This storage area persists as long as the user has
any top-level frames open for the site. As soon as the user has no
top-level frames for the labeled bounce-tracking site, the ephemeral storage
area is deleted.</p>
    <p>Third, in the non-default, "aggressive blocking" configuration, Brave uses
popular crowd-sourced filter lists (e.g., EasyList, EasyPrivacy, uBlock Origin)
to identify URLs that are used for bounce tracking, and will preempt the
navigation with an interstitial (similar to Google SafeBrowsing), giving
the user the option to continue the navigation or cancel it.</p>
    <p>Fourth, Brave uses a list-based approach for identifying bounce tracking
URLs where the destination URL is present in the URL of the intermediate
tracking URL. In such cases, Brave will skip the intermediate navigation
and request the destination URL instead. For example, if Brave
Browser observes the user about to navigate to the URL <code>https://tracker.example/bounce?dest=https://destination.example/</code>,
the browser might replace the navigation to <code>tracker.example/bounce</code>,
with a navigation to <code>https://destination.example/</code>. This list
is maintained by Brave, and is drawn from a mix of crowd-sourcing and
existing open-source projects.</p>
   </section>
   <h2 class="heading settled" data-level="6" id="bounce-tracking-mitigations"><span class="secno">6. </span><span class="content">Bounce Tracking Mitigations</span><a class="self-link" href="#bounce-tracking-mitigations"></a></h2>
   <p>The content of this section will provide a "monkey patch" specification for bounce tracking
mitigations.  There is a <a href="https://github.com/privacycg/nav-tracking-mitigations/blob/main/bounce-tracking-explainer.md">Chromium-oriented
explainer</a> for this work, but the text in this section is intended for adoption across all browsers. This
section is not complete yet, and as the algorithms are developed, they will be specified here and
presented for review.</p>
   <p>This spec is written for the case where the following features are enabled:</p>
   <ul>
    <li data-md>
     <p>All third-party cookies are blocked.</p>
    <li data-md>
     <p>All cookies written by embedded third-party sites are partitioned.</p>
    <li data-md>
     <p>All storage written by embedded third-party sites is partitioned.</p>
   </ul>
   <p class="note" role="note"> The following is a work-in-progress and does not yet reflect any consensus in
the PrivacyCG. </p>
   <h3 class="heading settled" data-level="6.1" id="bounce-tracking-mitigations-data-model"><span class="secno">6.1. </span><span class="content">Data Model</span><a class="self-link" href="#bounce-tracking-mitigations-data-model"></a></h3>
   <h4 class="heading settled" data-level="6.1.1" id="bounce-tracking-mitigations-data-model-global"><span class="secno">6.1.1. </span><span class="content">Global Data</span><a class="self-link" href="#bounce-tracking-mitigations-data-model-global"></a></h4>
   <p>The user agent holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="user-activation-map">user activation map</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host">hosts</a> to <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment">moments</a>.  The <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment①">moments</a> represent the most recent <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock">wall clock</a> time at which the user activated a top-level document on the
associated <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①">host</a>.</p>
   <p>The user agent holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateful-bounce-tracking-map">stateful bounce tracking map</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site②">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②">hosts</a> to <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment②">moments</a>.  The <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment③">moments</a> represent the
first <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock①">wall clock</a> time since the last execution of the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer">bounce tracking timer</a> at which a page on the given <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site③">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host③">host</a> performed
an action that could indicate stateful bounce tracking took place.  For example,
if <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer①">bounce tracking timer</a> ran at time X and bounces occurred at times X-1,
X+1, and X+2, then the map value would be X+1.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Schemeless site is used as the data structure key because by default cookies
are sent to both <code>http://</code> and <code>https://</code> pages on the same domain.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Hosts are eagerly removed from the <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map">stateful bounce tracking map</a> when
a user activation occurs.  This means that a given host can exist in either the <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map">user activation map</a> or <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map①">stateful bounce tracking map</a>, but not both at
the same time.  The maps will have non-overlapping sets of keys.</p>
   <h4 class="heading settled" data-level="6.1.2" id="bounce-tracking-mitigations-data-model-per-tab"><span class="secno">6.1.2. </span><span class="content">Per-Tab Data</span><a class="self-link" href="#bounce-tracking-mitigations-data-model-per-tab"></a></h4>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="extended-navigation">extended navigation</dfn> is a contiguous sequence of navigations within a single <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable">top-level traversable</a>,
joined by client-side redirects, which the user agent expects its user to perceive as a single operation.</p>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable①">top-level traversable</a> has an associated <dfn class="dfn-paneled" data-dfn-for="top-level traversable" data-dfn-type="dfn" data-noexport id="top-level-traversable-bounce-tracking-record">bounce tracking record</dfn> which is a <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record">bounce tracking record</a> or null. This stores the data relevant
to bounce tracking enforcement for every <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation">extended navigation</a>.
It is non-null during an <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation①">extended navigation</a> and returns to null when the UA stops waiting for further
client-side redirects that might extend the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation②">extended navigation</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-record">bounce tracking record</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> whose items are:</p>
   <dl>
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-initial-host">initial host</dfn>
    <dd>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site④">site</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host④">host</a>. The initiator site of the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation③">extended navigation</a>.
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-final-host">final host</dfn>
    <dd>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑤">site</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑤">host</a> or null. The destination of the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation④">extended navigation</a>. Updated after every document load.
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-bounce-set">bounce set</dfn>
    <dd>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑥">sites</a>' <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑥">hosts</a>. All server-side and client-side redirects hit during this <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑤">extended navigation</a>.
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-storage-access-set">storage access set</dfn>
    <dd>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑦">sites</a>' <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑦">hosts</a>. All sites which accessed storage during this <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑥">extended navigation</a>.
    <dt><dfn class="dfn-paneled" data-dfn-for="bounce tracking record" data-dfn-type="dfn" data-noexport id="bounce-tracking-record-user-activation-set">user activation set</dfn>
    <dd>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑧">sites</a>' <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑧">hosts</a>. All sites which received a user activation during this <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑦">extended navigation</a>.
   </dl>
   <h4 class="heading settled" data-level="6.1.3" id="bounce-tracking-mitigations-data-model-constants"><span class="secno">6.1.3. </span><span class="content">Constants</span><a class="self-link" href="#bounce-tracking-mitigations-data-model-constants"></a></h4>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-grace-period">bounce tracking grace period</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration">duration</a> that represents the length of time after a possible bounce tracking
event during which the user agent will wait for an interaction before deleting a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑨">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host⑨">host</a>'s storage.</p>
   <p class="note" role="note"><span class="marker">Note:</span> 1 hour is a reasonable <a data-link-type="dfn" href="#bounce-tracking-grace-period" id="ref-for-bounce-tracking-grace-period">bounce tracking grace period</a> value.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-activation-lifetime">bounce tracking activation lifetime</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration①">duration</a> that represents how long user
activations will protect a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①⓪">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⓪">host</a> from storage deletion.</p>
   <p class="note" role="note"><span class="marker">Note:</span> 45 days is a reasonable <a data-link-type="dfn" href="#bounce-tracking-activation-lifetime" id="ref-for-bounce-tracking-activation-lifetime">bounce tracking activation lifetime</a> value.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-timer-period">bounce tracking timer period</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined②">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration②">duration</a> that represents how often to run the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer②">bounce tracking timer</a> algorithm.</p>
   <p class="note" role="note"><span class="marker">Note:</span> 1 hour is a reasonable <a data-link-type="dfn" href="#bounce-tracking-timer-period" id="ref-for-bounce-tracking-timer-period">bounce tracking timer period</a> value.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="client-bounce-detection-timer-period">client bounce detection timer period</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined③">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration③">duration</a> that represents how long to wait for a client redirect after a navigation ends.
The purpose is to catch all automated page-triggered redirects, which should be appended to
the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑧">extended navigation</a>, with high probability.</p>
   <p class="note" role="note"><span class="marker">Note:</span> 10 seconds is a reasonable <a data-link-type="dfn" href="#client-bounce-detection-timer-period" id="ref-for-client-bounce-detection-timer-period">client bounce detection timer period</a> value.</p>
   <h3 class="heading settled" data-level="6.2" id="bounce-tracking-mitigations-algorithms"><span class="secno">6.2. </span><span class="content">Algorithms</span><a class="self-link" href="#bounce-tracking-mitigations-algorithms"></a></h3>
   <h4 class="heading settled" data-level="6.2.1" id="bounce-tracking-mitigations-activation-monkey-patch"><span class="secno">6.2.1. </span><span class="content">User Activation
Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-activation-monkey-patch"></a></h4>
   <div class="algorithm" data-algorithm="record a user activation">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="record-a-user-activation">record a user activation</dfn> given a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">Document</a> <var>document</var>, perform
the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable">node navigable</a>.</p>
     <li data-md>
      <p>If <var>navigable</var> is null, then abort these steps.</p>
     <li data-md>
      <p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable②">top-level traversable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document">active document</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>topDocument</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque">opaque origin</a> then abort these steps.</p>
     <li data-md>
      <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site">obtain a site</a> given <var>origin</var>.</p>
     <li data-md>
      <p>Let <var>host</var> be <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①①">host</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove">Remove</a> <var>host</var> from the <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map②">stateful bounce tracking map</a>.</p>
     <li data-md>
      <p>Set <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map①">user activation map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time">current wall time</a>.</p>
     <li data-md>
      <p>If <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record">bounce tracking record</a> is not null:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>host</var> to <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set">storage access set</a>.</p>
      </ol>
    </ol>
   </div>
   <p>Append the following steps to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#activation-notification" id="ref-for-activation-notification">activation notification</a> steps in the <a href="https://html.spec.whatwg.org/multipage/interaction.html#user-activation-processing-model">user activation processing
model</a>:</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#record-a-user-activation" id="ref-for-record-a-user-activation">record a user activation</a> given <var>document</var>.</p>
   </ol>
   <h4 class="heading settled" data-level="6.2.2" id="bounce-tracking-mitigations-web-authentication-monkey-patch"><span class="secno">6.2.2. </span><span class="content">Web Authentication Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-web-authentication-monkey-patch"></a></h4>
   <p>A successful credential access, using the Web Authentication API, is also treated as a user activation for bounce-tracking purposes.</p>
   <p>Add the following argument to <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#publickeycredential" id="ref-for-publickeycredential">PublicKeyCredential</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot" id="ref-for-dom-publickeycredential-discoverfromexternalsource-slot">[[DiscoverFromExternalSource]]()</a></code> algorithm:</p>
   <dl>
    <dt>browsingContext
    <dd>The caller’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment" id="ref-for-environment">environment’s</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context">target browsing context</a>
   </dl>
   <p>Insert the following steps in the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot" id="ref-for-dom-publickeycredential-discoverfromexternalsource-slot①">[[DiscoverFromExternalSource]]()</a></code> algorithm
    in step 17, under "If any authenticator indicates success":</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-a-web-authentication-assertion-for-bounce-tracking-mitigations" id="ref-for-process-a-web-authentication-assertion-for-bounce-tracking-mitigations">process a Web Authentication assertion for bounce tracking mitigations</a> given <var>callerOrigin</var> and <var>browsingContext</var>.</p>
   </ol>
   <div class="algorithm" data-algorithm="process a Web Authentication assertion for bounce tracking mitigations">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-a-web-authentication-assertion-for-bounce-tracking-mitigations">process a Web Authentication assertion for bounce tracking mitigations</dfn> given
    a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context">browsing context</a> <var>browsingContext</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>browsingContext</var> is null, then abort these steps.</p>
     <li data-md>
      <p>Let <var>topDocument</var> be <var>browsingContext</var>’s active document.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>topDocument</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin①">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque①">opaque origin</a> then abort these steps.</p>
     <li data-md>
      <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site①">obtain a site</a> given <var>origin</var>.</p>
     <li data-md>
      <p>Let <var>host</var> be <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①②">host</a>.</p>
     <li data-md>
      <p>Set <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map②">user activation map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time①">current wall time</a>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> It’s also reasonable to treat signin to a browser-integrated account as a user activation for
    bounce-tracking purposes. Such an interaction could be stored in the <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map③">user activation map</a> for the host of the identity provider and/or the host domain of the account.</p>
   <h4 class="heading settled" data-level="6.2.3" id="bounce-tracking-mitigation-stateful-bounce-detection"><span class="secno">6.2.3. </span><span class="content">Stateful Bounce
Detection</span><a class="self-link" href="#bounce-tracking-mitigation-stateful-bounce-detection"></a></h4>
   <h5 class="heading settled" data-level="6.2.3.1" id="bounce-tracking-mitigations-nav-start-monkey-patch"><span class="secno">6.2.3.1. </span><span class="content">Start Navigation
Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-nav-start-monkey-patch"></a></h5>
   <p>At the start of a navigation, either initialize a new <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record①">bounce tracking record</a>,
or append a client-side redirect to the current <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record②">bounce tracking record</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate">navigate</a> algorithm before step 8,
"Navigate to a fragment given navigable, url, historyHandling, and navigationId."</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-navigation-start-for-bounce-tracking" id="ref-for-process-navigation-start-for-bounce-tracking">process navigation start for bounce tracking</a> given <var>navigable</var>, <var>sourceDocument</var>, and <var>sourceSnapshotParams</var>.</p>
   </ol>
   <div class="algorithm" data-algorithm="process navigation start for bounce tracking">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-navigation-start-for-bounce-tracking">process navigation start for bounce tracking</dfn> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#navigable" id="ref-for-navigable">navigable</a> <var>navigable</var>, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">Document</a> <var>sourceDocument</var>, and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params" id="ref-for-source-snapshot-params">source snapshot params</a> <var>sourceSnapshotParams</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>navigable</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable③">top-level traversable</a>, then abort these steps.</p>
     <li data-md>
      <p>Remove any queued global tasks to <a data-link-type="dfn" href="#record-stateful-bounces-for-bounce-tracking" id="ref-for-record-stateful-bounces-for-bounce-tracking">record stateful bounces for bounce tracking</a> from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source" id="ref-for-networking-task-source">networking task source</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>sourceDocument</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin②">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque②">opaque origin</a>, set <var>initialHost</var> to <a data-link-type="dfn" href="https://url.spec.whatwg.org/#empty-host" id="ref-for-empty-host">empty host</a>.</p>
     <li data-md>
      <p>Otherwise,</p>
      <ol>
       <li data-md>
        <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site②">obtain a site</a> given <var>origin</var>.</p>
       <li data-md>
        <p>Set <var>initialHost</var> to <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①③">host</a>.</p>
      </ol>
     <li data-md>
      <p>If <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record②">bounce tracking record</a> is null:</p>
      <ol>
       <li data-md>
        <p>Set <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record③">bounce tracking record</a> to a new <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record③">bounce tracking record</a> with <a data-link-type="dfn" href="#bounce-tracking-record-initial-host" id="ref-for-bounce-tracking-record-initial-host">initial host</a> set to <var>initialHost</var>.</p>
      </ol>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> This includes the case where the current navigation was initiated by another navigable, e.g. when opening
    a link in a new tab. In this case, <var>sourceDocument</var> is set to the opener Document, and the new bounce tracking
    record has its <a data-link-type="dfn" href="#bounce-tracking-record-initial-host" id="ref-for-bounce-tracking-record-initial-host①">initial host</a> set to the opener host. This ensures that trackers opened
    in new tabs are detected as distinct from the <a data-link-type="dfn" href="#bounce-tracking-record-initial-host" id="ref-for-bounce-tracking-record-initial-host②">initial host</a> in the new <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record④">bounce tracking record</a>.</p>
    <ol>
     <li data-md>
      <p>Otherwise,</p>
      <ol>
       <li data-md>
        <p>If <var>sourceSnapshotParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation" id="ref-for-source-snapshot-params-activation">has transient activation</a> is true:</p>
        <ol>
         <li data-md>
          <p>Run <a data-link-type="dfn" href="#record-stateful-bounces-for-bounce-tracking" id="ref-for-record-stateful-bounces-for-bounce-tracking①">record stateful bounces for bounce tracking</a> given <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document①">active document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a>.</p>
         <li data-md>
          <p>Set <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record④">bounce tracking record</a> to a new <a data-link-type="dfn" href="#bounce-tracking-record" id="ref-for-bounce-tracking-record⑤">bounce tracking record</a> with <a data-link-type="dfn" href="#bounce-tracking-record-initial-host" id="ref-for-bounce-tracking-record-initial-host③">initial host</a> set to <var>initialHost</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①">Append</a> <var>initialHost</var> to <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑤">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-user-activation-set" id="ref-for-bounce-tracking-record-user-activation-set">user activation set</a>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, add <var>initialHost</var> to <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑥">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-bounce-set" id="ref-for-bounce-tracking-record-bounce-set">bounce set</a>.</p>
      </ol>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.3.2" id="bounce-tracking-mitigations-network-cookie-write-monkey-patch"><span class="secno">6.2.3.2. </span><span class="content">Network
Cookie Write Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-network-cookie-write-monkey-patch"></a></h5>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable④">top-level traversable</a> maintains a record of which sites it has saved cookies for in the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation⑨">extended navigation</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-fetch" id="ref-for-concept-http-network-fetch">HTTP-network fetch</a> algorithm after step 15,
"... run the "set-cookie-string" parsing algorithm (see section 5.2 of <a data-link-type="biblio" href="#biblio-cookies" title="HTTP State Management Mechanism">[COOKIES]</a>) ...":</p>
   <ol>
    <li data-md>
     <p>If cookies were stored in the cookie store in the previous step, then
run <a data-link-type="dfn" href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations">process a fetch storage access for bounce tracking mitigations</a> given <var>request</var>.</p>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> If the <code>Set-Cookie</code> header includes any cookies that the user agent ignores, for example because it’s blocking third-party cookies,
    they’re not considered "stored in the cookie store" in this algorithm.</p>
   <div class="algorithm" data-algorithm="process a fetch storage access for bounce tracking mitigations">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-a-fetch-storage-access-for-bounce-tracking-mitigations">process a fetch storage access for bounce tracking mitigations</dfn> given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> <var>request</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>origin</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque③">opaque origin</a>, then abort these steps.</p>
     <li data-md>
      <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#subresource-request" id="ref-for-subresource-request">subresource request</a>, then:</p>
      <ol>
       <li data-md>
        <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a> is null, or <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context①">target browsing context</a> is null, then abort these steps.</p>
       <li data-md>
        <p>Let <var>topLevelTraversable</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client②">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context②">target browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable" id="ref-for-bc-traversable">top-level traversable</a>.</p>
      </ol>
     <li data-md>
      <p>Otherwise,</p>
      <ol>
       <li data-md>
        <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client">reserved client</a> is null, or <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client①">reserved client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context③">target browsing context</a> is null, then abort these steps.</p>
       <li data-md>
        <p>Let <var>topLevelTraversable</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client②">reserved client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context④">target browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable" id="ref-for-bc-traversable①">top-level traversable</a>.</p>
      </ol>
     <li data-md>
      <p>If <var>topLevelTraversable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑦">bounce tracking record</a> is null, abort these steps.</p>
     <li data-md>
      <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site③">obtain a site</a> given <var>origin</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append②">Append</a> <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①④">host</a> to <var>topLevelTraversable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑧">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set①">storage access set</a>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> We currently don’t treat cookie reads as stateful, but this would be a
reasonable future change. We could run <a data-link-type="dfn" href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations①">process a fetch storage access for bounce tracking mitigations</a> in the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" id="ref-for-concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a> algorithm after step 8.21.1.2,
"... <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-append" id="ref-for-concept-node-append">append</a> (<code>Cookie</code>, cookies) to httpRequest’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list" id="ref-for-concept-header-list">header list</a>. ..."</p>
   <h5 class="heading settled" data-level="6.2.3.3" id="bounce-tracking-mitigations-service-worker-activation-monkey-patch"><span class="secno">6.2.3.3. </span><span class="content">Service Worker Activation Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-service-worker-activation-monkey-patch"></a></h5>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑤">top-level traversable</a> maintains a record of which sites have activated service workers in the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation①⓪">extended navigation</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://w3c.github.io/ServiceWorker/#handle-fetch" id="ref-for-handle-fetch">Handle Fetch</a> algorithm after step 23,
"If the result of running the Run Service Worker algorithm...":</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations②">process a fetch storage access for bounce tracking mitigations</a> given <var>request</var>.</p>
   </ol>
   <h5 class="heading settled" data-level="6.2.3.4" id="bounce-tracking-mitigations-storage-access-monkey-patch"><span class="secno">6.2.3.4. </span><span class="content">Storage Access Monkey Patch</span><a class="self-link" href="#bounce-tracking-mitigations-storage-access-monkey-patch"></a></h5>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑥">top-level traversable</a> maintains a record of which sites have accessed storage in the current <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation①①">extended navigation</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map" id="ref-for-obtain-a-storage-bottle-map">obtain a storage bottle map</a> algorithm before step 10, "Return <var>proxyMap</var>":</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-a-general-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-general-storage-access-for-bounce-tracking-mitigations">process a general storage access for bounce tracking mitigations</a> given <var>environment</var>.</p>
   </ol>
   <p class="issue" id="issue-6bd6f4f1"><a class="self-link" href="#issue-6bd6f4f1"></a> This patch has to be run whenever a site accesses non-cookie storage. <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map" id="ref-for-obtain-a-storage-bottle-map①">Obtain a storage bottle map</a> is the intended hook for this, but it does not currently have full coverage across specs that use storage.
So this patch is not comprehensive. <a href="https://github.com/whatwg/storage/issues/165">[Issue #whatwg/storage#165]</a></p>
   <p></p>
   <div class="algorithm" data-algorithm="process a general storage access for bounce tracking mitigations">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-a-general-storage-access-for-bounce-tracking-mitigations">process a general storage access for bounce tracking mitigations</dfn> given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment" id="ref-for-environment①">environment</a> <var>environment</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>environment</var> is not an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a>, then abort these steps.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> At time of writing, <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map" id="ref-for-obtain-a-storage-bottle-map②">obtain a storage bottle map</a> can only accept an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> <var>environment</var>,
but this will be refactored to support <a data-link-type="dfn" href="https://w3c.github.io/ServiceWorker/#dfn-service-worker" id="ref-for-dfn-service-worker">service workers</a> which attempt to access storage on every navigation, and thus is not considered
when updating the <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set②">storage access set</a>.</p>
    <ol start="2">
     <li data-md>
      <p>Let <var>origin</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is null or an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque④">opaque origin</a>, then abort these steps.</p>
     <li data-md>
      <p>Let <var>global</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context" id="ref-for-realm-execution-context">realm execution context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object" id="ref-for-global-object">global object</a>.</p>
     <li data-md>
      <p>Let <var>navigables</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">empty</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set③">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#navigable" id="ref-for-navigable①">navigables</a>.</p>
     <li data-md>
      <p>If <var>global</var> is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-3/#window" id="ref-for-window">Window</a> object, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append③">append</a> <var>global</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window">associated document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable①">node navigable</a> onto <var>navigables</var>.</p>
     <li data-md>
      <p>Otherwise, if <var>global</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope">WorkerGlobalScope</a></code> object,</p>
      <ol>
       <li data-md>
        <p>Let <var>ownerQueue</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty①">empty</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue" id="ref-for-queue">queue</a> of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">document</a> or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope①">WorkerGlobalScope</a></code> objects.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-enqueue" id="ref-for-queue-enqueue">Enqueue</a> <var>global</var> onto <var>ownerQueue</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-while" id="ref-for-iteration-while">While</a> <var>ownerQueue</var> is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty②">empty</a>,</p>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-dequeue" id="ref-for-queue-dequeue">Dequeue</a> <var>owner</var> from <var>ownerQueue</var>.</p>
         <li data-md>
          <p>If <var>owner</var> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document③">document</a> object, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append④">append</a> <var>owner</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable②">node navigable</a> onto <var>navigables</var>.</p>
         <li data-md>
          <p>If <var>owner</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope②">WorkerGlobalScope</a></code> object, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>owner</var> in <var>global</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set" id="ref-for-concept-WorkerGlobalScope-owner-set">owner set</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-enqueue" id="ref-for-queue-enqueue①">enqueue</a> <var>owner</var> onto <var>ownerQueue</var>.</p>
        </ol>
      </ol>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> Handling <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope③">WorkerGlobalScope</a></code> covers all storage access from a dedicated worker (<code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>) or a shared worker
(<code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope">SharedWorkerGlobalScope</a></code>). This doesn’t apply to service workers, which rely on <a data-link-type="dfn" href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations③">process a fetch storage access for bounce tracking mitigations</a> during Fetch events and <a data-link-type="dfn" href="#process-a-general-storage-access-for-bounce-tracking-mitigations" id="ref-for-process-a-general-storage-access-for-bounce-tracking-mitigations①">process a general storage access for bounce tracking mitigations</a> with a <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-3/#window" id="ref-for-window①">Window</a> object when a service worker is
accessed using navigator.serviceWorker.getRegistration().</p>
    <ol start="8">
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>navigable</var> in <var>navigables</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>navigable</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑦">top-level traversable</a>, then abort these steps.</p>
       <li data-md>
        <p>If <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record⑨">bounce tracking record</a> is null, then abort these steps.</p>
       <li data-md>
        <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site④">obtain a site</a> given <var>origin</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑤">Append</a> <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑤">host</a> to <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⓪">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set③">storage access set</a>.</p>
      </ol>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.3.5" id="bounce-tracking-mitigations-response-received-monkey-patch"><span class="secno">6.2.3.5. </span><span class="content">Response Received Monkey
Patch</span><a class="self-link" href="#bounce-tracking-mitigations-response-received-monkey-patch"></a></h5>
   <p>When the response is received at the end of a navigation, fill the <a data-link-type="dfn" href="#bounce-tracking-record-bounce-set" id="ref-for-bounce-tracking-record-bounce-set①">bounce set</a>.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching" id="ref-for-create-navigation-params-by-fetching">create navigation params by fetching</a> algorithm, after Step 19.7,
"Wait until either response is non-null...", which is the point that <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url-list" id="ref-for-concept-response-url-list">url list</a> becomes available.</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-response-received-for-bounce-tracking" id="ref-for-process-response-received-for-bounce-tracking">process response received for bounce tracking</a> given <var>navigable</var> and <var>response</var>’s <var>URL list</var>.</p>
   </ol>
   <div class="algorithm" data-algorithm="process response received for bounce tracking">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-response-received-for-bounce-tracking">process response received for bounce tracking</dfn> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#navigable" id="ref-for-navigable②">navigable</a> <var>navigable</var> and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URLs</a> <var>URLs</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>navigable</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑧">top-level traversable</a>, then abort these steps.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①①">bounce tracking record</a> is not null.</p>
     <li data-md>
      <p>Let <var>global</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document②">active document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout" id="ref-for-run-steps-after-a-timeout">Run steps after a timeout</a> given:</p>
      <dl>
       <dt><var>global</var>
       <dd><var>global</var>
       <dt><var>milliseconds</var>
       <dd><a data-link-type="dfn" href="#client-bounce-detection-timer-period" id="ref-for-client-bounce-detection-timer-period①">client bounce detection timer period</a>
       <dt><var>completionSteps</var>
       <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source" id="ref-for-networking-task-source①">networking task source</a> with <var>global</var> to <a data-link-type="dfn" href="#record-stateful-bounces-for-bounce-tracking" id="ref-for-record-stateful-bounces-for-bounce-tracking②">record stateful bounces for bounce tracking</a> given <var>global</var>
      </dl>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>URL</var> in <var>URLs</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>site</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site⑤">obtain a site</a> given <var>URL</var>.</p>
       <li data-md>
        <p>Let <var>host</var> be the <var>site</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑥">host</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-insert" id="ref-for-concept-node-insert">Insert</a> <var>host</var> to the <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①②">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-bounce-set" id="ref-for-bounce-tracking-record-bounce-set②">bounce set</a>.</p>
      </ol>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.3.6" id="bounce-tracking-mitigations-document-load-monkey-patch"><span class="secno">6.2.3.6. </span><span class="content">Document Loaded Monkey
Patch</span><a class="self-link" href="#bounce-tracking-mitigations-document-load-monkey-patch"></a></h5>
   <p>When the document is loaded at the end of a navigation, update the <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host">final host</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host①">final host</a> is updated later than <a data-link-type="dfn" href="#process-response-received-for-bounce-tracking" id="ref-for-process-response-received-for-bounce-tracking①">process response received for bounce tracking</a> to ensure that the <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host②">final host</a> is a valid user destination. This is the one that has to be
compared against when deciding to exempt a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑦">host</a> in the <a data-link-type="dfn" href="#record-stateful-bounces-for-bounce-tracking" id="ref-for-record-stateful-bounces-for-bounce-tracking③">record stateful bounces for bounce tracking</a> algorithm.</p>
   <p>Insert the following steps in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#loading-a-document" id="ref-for-loading-a-document">load a document</a> algorithm,
before Step 5, "Return null", which is the point that the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document④">document</a> is loaded.</p>
   <ol>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="#process-document-load-for-bounce-tracking" id="ref-for-process-document-load-for-bounce-tracking">process document load for bounce tracking</a> given <var>navigable</var> and <var>response</var>’s <var>URL list</var>.</p>
   </ol>
   <div class="algorithm" data-algorithm="process document load for bounce tracking">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-document-load-for-bounce-tracking">process document load for bounce tracking</dfn> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#navigable" id="ref-for-navigable③">navigable</a> <var>navigable</var> and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URLs</a> <var>URLs</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>navigable</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable⑨">top-level traversable</a>, then abort these steps.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①③">bounce tracking record</a> is not null.</p>
     <li data-md>
      <p>If <var>URLs</var> is empty, then abort these steps.</p>
     <li data-md>
      <p>Let <var>finalSite</var> be the result of running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site⑥">obtain a site</a> given the last entry in <var>URLs</var>.</p>
     <li data-md>
      <p>Set the <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①④">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host③">final host</a> to the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑧">host</a> of <var>finalSite</var>.</p>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.3.7" id="bounce-tracking-mitigations-navigation-state-diagram"><span class="secno">6.2.3.7. </span><span class="content">Navigation State Diagram</span><a class="self-link" href="#bounce-tracking-mitigations-navigation-state-diagram"></a></h5>
   <p><img alt="Navigation state diagram" height="497" src="diagrams/navigation_state_diagram.png" width="945"></p>
   <h4 class="heading settled" data-level="6.2.4" id="bounce-tracking-mitigations-timers"><span class="secno">6.2.4. </span><span class="content">Timers</span><a class="self-link" href="#bounce-tracking-mitigations-timers"></a></h4>
   <p>Every <a data-link-type="dfn" href="#bounce-tracking-timer-period" id="ref-for-bounce-tracking-timer-period①">bounce tracking timer period</a> the user agent should run the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer③">bounce tracking timer</a> algorithm given the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock②">wall clock</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time" id="ref-for-wall-clock-unsafe-current-time">unsafe current time</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Running the deletion algorithm on a global timer has the effect of adding fuzz to the
    delay between stateful bounce and data deletion. This mitigates adversarial leaks of
    interaction and bounce times. (See "Privacy and Security Considerations", below.)</p>
   <div class="algorithm" data-algorithm="bounce tracking timer">
    <p>To run the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking-timer">bounce tracking timer</dfn> algorithm given a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment④">moment</a> on the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock③">wall clock</a> <var>now</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>host</var> -> <var>activationTime</var> of <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map④">user activation map</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a> that <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map③">stateful bounce tracking map</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">contain</a> <var>host</var>.</p>
       <li data-md>
        <p>If <var>activationTime</var> + <a data-link-type="dfn" href="#bounce-tracking-activation-lifetime" id="ref-for-bounce-tracking-activation-lifetime①">bounce tracking activation lifetime</a> is before <var>now</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove①">remove</a> <var>host</var> from <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map⑤">user activation map</a>.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate①">For each</a> <var>host</var> -> <var>bounceTime</var> of <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map④">stateful bounce tracking map</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a> that <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map⑥">user activation map</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">contain</a> <var>host</var>.</p>
       <li data-md>
        <p>If <var>bounceTime</var> + <a data-link-type="dfn" href="#bounce-tracking-grace-period" id="ref-for-bounce-tracking-grace-period①">bounce tracking grace period</a> is after <var>now</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
       <li data-md>
        <p>If there is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable①⓪">top-level traversable</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document③">active document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin③">origin</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site⑦">site</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host①⑨">host</a> equals <var>host</var>,
then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove②">Remove</a> <var>host</var> from <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map⑤">stateful bounce tracking map</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#clear-cookies-for-host" id="ref-for-clear-cookies-for-host">Clear cookies for host</a> given <var>host</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#clear-non-cookie-storage-for-host" id="ref-for-clear-non-cookie-storage-for-host">Clear non-cookie storage for host</a> given <var>host</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#clear-cache-for-host" id="ref-for-clear-cache-for-host">Clear cache for host</a> given <var>host</var>.</p>
      </ol>
    </ol>
    <p class="issue" id="issue-c8879d93"><a class="self-link" href="#issue-c8879d93"></a>TODO: Consider if we should do anything when the clock is moved
    forward or backward.</p>
   </div>
   <p>This algorithm is called when detecting the end of an <a data-link-type="dfn" href="#extended-navigation" id="ref-for-extended-navigation①②">extended navigation</a>. This could happen
if:</p>
   <ul>
    <li data-md>
     <p>a user-initiated navigation is detected in <a data-link-type="dfn" href="#process-navigation-start-for-bounce-tracking" id="ref-for-process-navigation-start-for-bounce-tracking①">process navigation start for bounce tracking</a>;</p>
    <li data-md>
     <p>the client bounce detection timer expires after <a data-link-type="dfn" href="#process-response-received-for-bounce-tracking" id="ref-for-process-response-received-for-bounce-tracking②">process response received for bounce tracking</a> without observing a client redirect; or,</p>
    <li data-md>
     <p>the associated <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable" id="ref-for-top-level-traversable①①">top-level traversable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#is-closing" id="ref-for-is-closing">is closing</a> is set to true.</p>
   </ul>
   <div class="algorithm" data-algorithm="record stateful bounces for bounce tracking">
    <p>To run the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="record-stateful-bounces-for-bounce-tracking">record stateful bounces for bounce tracking</dfn> algorithm
given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object" id="ref-for-global-object①">global object</a> <var>global</var>, perform the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>navigable</var> be <var>global</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window①">associated document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable③">node navigable</a>.</p>
     <li data-md>
      <p>If <var>navigable</var> is null, abort these steps.
This ensures that the global has not been detached from the navigable.</p>
     <li data-md>
      <p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document④">active document</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert④">Assert</a>: <var>topDocument</var> is the same as <var>global</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window②">associated document</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑤">Assert</a>: <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⑤">bounce tracking record</a> is not null.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>host</var> in <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⑥">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-bounce-set" id="ref-for-bounce-tracking-record-bounce-set③">bounce set</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>host</var> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host-equals" id="ref-for-concept-host-equals">equals</a> <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⑦">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-initial-host" id="ref-for-bounce-tracking-record-initial-host④">initial host</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
       <li data-md>
        <p>If <var>host</var> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host-equals" id="ref-for-concept-host-equals①">equals</a> <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⑧">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-final-host" id="ref-for-bounce-tracking-record-final-host④">final host</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">continue</a>.</p>
       <li data-md>
        <p>If <a data-link-type="dfn" href="#user-activation-map" id="ref-for-user-activation-map⑦">user activation map</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">contains</a> <var>host</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④">continue</a>.</p>
       <li data-md>
        <p>If <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map⑥">stateful bounce tracking map</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">contains</a> <var>host</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑤">continue</a>. (Only the first bounce time since the
last execution of the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer④">bounce tracking timer</a> is tracked in the map.)</p>
       <li data-md>
        <p>If <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record①⑨">bounce tracking record</a>'s <a data-link-type="dfn" href="#bounce-tracking-record-storage-access-set" id="ref-for-bounce-tracking-record-storage-access-set④">storage access set</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contain</a> <var>host</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑥">continue</a>.</p>
       <li data-md>
        <p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document⑤">active document</a>.</p>
       <li data-md>
        <p>Set <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map⑦">stateful bounce tracking map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time②">current wall time</a>.</p>
      </ol>
     <li data-md>
      <p>Set <var>navigable</var>’s <a data-link-type="dfn" href="#top-level-traversable-bounce-tracking-record" id="ref-for-top-level-traversable-bounce-tracking-record②⓪">bounce tracking record</a> to null.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.5" id="bounce-tracking-mitigations-deletion"><span class="secno">6.2.5. </span><span class="content">Deletion</span><a class="self-link" href="#bounce-tracking-mitigations-deletion"></a></h4>
   <p class="note" role="note">The cookie and cache clearing algorithms were largely copied from
the <a data-link-type="biblio" href="#biblio-clear-site-data" title="Clear Site Data">Clear Site Data</a> spec.  It would be nice to unify these in the future.</p>
   <div class="algorithm" data-algorithm="clear cookies for host">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="clear-cookies-for-host">clear cookies for host</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②⓪">host</a> <var>host</var>, perform the
following steps:</p>
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑥">Assert</a>: <var>host</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain①">registrable domain</a> is <var>host</var> or null.</p>
     <li data-md>
      <p>Let <var>cookieList</var> be a set of cookies, initially empty.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate④">For each</a> cookie <var>cookie</var> in the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.3" id="ref-for-section-5.3">cookie store</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>cookie</var> is not <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.1" id="ref-for-section-2.1">partitioned</a>:</p>
        <ol>
         <li data-md>
          <p>If <var>cookie</var>’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.2.3" id="ref-for-section-5.2.3">domain attribute</a> is a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.1.3" id="ref-for-section-5.1.3">domain-match</a> with <var>host</var>, add <var>cookie</var> to <var>cookieList</var>; otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑦">continue</a>.</p>
        </ol>
       <li data-md>
        <p>If <var>cookie</var> is <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.1" id="ref-for-section-2.1①">partitioned</a>:</p>
        <ol>
         <li data-md>
          <p>If the top-level <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①①">site</a> in <var>cookie</var>’s <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.2" id="ref-for-section-2.2">partition key</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site">same site</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①②">site</a> ("http", <var>host</var>), add <var>cookie</var> to <var>cookieList</var>.</p>
         <li data-md>
          <p>If the top-level <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①③">site</a> in <var>cookie</var>’s <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.2" id="ref-for-section-2.2①">partition key</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site①">same site</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①④">site</a> ("https", <var>host</var>), add <var>cookie</var> to <var>cookieList</var>.</p>
         <li data-md>
          <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑧">continue</a>.</p>
        </ol>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑤">For each</a> <var>cookie</var> in <var>cookieList</var>:</p>
      <ol>
       <li data-md>
        <p>Remove <var>cookie</var> from the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.3" id="ref-for-section-5.3①">cookie store</a>.</p>
      </ol>
    </ol>
   </div>
   <p class="issue" id="issue-a6c4e61d"><a class="self-link" href="#issue-a6c4e61d"></a> TODO: Verify that using <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.1.3" id="ref-for-section-5.1.3①">domain-match</a> catches all cookies for the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain②">registrable domain</a>.</p>
   <div class="algorithm" data-algorithm="clear non-cookie storage for host">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="clear-non-cookie-storage-for-host">clear non-cookie storage for host</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②①">host</a> <var>host</var>, perform
the following steps: 
    <ol>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-shed" id="ref-for-storage-shed">storage shed</a> <var>shed</var> held by the user agent or a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" id="ref-for-traversable-navigable">traversable navigable</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate②">For each</a> <var>storageKey</var> -> <var>storageShelf</var> of <var>shed</var>:</p>
        <ol>
         <li data-md>
          <p>Let <var>topLevelSite</var> be <var>storageKey</var>’s top-level site.</p>
         <li data-md>
          <p>If <var>topLevelSite</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque⑤">opaque origin</a>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑨">continue</a>.</p>
         <li data-md>
          <p>If <var>topLevelSite</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②②">host</a> does not equal <var>host</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⓪">continue</a>.</p>
         <li data-md>
          <p>Delete all data stored in <var>storageShelf</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove③">Remove</a> <var>storageKey</var> from <var>shed</var>.</p>
        </ol>
      </ol>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> This algorithm is written assuming the implementation of the <a href="https://github.com/whatwg/storage/pull/144">work-in-progress update</a> to
    the <a href="https://storage.spec.whatwg.org/">Storage Standard</a> to <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-key" id="ref-for-storage-key">key</a> storage on both an <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-key-origin" id="ref-for-storage-key-origin">origin</a> and a top-level site.</p>
   </div>
   <div class="algorithm" data-algorithm="clear cache for host">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="clear-cache-for-host">clear cache for host</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②③">host</a> <var>host</var>, perform the
following steps: 
    <ol>
     <li data-md>
      <p>Let <var>cacheList</var> be the set of entries from the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc9111/#section-2" id="ref-for-section-2">network cache</a> whose
target URI <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②④">host</a> equals <var>host</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑥">For each</a> <var>entry</var> in <var>cacheList</var>:</p>
      <ol>
       <li data-md>
        <p>Remove <var>entry</var> from the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc9111/#section-2" id="ref-for-section-2①">network cache</a>.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.3" id="bounce-tracking-mitigations-automation"><span class="secno">6.3. </span><span class="content">User Agent Automation</span><a class="self-link" href="#bounce-tracking-mitigations-automation"></a></h3>
   <p>For the purposes of user-agent automation and application testing, this
document defines a number of [extension commands] for the <a data-link-type="biblio" href="#biblio-webdriver" title="WebDriver">[WebDriver]</a> specification.</p>
   <h4 class="heading settled" data-level="6.3.1" id="run-bounce-tracking-mitigations-command"><span class="secno">6.3.1. </span><span class="content">Run Bounce Tracking Mitigations</span><a class="self-link" href="#run-bounce-tracking-mitigations-command"></a></h4>
   <figure class="table" id="table-webdriver-run-bounce-tracking-mitigations-command">
    <table class="data">
     <thead>
      <tr>
       <th>HTTP Method
       <th>URI Template
     <tbody>
      <tr>
       <td>DELETE
       <td><code>/session/{session id}/storage/run_bounce_tracking_mitigations</code>
    </table>
   </figure>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps">remote end steps</a> are:</p>
   <ol>
    <li data-md>
     <p>If no Bounce Tracking Mitigation Service is currently running, return a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error" id="ref-for-dfn-error">WebDriver error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-unsupported-operation" id="ref-for-dfn-unsupported-operation">unsupported operation</a>.</p>
    <li data-md>
     <p>If the <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map⑧">stateful bounce tracking map</a> contains a malformed host, return a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error" id="ref-for-dfn-error①">WebDriver error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code①">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-unknown-error" id="ref-for-dfn-unknown-error">unknown error</a>.</p>
    <li data-md>
     <p>Let <var>list</var> be a new list of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①⑤">site</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host" id="ref-for-concept-host②⑤">hosts</a> in the <a data-link-type="dfn" href="#stateful-bounce-tracking-map" id="ref-for-stateful-bounce-tracking-map⑨">stateful bounce tracking map</a>.</p>
    <li data-md>
     <p>Let <var>temp</var> be <a data-link-type="dfn" href="#bounce-tracking-grace-period" id="ref-for-bounce-tracking-grace-period②">bounce tracking grace period</a>.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="#bounce-tracking-grace-period" id="ref-for-bounce-tracking-grace-period③">bounce tracking grace period</a> to 0 seconds.</p>
    <li data-md>
     <p>Run the <a data-link-type="dfn" href="#bounce-tracking-timer" id="ref-for-bounce-tracking-timer⑤">bounce tracking timer</a> algorithm.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="#bounce-tracking-grace-period" id="ref-for-bounce-tracking-grace-period④">bounce tracking grace period</a> to <var>temp</var>.</p>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success">success</a> with data <var>list</var>.</p>
   </ol>
   <h2 class="heading settled" data-level="7" id="privacy-and-security-considerations"><span class="secno">7. </span><span class="content">Privacy and Security Considerations</span><a class="self-link" href="#privacy-and-security-considerations"></a></h2>
   <p>This feature stores information about sites that have a user interaction, some amount of view time, or <a href="https://www.chromium.org/developers/design-documents/site-engagement/">engagement</a>. This information is
not directly exposed to sites, however, it can be indirectly observed.  For example, if <code>tracker.example</code> reports back its oldest existing state to <code>site1.example</code>, then <code>site1.example</code> could infer that <code>tracker.example</code> has had an interaction.  If it does not report any long-lived state, however, then <code>site1.example</code> could infer that the state was wiped.</p>
   <p>In addition, there are potential scenarios where the existence of an interaction could be accessed through
existing XS leaks in the platform.  Consider a scenario where a target site has an existing endpoint that
causes an automatic redirect that triggers the bounce tracking mitigations.  An attacker could use existing
XS leaks to determine if any logged-in state is present on a target site and then look to see if that state
disappears after triggering the bounce.</p>
   <p>The information leak from tracker to site does not seem very significant.  At a minimum, the proposed
mitigations do not make the situation worse and without the mitigations there is a greater potential for a
tracker to communicate state to the target site.</p>
   <p>The cross-site adversarial information leak is more concerning.  Solutions designed for this effort should
take this threat into account and attempt to mitigate it.  For example, delaying or fuzzing the timing of
storage wiping could lessen the impact of the leak.  Ultimately, though, it may be necessary to weigh the
cost of this 1 bit information leak against the gains in mitigating bounce tracking.</p>
   <p>Another threat that should be considered by any solution is the possibility that an attacker will trick a
user into visiting an existing redirect endpoint on a site that they care about and somehow trigger their
storage to be deleted.  The current plan, however, is to already look at signals that a user cares about a
site for legitimate use cases, in order to avoid wiping data they care about.  This threat just puts more
weight on getting these signals correct.</p>
   <p>Otherwise this effort does not store or expose any new types of information.  It does not create any new
cross-origin communication or storage capabilities.</p>
   <p>There is some implementation complexity to be aware of when wiping storage.  The browser must be careful
not to wipe storage out from under a site actively using it.  This could lead to poor interop and broken
web sites.</p>
   <h2 class="no-num heading settled" id="acknowledgements"><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p>Many thanks to the Privacy Community Group for many good discussions about this proposal.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#bounce-tracking-record-bounce-set">bounce set</a><span>, in § 6.1.2</span>
   <li><a href="#bounce-tracking">Bounce tracking</a><span>, in § 3</span>
   <li><a href="#bounce-tracking-activation-lifetime">bounce tracking activation lifetime</a><span>, in § 6.1.3</span>
   <li><a href="#bounce-tracking-grace-period">bounce tracking grace period</a><span>, in § 6.1.3</span>
   <li>
    bounce tracking record
    <ul>
     <li><a href="#bounce-tracking-record">definition of</a><span>, in § 6.1.2</span>
     <li><a href="#top-level-traversable-bounce-tracking-record">dfn for top-level traversable</a><span>, in § 6.1.2</span>
    </ul>
   <li><a href="#bounce-tracking-timer">bounce tracking timer</a><span>, in § 6.2.4</span>
   <li><a href="#bounce-tracking-timer-period">bounce tracking timer period</a><span>, in § 6.1.3</span>
   <li><a href="#clear-cache-for-host">clear cache for host</a><span>, in § 6.2.5</span>
   <li><a href="#clear-cookies-for-host">clear cookies for host</a><span>, in § 6.2.5</span>
   <li><a href="#clear-non-cookie-storage-for-host">clear non-cookie storage for host</a><span>, in § 6.2.5</span>
   <li><a href="#client-bounce-detection-timer-period">client bounce detection timer period</a><span>, in § 6.1.3</span>
   <li><a href="#extended-navigation">extended navigation</a><span>, in § 6.1.2</span>
   <li><a href="#bounce-tracking-record-final-host">final host</a><span>, in § 6.1.2</span>
   <li><a href="#bounce-tracking-record-initial-host">initial host</a><span>, in § 6.1.2</span>
   <li><a href="#link-decoration">Link decoration</a><span>, in § 3</span>
   <li><a href="#navigational-tracking">Navigational tracking</a><span>, in § 3</span>
   <li><a href="#process-a-fetch-storage-access-for-bounce-tracking-mitigations">process a fetch storage access for bounce tracking mitigations</a><span>, in § 6.2.3.2</span>
   <li><a href="#process-a-general-storage-access-for-bounce-tracking-mitigations">process a general storage access for bounce tracking mitigations</a><span>, in § 6.2.3.4</span>
   <li><a href="#process-a-web-authentication-assertion-for-bounce-tracking-mitigations">process a Web Authentication assertion for bounce tracking mitigations</a><span>, in § 6.2.2</span>
   <li><a href="#process-document-load-for-bounce-tracking">process document load for bounce tracking</a><span>, in § 6.2.3.6</span>
   <li><a href="#process-navigation-start-for-bounce-tracking">process navigation start for bounce tracking</a><span>, in § 6.2.3.1</span>
   <li><a href="#process-response-received-for-bounce-tracking">process response received for bounce tracking</a><span>, in § 6.2.3.5</span>
   <li><a href="#record-a-user-activation">record a user activation</a><span>, in § 6.2.1</span>
   <li><a href="#record-stateful-bounces-for-bounce-tracking">record stateful bounces for bounce tracking</a><span>, in § 6.2.4</span>
   <li><a href="#stateful-bounce-tracking-map">stateful bounce tracking map</a><span>, in § 6.1.1</span>
   <li><a href="#bounce-tracking-record-storage-access-set">storage access set</a><span>, in § 6.1.2</span>
   <li><a href="#user-activation-map">user activation map</a><span>, in § 6.1.1</span>
   <li><a href="#bounce-tracking-record-user-activation-set">user activation set</a><span>, in § 6.1.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[COOKIES]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="69ba1a02">cookie store</span>
     <li><span class="dfn-paneled" id="921cf04f">domain attribute</span>
     <li><span class="dfn-paneled" id="5ac0e3d4">domain-match</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-COLOR-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="95a8ae14">window</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="543878fa">append</span>
     <li><span class="dfn-paneled" id="a973e0fe">document</span>
     <li><span class="dfn-paneled" id="b9429bc2">insert</span>
     <li><span class="dfn-paneled" id="c62cd7cf">origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="857d5516">client</span>
     <li><span class="dfn-paneled" id="d85a6c84">header list</span>
     <li><span class="dfn-paneled" id="d75f6c27">http-network fetch</span>
     <li><span class="dfn-paneled" id="980528b0">http-network-or-cache fetch</span>
     <li><span class="dfn-paneled" id="f78d5b5c">origin</span>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
     <li><span class="dfn-paneled" id="abe352cd">reserved client</span>
     <li><span class="dfn-paneled" id="839611db">subresource request</span>
     <li><span class="dfn-paneled" id="ff8d2a6f">url list</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HR-TIME-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f16ee824">current wall time</span>
     <li><span class="dfn-paneled" id="4b2c8c72">duration</span>
     <li><span class="dfn-paneled" id="1e2edd5b">moment</span>
     <li><span class="dfn-paneled" id="12938d07">unsafe current time</span>
     <li><span class="dfn-paneled" id="05de5ae3">wall clock</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b8308563">DedicatedWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="165b73c9">SharedWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="83c59a3a">WorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="36d15a6d">activation notification</span>
     <li><span class="dfn-paneled" id="35972864">active document</span>
     <li><span class="dfn-paneled" id="3349d69f">associated document</span>
     <li><span class="dfn-paneled" id="0d0390b4">browsing context</span>
     <li><span class="dfn-paneled" id="07ad3048">create navigation params by fetching</span>
     <li><span class="dfn-paneled" id="24cf98a1">environment</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="4b6086d7">global object</span>
     <li><span class="dfn-paneled" id="dfa9c14c">has transient activation</span>
     <li><span class="dfn-paneled" id="448c95f9">http-equiv</span>
     <li><span class="dfn-paneled" id="5423e8ff">hyperlink</span>
     <li><span class="dfn-paneled" id="87fcd40c">iframe</span>
     <li><span class="dfn-paneled" id="8f5e1aba">is closing</span>
     <li><span class="dfn-paneled" id="ba244b14">load a document</span>
     <li><span class="dfn-paneled" id="3a2db83f">localStorage</span>
     <li><span class="dfn-paneled" id="93ce1392">location</span>
     <li><span class="dfn-paneled" id="64b89595">meta</span>
     <li><span class="dfn-paneled" id="9c19b7fc">navigable</span>
     <li><span class="dfn-paneled" id="2594e562">navigate</span>
     <li><span class="dfn-paneled" id="b6ae4501">networking task source</span>
     <li><span class="dfn-paneled" id="13dd6cae">node navigable</span>
     <li><span class="dfn-paneled" id="602b1a68">obtain a site</span>
     <li><span class="dfn-paneled" id="b01b1359">opaque origin</span>
     <li><span class="dfn-paneled" id="dc248371">owner set</span>
     <li><span class="dfn-paneled" id="48438eb3">queue a global task</span>
     <li><span class="dfn-paneled" id="ce15d5dc">realm execution context</span>
     <li><span class="dfn-paneled" id="e7b2fe41">refresh</span>
     <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="8596ac55">run steps after a timeout</span>
     <li><span class="dfn-paneled" id="feac4ab3">same site</span>
     <li><span class="dfn-paneled" id="fb9bb722">site</span>
     <li><span class="dfn-paneled" id="77093875">source snapshot params</span>
     <li><span class="dfn-paneled" id="085ddd0a">target browsing context</span>
     <li><span class="dfn-paneled" id="c63519ed">top-level origin</span>
     <li><span class="dfn-paneled" id="bd736ec6">top-level traversable</span>
     <li><span class="dfn-paneled" id="0ff9b6b9">top-level traversable <small>(for browsing context)</small></span>
     <li><span class="dfn-paneled" id="d0c1b934">traversable navigable</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTTP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4a139803">http 3xx statuses</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a3b18719">append</span>
     <li><span class="dfn-paneled" id="77b4c09a">assert</span>
     <li><span class="dfn-paneled" id="ae8def21">contain <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="a326add7">contain <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="9a9b558b">dequeue</span>
     <li><span class="dfn-paneled" id="03afaf9c">empty</span>
     <li><span class="dfn-paneled" id="06a6db54">enqueue</span>
     <li><span class="dfn-paneled" id="16d07e10">for each <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="45209803">for each <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="47dfca75">queue</span>
     <li><span class="dfn-paneled" id="7d4424b2">remove</span>
     <li><span class="dfn-paneled" id="15e48c39">set</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
     <li><span class="dfn-paneled" id="cbdc89b4">while</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PARTITIONED-COOKIES]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="215ff948">partition key</span>
     <li><span class="dfn-paneled" id="a7c53389">partitioned cookie</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC9111]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a6732b20">network cache</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SERVICE-WORKERS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="09abaedd">handle fetch</span>
     <li><span class="dfn-paneled" id="c60ed63a">service worker</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STORAGE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4473e129">obtain a storage bottle map</span>
     <li><span class="dfn-paneled" id="ef4a9b44">origin</span>
     <li><span class="dfn-paneled" id="7f6a70d1">storage key</span>
     <li><span class="dfn-paneled" id="660191f0">storage shed</span>
    </ul>
   <li>
    <a data-link-type="biblio">[TRACKING-DNT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0d21247b">tracking</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cfc67fdc">empty host</span>
     <li><span class="dfn-paneled" id="8ad2567a">equal</span>
     <li><span class="dfn-paneled" id="752d140b">host</span>
     <li><span class="dfn-paneled" id="bc9d7803">registrable domain</span>
     <li><span class="dfn-paneled" id="dcffbccd">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBAUTHN-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="91d31374">PublicKeyCredential</span>
     <li><span class="dfn-paneled" id="3146e9fe">[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebDriver]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c8ff8493">error code</span>
     <li><span class="dfn-paneled" id="6945cc54">unknown error</span>
     <li><span class="dfn-paneled" id="a869e769">unsupported operation</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBDRIVER2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="bb4c269e">error</span>
     <li><span class="dfn-paneled" id="82c23298">remote end steps</span>
     <li><span class="dfn-paneled" id="4be6272b">success</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-cookies">[COOKIES]
   <dd>A. Barth. <a href="https://httpwg.org/specs/rfc6265.html"><cite>HTTP State Management Mechanism</cite></a>. April 2011. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc6265.html">https://httpwg.org/specs/rfc6265.html</a>
   <dt id="biblio-css-color-3">[CSS-COLOR-3]
   <dd>Tantek Çelik; Chris Lilley; David Baron. <a href="https://drafts.csswg.org/css-color-3/"><cite>CSS Color Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-color-3/">https://drafts.csswg.org/css-color-3/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-hr-time-3">[HR-TIME-3]
   <dd>Yoav Weiss. <a href="https://w3c.github.io/hr-time/"><cite>High Resolution Time</cite></a>. URL: <a href="https://w3c.github.io/hr-time/">https://w3c.github.io/hr-time/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-partitioned-cookies">[PARTITIONED-COOKIES]
   <dd><a href="https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies"><cite>Cookies Having Independent Partitioned State specification</cite></a>. Editor's Draft. URL: <a href="https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies">https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc9111">[RFC9111]
   <dd>R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. <a href="https://httpwg.org/specs/rfc9111.html"><cite>HTTP Caching</cite></a>. June 2022. Internet Standard. URL: <a href="https://httpwg.org/specs/rfc9111.html">https://httpwg.org/specs/rfc9111.html</a>
   <dt id="biblio-service-workers">[SERVICE-WORKERS]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
   <dt id="biblio-storage">[STORAGE]
   <dd>Anne van Kesteren. <a href="https://storage.spec.whatwg.org/"><cite>Storage Standard</cite></a>. Living Standard. URL: <a href="https://storage.spec.whatwg.org/">https://storage.spec.whatwg.org/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webauthn-3">[WEBAUTHN-3]
   <dd>Michael Jones; Akshay Kumar; Emil Lundberg. <a href="https://w3c.github.io/webauthn/"><cite>Web Authentication: An API for accessing Public Key Credentials - Level 3</cite></a>. URL: <a href="https://w3c.github.io/webauthn/">https://w3c.github.io/webauthn/</a>
   <dt id="biblio-webdriver">[WebDriver]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
   <dt id="biblio-webdriver2">[WEBDRIVER2]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-clear-site-data">[CLEAR-SITE-DATA]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-clear-site-data/"><cite>Clear Site Data</cite></a>. URL: <a href="https://w3c.github.io/webappsec-clear-site-data/">https://w3c.github.io/webappsec-clear-site-data/</a>
   <dt id="biblio-fsn-2021-q4">[FSN-2021-Q4]
   <dd><a href="https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4"><cite>Firefox Security Newsletter 2021 Q4</cite></a>. 2022-03-09. URL: <a href="https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4">https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4</a>
   <dt id="biblio-mozilla-tracking-policy">[MOZILLA-TRACKING-POLICY]
   <dd><a href="https://wiki.mozilla.org/Security/Anti_tracking_policy"><cite>Mozilla Anti Tracking Policy</cite></a>. URL: <a href="https://wiki.mozilla.org/Security/Anti_tracking_policy">https://wiki.mozilla.org/Security/Anti_tracking_policy</a>
   <dt id="biblio-tracking-dnt">[TRACKING-DNT]
   <dd>Roy Fielding; David Singer. <a href="https://w3c.github.io/dnt/drafts/tracking-dnt.html"><cite>Tracking Preference Expression (DNT)</cite></a>. URL: <a href="https://w3c.github.io/dnt/drafts/tracking-dnt.html">https://w3c.github.io/dnt/drafts/tracking-dnt.html</a>
   <dt id="biblio-webkit-tracking-prevention">[WEBKIT-TRACKING-PREVENTION]
   <dd><a href="https://webkit.org/tracking-prevention/"><cite>Tracking Prevention in WebKit</cite></a>. URL: <a href="https://webkit.org/tracking-prevention/">https://webkit.org/tracking-prevention/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Changing the numbers changes what map the user sees, and embedding
a user ID would not successfully transfer that user ID to the target site,
but it’s hard for an automated system inside a browser to prove
that, and even hard for humans reading the URL to be confident of it. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/4">[Issue #4]</a> <a class="issue-return" href="#issue-9458c4e5" title="Jump to section">↵</a></div>
   <div class="issue"> The URL identifies an action rather than a page, and the user ID
might be essential for that action to happen. However, this is also clearly
a user ID and sufficient to track a user if the source and target
collaborate. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a> <a class="issue-return" href="#issue-fc2127e1" title="Jump to section">↵</a></div>
   <div class="issue"> This is probably the same case as the unsubscribe link. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a> <a class="issue-return" href="#issue-0c501704" title="Jump to section">↵</a></div>
   <div class="issue"> This patch has to be run whenever a site accesses non-cookie storage. <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map">Obtain a storage bottle map</a> is the intended hook for this, but it does not currently have full coverage across specs that use storage.
So this patch is not comprehensive. <a href="https://github.com/whatwg/storage/issues/165">[Issue #whatwg/storage#165]</a> <a class="issue-return" href="#issue-6bd6f4f1" title="Jump to section">↵</a></div>
   <div class="issue">TODO: Consider if we should do anything when the clock is moved
    forward or backward. <a class="issue-return" href="#issue-c8879d93" title="Jump to section">↵</a></div>
   <div class="issue"> TODO: Verify that using <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265/#section-5.1.3">domain-match</a> catches all cookies for the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain">registrable domain</a>. <a class="issue-return" href="#issue-a6c4e61d" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"03afaf9c": {"dfnID":"03afaf9c","dfnText":"empty","external":true,"refSections":[{"refs":[{"id":"ref-for-list-empty"},{"id":"ref-for-list-empty\u2460"},{"id":"ref-for-list-empty\u2461"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://infra.spec.whatwg.org/#list-empty"},
"05de5ae3": {"dfnID":"05de5ae3","dfnText":"wall clock","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-wall-clock"},{"id":"ref-for-dfn-wall-clock\u2460"}],"title":"6.1.1. Global Data"},{"refs":[{"id":"ref-for-dfn-wall-clock\u2461"},{"id":"ref-for-dfn-wall-clock\u2462"}],"title":"6.2.4. Timers"}],"url":"https://w3c.github.io/hr-time/#dfn-wall-clock"},
"06a6db54": {"dfnID":"06a6db54","dfnText":"enqueue","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-enqueue"},{"id":"ref-for-queue-enqueue\u2460"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://infra.spec.whatwg.org/#queue-enqueue"},
"07ad3048": {"dfnID":"07ad3048","dfnText":"create navigation params by fetching","external":true,"refSections":[{"refs":[{"id":"ref-for-create-navigation-params-by-fetching"}],"title":"6.2.3.5. Response Received Monkey\nPatch"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching"},
"085ddd0a": {"dfnID":"085ddd0a","dfnText":"target browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-environment-target-browsing-context"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-concept-environment-target-browsing-context\u2460"},{"id":"ref-for-concept-environment-target-browsing-context\u2461"},{"id":"ref-for-concept-environment-target-browsing-context\u2462"},{"id":"ref-for-concept-environment-target-browsing-context\u2463"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context"},
"09abaedd": {"dfnID":"09abaedd","dfnText":"handle fetch","external":true,"refSections":[{"refs":[{"id":"ref-for-handle-fetch"}],"title":"6.2.3.3. Service Worker Activation Monkey Patch"}],"url":"https://w3c.github.io/ServiceWorker/#handle-fetch"},
"0d0390b4": {"dfnID":"0d0390b4","dfnText":"browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-browsing-context"}],"title":"6.2.2. Web Authentication Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context"},
"0d21247b": {"dfnID":"0d21247b","dfnText":"tracking","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-tracking"}],"title":"1. Introduction"}],"url":"https://www.w3.org/TR/tracking-dnt/#dfn-tracking"},
"0ff9b6b9": {"dfnID":"0ff9b6b9","dfnText":"top-level traversable (for browsing context)","external":true,"refSections":[{"refs":[{"id":"ref-for-bc-traversable"},{"id":"ref-for-bc-traversable\u2460"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable"},
"12938d07": {"dfnID":"12938d07","dfnText":"unsafe current time","external":true,"refSections":[{"refs":[{"id":"ref-for-wall-clock-unsafe-current-time"}],"title":"6.2.4. Timers"}],"url":"https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time"},
"13dd6cae": {"dfnID":"13dd6cae","dfnText":"node navigable","external":true,"refSections":[{"refs":[{"id":"ref-for-node-navigable"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-node-navigable\u2460"},{"id":"ref-for-node-navigable\u2461"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-node-navigable\u2462"}],"title":"6.2.4. Timers"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable"},
"15e48c39": {"dfnID":"15e48c39","dfnText":"set","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-set"},{"id":"ref-for-ordered-set\u2460"},{"id":"ref-for-ordered-set\u2461"}],"title":"6.1.2. Per-Tab Data"},{"refs":[{"id":"ref-for-ordered-set\u2462"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://infra.spec.whatwg.org/#ordered-set"},
"165b73c9": {"dfnID":"165b73c9","dfnText":"SharedWorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-sharedworkerglobalscope"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope"},
"16d07e10": {"dfnID":"16d07e10","dfnText":"for each (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"},{"id":"ref-for-list-iterate\u2460"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-list-iterate\u2461"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-list-iterate\u2462"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-list-iterate\u2463"},{"id":"ref-for-list-iterate\u2464"},{"id":"ref-for-list-iterate\u2465"}],"title":"6.2.5. Deletion"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"1e2edd5b": {"dfnID":"1e2edd5b","dfnText":"moment","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-moment"},{"id":"ref-for-dfn-moment\u2460"},{"id":"ref-for-dfn-moment\u2461"},{"id":"ref-for-dfn-moment\u2462"}],"title":"6.1.1. Global Data"},{"refs":[{"id":"ref-for-dfn-moment\u2463"}],"title":"6.2.4. Timers"}],"url":"https://w3c.github.io/hr-time/#dfn-moment"},
"215ff948": {"dfnID":"215ff948","dfnText":"partition key","external":true,"refSections":[{"refs":[{"id":"ref-for-section-2.2"},{"id":"ref-for-section-2.2\u2460"}],"title":"6.2.5. Deletion"}],"url":"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.2"},
"24cf98a1": {"dfnID":"24cf98a1","dfnText":"environment","external":true,"refSections":[{"refs":[{"id":"ref-for-environment"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-environment\u2460"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment"},
"2594e562": {"dfnID":"2594e562","dfnText":"navigate","external":true,"refSections":[{"refs":[{"id":"ref-for-navigate"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate"},
"3146e9fe": {"dfnID":"3146e9fe","dfnText":"[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-publickeycredential-discoverfromexternalsource-slot"},{"id":"ref-for-dom-publickeycredential-discoverfromexternalsource-slot\u2460"}],"title":"6.2.2. Web Authentication Monkey Patch"}],"url":"https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot"},
"3349d69f": {"dfnID":"3349d69f","dfnText":"associated document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-window"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-concept-document-window\u2460"},{"id":"ref-for-concept-document-window\u2461"}],"title":"6.2.4. Timers"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"},
"35972864": {"dfnID":"35972864","dfnText":"active document","external":true,"refSections":[{"refs":[{"id":"ref-for-nav-document"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-nav-document\u2460"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-nav-document\u2461"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-nav-document\u2462"},{"id":"ref-for-nav-document\u2463"},{"id":"ref-for-nav-document\u2464"}],"title":"6.2.4. Timers"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"},
"36d15a6d": {"dfnID":"36d15a6d","dfnText":"activation notification","external":true,"refSections":[{"refs":[{"id":"ref-for-activation-notification"}],"title":"6.2.1. User Activation\nMonkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/interaction.html#activation-notification"},
"3a2db83f": {"dfnID":"3a2db83f","dfnText":"localStorage","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-localstorage"}],"title":"5.1.3. Brave"}],"url":"https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage"},
"3e12e042": {"dfnID":"3e12e042","dfnText":"environment settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object"},{"id":"ref-for-environment-settings-object\u2460"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"},{"id":"ref-for-ordered-map\u2460"}],"title":"6.1.1. Global Data"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"4473e129": {"dfnID":"4473e129","dfnText":"obtain a storage bottle map","external":true,"refSections":[{"refs":[{"id":"ref-for-obtain-a-storage-bottle-map"},{"id":"ref-for-obtain-a-storage-bottle-map\u2460"},{"id":"ref-for-obtain-a-storage-bottle-map\u2461"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map"},
"448c95f9": {"dfnID":"448c95f9","dfnText":"http-equiv","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-meta-http-equiv"}],"title":"3. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv"},
"45209803": {"dfnID":"45209803","dfnText":"for each (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-iterate"},{"id":"ref-for-map-iterate\u2460"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-map-iterate\u2461"}],"title":"6.2.5. Deletion"}],"url":"https://infra.spec.whatwg.org/#map-iterate"},
"47dfca75": {"dfnID":"47dfca75","dfnText":"queue","external":true,"refSections":[{"refs":[{"id":"ref-for-queue"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://infra.spec.whatwg.org/#queue"},
"48438eb3": {"dfnID":"48438eb3","dfnText":"queue a global task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-global-task"}],"title":"6.2.3.5. Response Received Monkey\nPatch"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"},
"4a139803": {"dfnID":"4a139803","dfnText":"http 3xx statuses","external":true,"refSections":[{"refs":[{"id":"ref-for-status.3xx"}],"title":"3. Terminology"}],"url":"https://httpwg.org/specs/rfc7231.html#status.3xx"},
"4b2c8c72": {"dfnID":"4b2c8c72","dfnText":"duration","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-duration"},{"id":"ref-for-dfn-duration\u2460"},{"id":"ref-for-dfn-duration\u2461"},{"id":"ref-for-dfn-duration\u2462"}],"title":"6.1.3. Constants"}],"url":"https://w3c.github.io/hr-time/#dfn-duration"},
"4b6086d7": {"dfnID":"4b6086d7","dfnText":"global object","external":true,"refSections":[{"refs":[{"id":"ref-for-global-object"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-global-object\u2460"}],"title":"6.2.4. Timers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#global-object"},
"4be6272b": {"dfnID":"4be6272b","dfnText":"success","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-success"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"https://w3c.github.io/webdriver/#dfn-success"},
"5423e8ff": {"dfnID":"5423e8ff","dfnText":"hyperlink","external":true,"refSections":[{"refs":[{"id":"ref-for-hyperlink"}],"title":"3. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/links.html#hyperlink"},
"543878fa": {"dfnID":"543878fa","dfnText":"append","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-node-append"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://dom.spec.whatwg.org/#concept-node-append"},
"55213b5b": {"dfnID":"55213b5b","dfnText":"request","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://fetch.spec.whatwg.org/#concept-request"},
"5ac0e3d4": {"dfnID":"5ac0e3d4","dfnText":"domain-match","external":true,"refSections":[{"refs":[{"id":"ref-for-section-5.1.3"},{"id":"ref-for-section-5.1.3\u2460"}],"title":"6.2.5. Deletion"}],"url":"https://tools.ietf.org/html/rfc6265/#section-5.1.3"},
"602b1a68": {"dfnID":"602b1a68","dfnText":"obtain a site","external":true,"refSections":[{"refs":[{"id":"ref-for-obtain-a-site"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-obtain-a-site\u2460"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-obtain-a-site\u2461"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-obtain-a-site\u2462"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-obtain-a-site\u2463"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-obtain-a-site\u2464"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-obtain-a-site\u2465"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"},{"refs":[{"id":"ref-for-obtain-a-site\u2466"}],"title":"6.2.4. Timers"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-list\u2460"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"}],"url":"https://infra.spec.whatwg.org/#list"},
"64b89595": {"dfnID":"64b89595","dfnText":"meta","external":true,"refSections":[{"refs":[{"id":"ref-for-meta"}],"title":"3. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/semantics.html#meta"},
"660191f0": {"dfnID":"660191f0","dfnText":"storage shed","external":true,"refSections":[{"refs":[{"id":"ref-for-storage-shed"}],"title":"6.2.5. Deletion"}],"url":"https://storage.spec.whatwg.org/#storage-shed"},
"6945cc54": {"dfnID":"6945cc54","dfnText":"unknown error","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-unknown-error"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"https://w3c.github.io/webdriver/#dfn-unknown-error"},
"69ba1a02": {"dfnID":"69ba1a02","dfnText":"cookie store","external":true,"refSections":[{"refs":[{"id":"ref-for-section-5.3"},{"id":"ref-for-section-5.3\u2460"}],"title":"6.2.5. Deletion"}],"url":"https://tools.ietf.org/html/rfc6265/#section-5.3"},
"752d140b": {"dfnID":"752d140b","dfnText":"host","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-host"},{"id":"ref-for-concept-host\u2460"},{"id":"ref-for-concept-host\u2461"},{"id":"ref-for-concept-host\u2462"}],"title":"6.1.1. Global Data"},{"refs":[{"id":"ref-for-concept-host\u2463"},{"id":"ref-for-concept-host\u2464"},{"id":"ref-for-concept-host\u2465"},{"id":"ref-for-concept-host\u2466"},{"id":"ref-for-concept-host\u2467"}],"title":"6.1.2. Per-Tab Data"},{"refs":[{"id":"ref-for-concept-host\u2468"},{"id":"ref-for-concept-host\u2460\u24ea"}],"title":"6.1.3. Constants"},{"refs":[{"id":"ref-for-concept-host\u2460\u2460"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-host\u2460\u2461"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-concept-host\u2460\u2462"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-host\u2460\u2463"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-concept-host\u2460\u2464"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-concept-host\u2460\u2465"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-concept-host\u2460\u2466"},{"id":"ref-for-concept-host\u2460\u2467"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"},{"refs":[{"id":"ref-for-concept-host\u2460\u2468"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-concept-host\u2461\u24ea"},{"id":"ref-for-concept-host\u2461\u2460"},{"id":"ref-for-concept-host\u2461\u2461"},{"id":"ref-for-concept-host\u2461\u2462"},{"id":"ref-for-concept-host\u2461\u2463"}],"title":"6.2.5. Deletion"},{"refs":[{"id":"ref-for-concept-host\u2461\u2464"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"https://url.spec.whatwg.org/#concept-host"},
"77093875": {"dfnID":"77093875","dfnText":"source snapshot params","external":true,"refSections":[{"refs":[{"id":"ref-for-source-snapshot-params"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params"},
"77b4c09a": {"dfnID":"77b4c09a","dfnText":"assert","external":true,"refSections":[{"refs":[{"id":"ref-for-assert"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-assert\u2460"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"},{"refs":[{"id":"ref-for-assert\u2461"},{"id":"ref-for-assert\u2462"},{"id":"ref-for-assert\u2463"},{"id":"ref-for-assert\u2464"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-assert\u2465"}],"title":"6.2.5. Deletion"}],"url":"https://infra.spec.whatwg.org/#assert"},
"7d4424b2": {"dfnID":"7d4424b2","dfnText":"remove","external":true,"refSections":[{"refs":[{"id":"ref-for-map-remove"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-map-remove\u2460"},{"id":"ref-for-map-remove\u2461"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-map-remove\u2462"}],"title":"6.2.5. Deletion"}],"url":"https://infra.spec.whatwg.org/#map-remove"},
"7f6a70d1": {"dfnID":"7f6a70d1","dfnText":"storage key","external":true,"refSections":[{"refs":[{"id":"ref-for-storage-key"}],"title":"6.2.5. Deletion"}],"url":"https://storage.spec.whatwg.org/#storage-key"},
"82c23298": {"dfnID":"82c23298","dfnText":"remote end steps","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-remote-end-steps"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"https://w3c.github.io/webdriver/#dfn-remote-end-steps"},
"839611db": {"dfnID":"839611db","dfnText":"subresource request","external":true,"refSections":[{"refs":[{"id":"ref-for-subresource-request"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://fetch.spec.whatwg.org/#subresource-request"},
"83c59a3a": {"dfnID":"83c59a3a","dfnText":"WorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-workerglobalscope"},{"id":"ref-for-workerglobalscope\u2460"},{"id":"ref-for-workerglobalscope\u2461"},{"id":"ref-for-workerglobalscope\u2462"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope"},
"857d5516": {"dfnID":"857d5516","dfnText":"client","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-client"},{"id":"ref-for-concept-request-client\u2460"},{"id":"ref-for-concept-request-client\u2461"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"8596ac55": {"dfnID":"8596ac55","dfnText":"run steps after a timeout","external":true,"refSections":[{"refs":[{"id":"ref-for-run-steps-after-a-timeout"}],"title":"6.2.3.5. Response Received Monkey\nPatch"}],"url":"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout"},
"860300d4": {"dfnID":"860300d4","dfnText":"implementation-defined","external":true,"refSections":[{"refs":[{"id":"ref-for-implementation-defined"},{"id":"ref-for-implementation-defined\u2460"},{"id":"ref-for-implementation-defined\u2461"},{"id":"ref-for-implementation-defined\u2462"}],"title":"6.1.3. Constants"}],"url":"https://infra.spec.whatwg.org/#implementation-defined"},
"87fcd40c": {"dfnID":"87fcd40c","dfnText":"iframe","external":true,"refSections":[{"refs":[{"id":"ref-for-the-iframe-element"}],"title":"3. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element"},
"8ad2567a": {"dfnID":"8ad2567a","dfnText":"equal","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-host-equals"},{"id":"ref-for-concept-host-equals\u2460"}],"title":"6.2.4. Timers"}],"url":"https://url.spec.whatwg.org/#concept-host-equals"},
"8f5e1aba": {"dfnID":"8f5e1aba","dfnText":"is closing","external":true,"refSections":[{"refs":[{"id":"ref-for-is-closing"}],"title":"6.2.4. Timers"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#is-closing"},
"91d31374": {"dfnID":"91d31374","dfnText":"PublicKeyCredential","external":true,"refSections":[{"refs":[{"id":"ref-for-publickeycredential"}],"title":"6.2.2. Web Authentication Monkey Patch"}],"url":"https://w3c.github.io/webauthn/#publickeycredential"},
"921cf04f": {"dfnID":"921cf04f","dfnText":"domain attribute","external":true,"refSections":[{"refs":[{"id":"ref-for-section-5.2.3"}],"title":"6.2.5. Deletion"}],"url":"https://tools.ietf.org/html/rfc6265/#section-5.2.3"},
"93ce1392": {"dfnID":"93ce1392","dfnText":"location","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-location"}],"title":"3. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location"},
"95a8ae14": {"dfnID":"95a8ae14","dfnText":"window","external":true,"refSections":[{"refs":[{"id":"ref-for-window"},{"id":"ref-for-window\u2460"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://drafts.csswg.org/css-color-3/#window"},
"980528b0": {"dfnID":"980528b0","dfnText":"http-network-or-cache fetch","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-http-network-or-cache-fetch"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch"},
"984221ca": {"dfnID":"984221ca","dfnText":"struct","external":true,"refSections":[{"refs":[{"id":"ref-for-struct"}],"title":"6.1.2. Per-Tab Data"}],"url":"https://infra.spec.whatwg.org/#struct"},
"9a9b558b": {"dfnID":"9a9b558b","dfnText":"dequeue","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-dequeue"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://infra.spec.whatwg.org/#queue-dequeue"},
"9c19b7fc": {"dfnID":"9c19b7fc","dfnText":"navigable","external":true,"refSections":[{"refs":[{"id":"ref-for-navigable"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-navigable\u2460"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-navigable\u2461"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-navigable\u2462"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable"},
"9c4c1e66": {"dfnID":"9c4c1e66","dfnText":"relevant settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-relevant-settings-object"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-relevant-settings-object\u2460"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-relevant-settings-object\u2461"}],"title":"6.2.4. Timers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"},
"a326add7": {"dfnID":"a326add7","dfnText":"contain (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"},{"id":"ref-for-map-exists\u2460"},{"id":"ref-for-map-exists\u2461"},{"id":"ref-for-map-exists\u2462"}],"title":"6.2.4. Timers"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"a3b18719": {"dfnID":"a3b18719","dfnText":"append","external":true,"refSections":[{"refs":[{"id":"ref-for-set-append"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-set-append\u2460"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-set-append\u2461"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-set-append\u2462"},{"id":"ref-for-set-append\u2463"},{"id":"ref-for-set-append\u2464"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://infra.spec.whatwg.org/#set-append"},
"a6732b20": {"dfnID":"a6732b20","dfnText":"network cache","external":true,"refSections":[{"refs":[{"id":"ref-for-section-2"},{"id":"ref-for-section-2\u2460"}],"title":"6.2.5. Deletion"}],"url":"https://tools.ietf.org/html/rfc9111/#section-2"},
"a7c53389": {"dfnID":"a7c53389","dfnText":"partitioned cookie","external":true,"refSections":[{"refs":[{"id":"ref-for-section-2.1"},{"id":"ref-for-section-2.1\u2460"}],"title":"6.2.5. Deletion"}],"url":"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.1"},
"a869e769": {"dfnID":"a869e769","dfnText":"unsupported operation","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-unsupported-operation"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"https://w3c.github.io/webdriver/#dfn-unsupported-operation"},
"a973e0fe": {"dfnID":"a973e0fe","dfnText":"document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-document\u2460"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-document\u2461"},{"id":"ref-for-concept-document\u2462"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-concept-document\u2463"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"}],"url":"https://dom.spec.whatwg.org/#concept-document"},
"abe352cd": {"dfnID":"abe352cd","dfnText":"reserved client","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-reserved-client"},{"id":"ref-for-concept-request-reserved-client\u2460"},{"id":"ref-for-concept-request-reserved-client\u2461"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://fetch.spec.whatwg.org/#concept-request-reserved-client"},
"ae8def21": {"dfnID":"ae8def21","dfnText":"contain (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-contain"}],"title":"6.2.4. Timers"}],"url":"https://infra.spec.whatwg.org/#list-contain"},
"b01b1359": {"dfnID":"b01b1359","dfnText":"opaque origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-opaque"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-origin-opaque\u2460"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-concept-origin-opaque\u2461"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-origin-opaque\u2462"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-concept-origin-opaque\u2463"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-concept-origin-opaque\u2464"}],"title":"6.2.5. Deletion"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque"},
"b6ae4501": {"dfnID":"b6ae4501","dfnText":"networking task source","external":true,"refSections":[{"refs":[{"id":"ref-for-networking-task-source"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-networking-task-source\u2460"}],"title":"6.2.3.5. Response Received Monkey\nPatch"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source"},
"b8308563": {"dfnID":"b8308563","dfnText":"DedicatedWorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-dedicatedworkerglobalscope"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope"},
"b9429bc2": {"dfnID":"b9429bc2","dfnText":"insert","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-node-insert"}],"title":"6.2.3.5. Response Received Monkey\nPatch"}],"url":"https://dom.spec.whatwg.org/#concept-node-insert"},
"ba244b14": {"dfnID":"ba244b14","dfnText":"load a document","external":true,"refSections":[{"refs":[{"id":"ref-for-loading-a-document"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#loading-a-document"},
"bb4c269e": {"dfnID":"bb4c269e","dfnText":"error","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-error"},{"id":"ref-for-dfn-error\u2460"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"https://w3c.github.io/webdriver/#dfn-error"},
"bc9d7803": {"dfnID":"bc9d7803","dfnText":"registrable domain","external":true,"refSections":[{"refs":[{"id":"ref-for-host-registrable-domain"}],"title":"5.1.1. Safari"},{"refs":[{"id":"ref-for-host-registrable-domain\u2460"},{"id":"ref-for-host-registrable-domain\u2461"}],"title":"6.2.5. Deletion"}],"url":"https://url.spec.whatwg.org/#host-registrable-domain"},
"bd736ec6": {"dfnID":"bd736ec6","dfnText":"top-level traversable","external":true,"refSections":[{"refs":[{"id":"ref-for-top-level-traversable"},{"id":"ref-for-top-level-traversable\u2460"}],"title":"6.1.2. Per-Tab Data"},{"refs":[{"id":"ref-for-top-level-traversable\u2461"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable\u2462"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable\u2463"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable\u2464"}],"title":"6.2.3.3. Service Worker Activation Monkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable\u2465"},{"id":"ref-for-top-level-traversable\u2466"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable\u2467"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-top-level-traversable\u2468"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"},{"refs":[{"id":"ref-for-top-level-traversable\u2460\u24ea"},{"id":"ref-for-top-level-traversable\u2460\u2460"}],"title":"6.2.4. Timers"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable"},
"bounce-tracking": {"dfnID":"bounce-tracking","dfnText":"Bounce tracking","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking"}],"title":"3. Terminology"}],"url":"#bounce-tracking"},
"bounce-tracking-activation-lifetime": {"dfnID":"bounce-tracking-activation-lifetime","dfnText":"bounce tracking activation lifetime","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-activation-lifetime"}],"title":"6.1.3. Constants"},{"refs":[{"id":"ref-for-bounce-tracking-activation-lifetime\u2460"}],"title":"6.2.4. Timers"}],"url":"#bounce-tracking-activation-lifetime"},
"bounce-tracking-grace-period": {"dfnID":"bounce-tracking-grace-period","dfnText":"bounce tracking grace period","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-grace-period"}],"title":"6.1.3. Constants"},{"refs":[{"id":"ref-for-bounce-tracking-grace-period\u2460"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-bounce-tracking-grace-period\u2461"},{"id":"ref-for-bounce-tracking-grace-period\u2462"},{"id":"ref-for-bounce-tracking-grace-period\u2463"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"#bounce-tracking-grace-period"},
"bounce-tracking-record": {"dfnID":"bounce-tracking-record","dfnText":"bounce tracking record","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-record"}],"title":"6.1.2. Per-Tab Data"},{"refs":[{"id":"ref-for-bounce-tracking-record\u2460"},{"id":"ref-for-bounce-tracking-record\u2461"},{"id":"ref-for-bounce-tracking-record\u2462"},{"id":"ref-for-bounce-tracking-record\u2463"},{"id":"ref-for-bounce-tracking-record\u2464"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"}],"url":"#bounce-tracking-record"},
"bounce-tracking-record-bounce-set": {"dfnID":"bounce-tracking-record-bounce-set","dfnText":"bounce set","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-record-bounce-set"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-bounce-tracking-record-bounce-set\u2460"},{"id":"ref-for-bounce-tracking-record-bounce-set\u2461"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-bounce-tracking-record-bounce-set\u2462"}],"title":"6.2.4. Timers"}],"url":"#bounce-tracking-record-bounce-set"},
"bounce-tracking-record-final-host": {"dfnID":"bounce-tracking-record-final-host","dfnText":"final host","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-record-final-host"},{"id":"ref-for-bounce-tracking-record-final-host\u2460"},{"id":"ref-for-bounce-tracking-record-final-host\u2461"},{"id":"ref-for-bounce-tracking-record-final-host\u2462"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"},{"refs":[{"id":"ref-for-bounce-tracking-record-final-host\u2463"}],"title":"6.2.4. Timers"}],"url":"#bounce-tracking-record-final-host"},
"bounce-tracking-record-initial-host": {"dfnID":"bounce-tracking-record-initial-host","dfnText":"initial host","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-record-initial-host"},{"id":"ref-for-bounce-tracking-record-initial-host\u2460"},{"id":"ref-for-bounce-tracking-record-initial-host\u2461"},{"id":"ref-for-bounce-tracking-record-initial-host\u2462"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-bounce-tracking-record-initial-host\u2463"}],"title":"6.2.4. Timers"}],"url":"#bounce-tracking-record-initial-host"},
"bounce-tracking-record-storage-access-set": {"dfnID":"bounce-tracking-record-storage-access-set","dfnText":"storage access set","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-record-storage-access-set"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-bounce-tracking-record-storage-access-set\u2460"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-bounce-tracking-record-storage-access-set\u2461"},{"id":"ref-for-bounce-tracking-record-storage-access-set\u2462"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-bounce-tracking-record-storage-access-set\u2463"}],"title":"6.2.4. Timers"}],"url":"#bounce-tracking-record-storage-access-set"},
"bounce-tracking-record-user-activation-set": {"dfnID":"bounce-tracking-record-user-activation-set","dfnText":"user activation set","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-record-user-activation-set"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"}],"url":"#bounce-tracking-record-user-activation-set"},
"bounce-tracking-timer": {"dfnID":"bounce-tracking-timer","dfnText":"bounce tracking timer","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-timer"},{"id":"ref-for-bounce-tracking-timer\u2460"}],"title":"6.1.1. Global Data"},{"refs":[{"id":"ref-for-bounce-tracking-timer\u2461"}],"title":"6.1.3. Constants"},{"refs":[{"id":"ref-for-bounce-tracking-timer\u2462"},{"id":"ref-for-bounce-tracking-timer\u2463"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-bounce-tracking-timer\u2464"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"#bounce-tracking-timer"},
"bounce-tracking-timer-period": {"dfnID":"bounce-tracking-timer-period","dfnText":"bounce tracking timer period","external":false,"refSections":[{"refs":[{"id":"ref-for-bounce-tracking-timer-period"}],"title":"6.1.3. Constants"},{"refs":[{"id":"ref-for-bounce-tracking-timer-period\u2460"}],"title":"6.2.4. Timers"}],"url":"#bounce-tracking-timer-period"},
"c60ed63a": {"dfnID":"c60ed63a","dfnText":"service worker","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-service-worker"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://w3c.github.io/ServiceWorker/#dfn-service-worker"},
"c62cd7cf": {"dfnID":"c62cd7cf","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-origin"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-document-origin\u2460"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-concept-document-origin\u2461"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-document-origin\u2462"}],"title":"6.2.4. Timers"}],"url":"https://dom.spec.whatwg.org/#concept-document-origin"},
"c63519ed": {"dfnID":"c63519ed","dfnText":"top-level origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-environment-top-level-origin"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"},
"c8ff8493": {"dfnID":"c8ff8493","dfnText":"error code","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-error-code"},{"id":"ref-for-dfn-error-code\u2460"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"https://w3c.github.io/webdriver/#dfn-error-code"},
"cbdc89b4": {"dfnID":"cbdc89b4","dfnText":"while","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-while"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://infra.spec.whatwg.org/#iteration-while"},
"ce15d5dc": {"dfnID":"ce15d5dc","dfnText":"realm execution context","external":true,"refSections":[{"refs":[{"id":"ref-for-realm-execution-context"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context"},
"cfc67fdc": {"dfnID":"cfc67fdc","dfnText":"empty host","external":true,"refSections":[{"refs":[{"id":"ref-for-empty-host"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"}],"url":"https://url.spec.whatwg.org/#empty-host"},
"clear-cache-for-host": {"dfnID":"clear-cache-for-host","dfnText":"clear cache for host","external":false,"refSections":[{"refs":[{"id":"ref-for-clear-cache-for-host"}],"title":"6.2.4. Timers"}],"url":"#clear-cache-for-host"},
"clear-cookies-for-host": {"dfnID":"clear-cookies-for-host","dfnText":"clear cookies for host","external":false,"refSections":[{"refs":[{"id":"ref-for-clear-cookies-for-host"}],"title":"6.2.4. Timers"}],"url":"#clear-cookies-for-host"},
"clear-non-cookie-storage-for-host": {"dfnID":"clear-non-cookie-storage-for-host","dfnText":"clear non-cookie storage for host","external":false,"refSections":[{"refs":[{"id":"ref-for-clear-non-cookie-storage-for-host"}],"title":"6.2.4. Timers"}],"url":"#clear-non-cookie-storage-for-host"},
"client-bounce-detection-timer-period": {"dfnID":"client-bounce-detection-timer-period","dfnText":"client bounce detection timer period","external":false,"refSections":[{"refs":[{"id":"ref-for-client-bounce-detection-timer-period"}],"title":"6.1.3. Constants"},{"refs":[{"id":"ref-for-client-bounce-detection-timer-period\u2460"}],"title":"6.2.3.5. Response Received Monkey\nPatch"}],"url":"#client-bounce-detection-timer-period"},
"d0c1b934": {"dfnID":"d0c1b934","dfnText":"traversable navigable","external":true,"refSections":[{"refs":[{"id":"ref-for-traversable-navigable"}],"title":"6.2.5. Deletion"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"},
"d75f6c27": {"dfnID":"d75f6c27","dfnText":"http-network fetch","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-http-network-fetch"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://fetch.spec.whatwg.org/#concept-http-network-fetch"},
"d85a6c84": {"dfnID":"d85a6c84","dfnText":"header list","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-header-list"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://fetch.spec.whatwg.org/#concept-header-list"},
"dc248371": {"dfnID":"dc248371","dfnText":"owner set","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-WorkerGlobalScope-owner-set"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"},
"dcffbccd": {"dfnID":"dcffbccd","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url"}],"title":"3. Terminology"},{"refs":[{"id":"ref-for-concept-url\u2460"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-concept-url\u2461"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"}],"url":"https://url.spec.whatwg.org/#concept-url"},
"dfa9c14c": {"dfnID":"dfa9c14c","dfnText":"has transient activation","external":true,"refSections":[{"refs":[{"id":"ref-for-source-snapshot-params-activation"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation"},
"e7b2fe41": {"dfnID":"e7b2fe41","dfnText":"refresh","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-meta-http-equiv-keyword-refresh"}],"title":"3. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh"},
"e99bd18e": {"dfnID":"e99bd18e","dfnText":"relevant global object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-relevant-global"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-concept-relevant-global\u2460"}],"title":"6.2.3.5. Response Received Monkey\nPatch"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"},
"ef4a9b44": {"dfnID":"ef4a9b44","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-storage-key-origin"}],"title":"6.2.5. Deletion"}],"url":"https://storage.spec.whatwg.org/#storage-key-origin"},
"extended-navigation": {"dfnID":"extended-navigation","dfnText":"extended navigation","external":false,"refSections":[{"refs":[{"id":"ref-for-extended-navigation"},{"id":"ref-for-extended-navigation\u2460"},{"id":"ref-for-extended-navigation\u2461"},{"id":"ref-for-extended-navigation\u2462"},{"id":"ref-for-extended-navigation\u2463"},{"id":"ref-for-extended-navigation\u2464"},{"id":"ref-for-extended-navigation\u2465"},{"id":"ref-for-extended-navigation\u2466"}],"title":"6.1.2. Per-Tab Data"},{"refs":[{"id":"ref-for-extended-navigation\u2467"}],"title":"6.1.3. Constants"},{"refs":[{"id":"ref-for-extended-navigation\u2468"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-extended-navigation\u2460\u24ea"}],"title":"6.2.3.3. Service Worker Activation Monkey Patch"},{"refs":[{"id":"ref-for-extended-navigation\u2460\u2460"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-extended-navigation\u2460\u2461"}],"title":"6.2.4. Timers"}],"url":"#extended-navigation"},
"f16ee824": {"dfnID":"f16ee824","dfnText":"current wall time","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-eso-current-wall-time"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-dfn-eso-current-wall-time\u2460"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-dfn-eso-current-wall-time\u2461"}],"title":"6.2.4. Timers"}],"url":"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time"},
"f78d5b5c": {"dfnID":"f78d5b5c","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-origin"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"}],"url":"https://fetch.spec.whatwg.org/#concept-request-origin"},
"f937b7b6": {"dfnID":"f937b7b6","dfnText":"continue","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-continue"},{"id":"ref-for-iteration-continue\u2460"},{"id":"ref-for-iteration-continue\u2461"},{"id":"ref-for-iteration-continue\u2462"},{"id":"ref-for-iteration-continue\u2463"},{"id":"ref-for-iteration-continue\u2464"},{"id":"ref-for-iteration-continue\u2465"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-iteration-continue\u2466"},{"id":"ref-for-iteration-continue\u2467"},{"id":"ref-for-iteration-continue\u2468"},{"id":"ref-for-iteration-continue\u2460\u24ea"}],"title":"6.2.5. Deletion"}],"url":"https://infra.spec.whatwg.org/#iteration-continue"},
"fb9bb722": {"dfnID":"fb9bb722","dfnText":"site","external":true,"refSections":[{"refs":[{"id":"ref-for-site"},{"id":"ref-for-site\u2460"},{"id":"ref-for-site\u2461"},{"id":"ref-for-site\u2462"}],"title":"6.1.1. Global Data"},{"refs":[{"id":"ref-for-site\u2463"},{"id":"ref-for-site\u2464"},{"id":"ref-for-site\u2465"},{"id":"ref-for-site\u2466"},{"id":"ref-for-site\u2467"}],"title":"6.1.2. Per-Tab Data"},{"refs":[{"id":"ref-for-site\u2468"},{"id":"ref-for-site\u2460\u24ea"}],"title":"6.1.3. Constants"},{"refs":[{"id":"ref-for-site\u2460\u2460"},{"id":"ref-for-site\u2460\u2461"},{"id":"ref-for-site\u2460\u2462"},{"id":"ref-for-site\u2460\u2463"}],"title":"6.2.5. Deletion"},{"refs":[{"id":"ref-for-site\u2460\u2464"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#site"},
"feac4ab3": {"dfnID":"feac4ab3","dfnText":"same site","external":true,"refSections":[{"refs":[{"id":"ref-for-same-site"},{"id":"ref-for-same-site\u2460"}],"title":"6.2.5. Deletion"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#same-site"},
"ff8d2a6f": {"dfnID":"ff8d2a6f","dfnText":"url list","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-url-list"}],"title":"6.2.3.5. Response Received Monkey\nPatch"}],"url":"https://fetch.spec.whatwg.org/#concept-response-url-list"},
"link-decoration": {"dfnID":"link-decoration","dfnText":"Link decoration","external":false,"refSections":[{"refs":[{"id":"ref-for-link-decoration"},{"id":"ref-for-link-decoration\u2460"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-link-decoration\u2461"},{"id":"ref-for-link-decoration\u2462"},{"id":"ref-for-link-decoration\u2463"},{"id":"ref-for-link-decoration\u2464"},{"id":"ref-for-link-decoration\u2465"},{"id":"ref-for-link-decoration\u2466"},{"id":"ref-for-link-decoration\u2467"}],"title":"3. Terminology"}],"url":"#link-decoration"},
"navigational-tracking": {"dfnID":"navigational-tracking","dfnText":"Navigational tracking","external":false,"refSections":[{"refs":[{"id":"ref-for-navigational-tracking"},{"id":"ref-for-navigational-tracking\u2460"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-navigational-tracking\u2461"},{"id":"ref-for-navigational-tracking\u2462"},{"id":"ref-for-navigational-tracking\u2463"},{"id":"ref-for-navigational-tracking\u2464"},{"id":"ref-for-navigational-tracking\u2465"}],"title":"3. Terminology"},{"refs":[{"id":"ref-for-navigational-tracking\u2466"}],"title":"5.1. Deployed Mitigations"},{"refs":[{"id":"ref-for-navigational-tracking\u2467"}],"title":"5.1.1. Safari"},{"refs":[{"id":"ref-for-navigational-tracking\u2468"}],"title":"5.1.2. Firefox"},{"refs":[{"id":"ref-for-navigational-tracking\u2460\u24ea"},{"id":"ref-for-navigational-tracking\u2460\u2460"}],"title":"5.1.3. Brave"}],"url":"#navigational-tracking"},
"process-a-fetch-storage-access-for-bounce-tracking-mitigations": {"dfnID":"process-a-fetch-storage-access-for-bounce-tracking-mitigations","dfnText":"process a fetch storage access for bounce tracking mitigations","external":false,"refSections":[{"refs":[{"id":"ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations"},{"id":"ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations\u2460"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations\u2461"}],"title":"6.2.3.3. Service Worker Activation Monkey Patch"},{"refs":[{"id":"ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations\u2462"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"#process-a-fetch-storage-access-for-bounce-tracking-mitigations"},
"process-a-general-storage-access-for-bounce-tracking-mitigations": {"dfnID":"process-a-general-storage-access-for-bounce-tracking-mitigations","dfnText":"process a general storage access for bounce tracking mitigations","external":false,"refSections":[{"refs":[{"id":"ref-for-process-a-general-storage-access-for-bounce-tracking-mitigations"},{"id":"ref-for-process-a-general-storage-access-for-bounce-tracking-mitigations\u2460"}],"title":"6.2.3.4. Storage Access Monkey Patch"}],"url":"#process-a-general-storage-access-for-bounce-tracking-mitigations"},
"process-a-web-authentication-assertion-for-bounce-tracking-mitigations": {"dfnID":"process-a-web-authentication-assertion-for-bounce-tracking-mitigations","dfnText":"process a Web Authentication assertion for bounce tracking mitigations","external":false,"refSections":[{"refs":[{"id":"ref-for-process-a-web-authentication-assertion-for-bounce-tracking-mitigations"}],"title":"6.2.2. Web Authentication Monkey Patch"}],"url":"#process-a-web-authentication-assertion-for-bounce-tracking-mitigations"},
"process-document-load-for-bounce-tracking": {"dfnID":"process-document-load-for-bounce-tracking","dfnText":"process document load for bounce tracking","external":false,"refSections":[{"refs":[{"id":"ref-for-process-document-load-for-bounce-tracking"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"}],"url":"#process-document-load-for-bounce-tracking"},
"process-navigation-start-for-bounce-tracking": {"dfnID":"process-navigation-start-for-bounce-tracking","dfnText":"process navigation start for bounce tracking","external":false,"refSections":[{"refs":[{"id":"ref-for-process-navigation-start-for-bounce-tracking"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-process-navigation-start-for-bounce-tracking\u2460"}],"title":"6.2.4. Timers"}],"url":"#process-navigation-start-for-bounce-tracking"},
"process-response-received-for-bounce-tracking": {"dfnID":"process-response-received-for-bounce-tracking","dfnText":"process response received for bounce tracking","external":false,"refSections":[{"refs":[{"id":"ref-for-process-response-received-for-bounce-tracking"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-process-response-received-for-bounce-tracking\u2460"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"},{"refs":[{"id":"ref-for-process-response-received-for-bounce-tracking\u2461"}],"title":"6.2.4. Timers"}],"url":"#process-response-received-for-bounce-tracking"},
"record-a-user-activation": {"dfnID":"record-a-user-activation","dfnText":"record a user activation","external":false,"refSections":[{"refs":[{"id":"ref-for-record-a-user-activation"}],"title":"6.2.1. User Activation\nMonkey Patch"}],"url":"#record-a-user-activation"},
"record-stateful-bounces-for-bounce-tracking": {"dfnID":"record-stateful-bounces-for-bounce-tracking","dfnText":"record stateful bounces for bounce tracking","external":false,"refSections":[{"refs":[{"id":"ref-for-record-stateful-bounces-for-bounce-tracking"},{"id":"ref-for-record-stateful-bounces-for-bounce-tracking\u2460"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-record-stateful-bounces-for-bounce-tracking\u2461"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-record-stateful-bounces-for-bounce-tracking\u2462"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"}],"url":"#record-stateful-bounces-for-bounce-tracking"},
"stateful-bounce-tracking-map": {"dfnID":"stateful-bounce-tracking-map","dfnText":"stateful bounce tracking map","external":false,"refSections":[{"refs":[{"id":"ref-for-stateful-bounce-tracking-map"},{"id":"ref-for-stateful-bounce-tracking-map\u2460"}],"title":"6.1.1. Global Data"},{"refs":[{"id":"ref-for-stateful-bounce-tracking-map\u2461"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-stateful-bounce-tracking-map\u2462"},{"id":"ref-for-stateful-bounce-tracking-map\u2463"},{"id":"ref-for-stateful-bounce-tracking-map\u2464"},{"id":"ref-for-stateful-bounce-tracking-map\u2465"},{"id":"ref-for-stateful-bounce-tracking-map\u2466"}],"title":"6.2.4. Timers"},{"refs":[{"id":"ref-for-stateful-bounce-tracking-map\u2467"},{"id":"ref-for-stateful-bounce-tracking-map\u2468"}],"title":"6.3.1. Run Bounce Tracking Mitigations"}],"url":"#stateful-bounce-tracking-map"},
"top-level-traversable-bounce-tracking-record": {"dfnID":"top-level-traversable-bounce-tracking-record","dfnText":"bounce tracking record","external":false,"refSections":[{"refs":[{"id":"ref-for-top-level-traversable-bounce-tracking-record"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2461"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2462"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2463"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2464"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2465"}],"title":"6.2.3.1. Start Navigation\nMonkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2466"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2467"}],"title":"6.2.3.2. Network\nCookie Write Monkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2468"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u24ea"}],"title":"6.2.3.4. Storage Access Monkey Patch"},{"refs":[{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2460"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2461"}],"title":"6.2.3.5. Response Received Monkey\nPatch"},{"refs":[{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2462"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2463"}],"title":"6.2.3.6. Document Loaded Monkey\nPatch"},{"refs":[{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2464"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2465"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2466"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2467"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2460\u2468"},{"id":"ref-for-top-level-traversable-bounce-tracking-record\u2461\u24ea"}],"title":"6.2.4. Timers"}],"url":"#top-level-traversable-bounce-tracking-record"},
"user-activation-map": {"dfnID":"user-activation-map","dfnText":"user activation map","external":false,"refSections":[{"refs":[{"id":"ref-for-user-activation-map"}],"title":"6.1.1. Global Data"},{"refs":[{"id":"ref-for-user-activation-map\u2460"}],"title":"6.2.1. User Activation\nMonkey Patch"},{"refs":[{"id":"ref-for-user-activation-map\u2461"},{"id":"ref-for-user-activation-map\u2462"}],"title":"6.2.2. Web Authentication Monkey Patch"},{"refs":[{"id":"ref-for-user-activation-map\u2463"},{"id":"ref-for-user-activation-map\u2464"},{"id":"ref-for-user-activation-map\u2465"},{"id":"ref-for-user-activation-map\u2466"}],"title":"6.2.4. Timers"}],"url":"#user-activation-map"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#bounce-tracking": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"bounce tracking","type":"dfn","url":"#bounce-tracking"},
"#bounce-tracking-activation-lifetime": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"bounce tracking activation lifetime","type":"dfn","url":"#bounce-tracking-activation-lifetime"},
"#bounce-tracking-grace-period": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"bounce tracking grace period","type":"dfn","url":"#bounce-tracking-grace-period"},
"#bounce-tracking-record": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"bounce tracking record","type":"dfn","url":"#bounce-tracking-record"},
"#bounce-tracking-record-bounce-set": {"export":true,"for_":["bounce tracking record"],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"bounce set","type":"dfn","url":"#bounce-tracking-record-bounce-set"},
"#bounce-tracking-record-final-host": {"export":true,"for_":["bounce tracking record"],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"final host","type":"dfn","url":"#bounce-tracking-record-final-host"},
"#bounce-tracking-record-initial-host": {"export":true,"for_":["bounce tracking record"],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"initial host","type":"dfn","url":"#bounce-tracking-record-initial-host"},
"#bounce-tracking-record-storage-access-set": {"export":true,"for_":["bounce tracking record"],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"storage access set","type":"dfn","url":"#bounce-tracking-record-storage-access-set"},
"#bounce-tracking-record-user-activation-set": {"export":true,"for_":["bounce tracking record"],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"user activation set","type":"dfn","url":"#bounce-tracking-record-user-activation-set"},
"#bounce-tracking-timer": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"bounce tracking timer","type":"dfn","url":"#bounce-tracking-timer"},
"#bounce-tracking-timer-period": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"bounce tracking timer period","type":"dfn","url":"#bounce-tracking-timer-period"},
"#clear-cache-for-host": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"clear cache for host","type":"dfn","url":"#clear-cache-for-host"},
"#clear-cookies-for-host": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"clear cookies for host","type":"dfn","url":"#clear-cookies-for-host"},
"#clear-non-cookie-storage-for-host": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"clear non-cookie storage for host","type":"dfn","url":"#clear-non-cookie-storage-for-host"},
"#client-bounce-detection-timer-period": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"client bounce detection timer period","type":"dfn","url":"#client-bounce-detection-timer-period"},
"#extended-navigation": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"extended navigation","type":"dfn","url":"#extended-navigation"},
"#link-decoration": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"link decoration","type":"dfn","url":"#link-decoration"},
"#navigational-tracking": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"navigational tracking","type":"dfn","url":"#navigational-tracking"},
"#process-a-fetch-storage-access-for-bounce-tracking-mitigations": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"process a fetch storage access for bounce tracking mitigations","type":"dfn","url":"#process-a-fetch-storage-access-for-bounce-tracking-mitigations"},
"#process-a-general-storage-access-for-bounce-tracking-mitigations": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"process a general storage access for bounce tracking mitigations","type":"dfn","url":"#process-a-general-storage-access-for-bounce-tracking-mitigations"},
"#process-a-web-authentication-assertion-for-bounce-tracking-mitigations": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"process a web authentication assertion for bounce tracking mitigations","type":"dfn","url":"#process-a-web-authentication-assertion-for-bounce-tracking-mitigations"},
"#process-document-load-for-bounce-tracking": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"process document load for bounce tracking","type":"dfn","url":"#process-document-load-for-bounce-tracking"},
"#process-navigation-start-for-bounce-tracking": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"process navigation start for bounce tracking","type":"dfn","url":"#process-navigation-start-for-bounce-tracking"},
"#process-response-received-for-bounce-tracking": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"process response received for bounce tracking","type":"dfn","url":"#process-response-received-for-bounce-tracking"},
"#record-a-user-activation": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"record a user activation","type":"dfn","url":"#record-a-user-activation"},
"#record-stateful-bounces-for-bounce-tracking": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"record stateful bounces for bounce tracking","type":"dfn","url":"#record-stateful-bounces-for-bounce-tracking"},
"#stateful-bounce-tracking-map": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"stateful bounce tracking map","type":"dfn","url":"#stateful-bounce-tracking-map"},
"#top-level-traversable-bounce-tracking-record": {"export":true,"for_":["top-level traversable"],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"bounce tracking record","type":"dfn","url":"#top-level-traversable-bounce-tracking-record"},
"#user-activation-map": {"export":true,"for_":[],"level":"","normative":true,"shortname":"nav-tracking-mitigations","spec":"nav-tracking-mitigations","status":"local","text":"user activation map","type":"dfn","url":"#user-activation-map"},
"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.1": {"export":true,"for_":[],"level":"","normative":true,"shortname":"partitioned-cookies","spec":"partitioned-cookies","status":"anchor-block","text":"partitioned cookie","type":"dfn","url":"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.1"},
"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.2": {"export":true,"for_":[],"level":"","normative":true,"shortname":"partitioned-cookies","spec":"partitioned-cookies","status":"anchor-block","text":"partition key","type":"dfn","url":"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.2"},
"https://dom.spec.whatwg.org/#concept-document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"document","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document"},
"https://dom.spec.whatwg.org/#concept-document-origin": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"origin","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document-origin"},
"https://dom.spec.whatwg.org/#concept-node-append": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"append","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-node-append"},
"https://dom.spec.whatwg.org/#concept-node-insert": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"insert","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-node-insert"},
"https://drafts.csswg.org/css-color-3/#window": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-color","spec":"css-color-3","status":"current","text":"window","type":"dfn","url":"https://drafts.csswg.org/css-color-3/#window"},
"https://fetch.spec.whatwg.org/#concept-header-list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"header list","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-header-list"},
"https://fetch.spec.whatwg.org/#concept-http-network-fetch": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"http-network fetch","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-http-network-fetch"},
"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"http-network-or-cache fetch","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch"},
"https://fetch.spec.whatwg.org/#concept-request": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"request","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request"},
"https://fetch.spec.whatwg.org/#concept-request-client": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"client","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"https://fetch.spec.whatwg.org/#concept-request-origin": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"origin","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-origin"},
"https://fetch.spec.whatwg.org/#concept-request-reserved-client": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"reserved client","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-reserved-client"},
"https://fetch.spec.whatwg.org/#concept-response-url-list": {"export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"url list","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-url-list"},
"https://fetch.spec.whatwg.org/#subresource-request": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"subresource request","type":"dfn","url":"https://fetch.spec.whatwg.org/#subresource-request"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"opaque origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque"},
"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"obtain a site","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"},
"https://html.spec.whatwg.org/multipage/browsers.html#same-site": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"same site","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#same-site"},
"https://html.spec.whatwg.org/multipage/browsers.html#site": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"site","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#site"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"create navigation params by fetching","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#loading-a-document": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"load a document","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#loading-a-document"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"navigate","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"source snapshot params","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"has transient activation","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable": {"export":true,"for_":["browsing context"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"top-level traversable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#is-closing": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"is closing","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#is-closing"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document": {"export":true,"for_":["navigable"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"active document","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"navigable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"node navigable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"top-level traversable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"traversable navigable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"iframe","type":"element","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element"},
"https://html.spec.whatwg.org/multipage/interaction.html#activation-notification": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"activation notification","type":"dfn","url":"https://html.spec.whatwg.org/multipage/interaction.html#activation-notification"},
"https://html.spec.whatwg.org/multipage/links.html#hyperlink": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"hyperlink","type":"dfn","url":"https://html.spec.whatwg.org/multipage/links.html#hyperlink"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"associated document","type":"dfn","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"location","type":"attribute","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location"},
"https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv": {"export":true,"for_":["meta"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"http-equiv","type":"element-attr","url":"https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv"},
"https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh": {"export":true,"for_":["meta/http-equiv"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"refresh","type":"attr-value","url":"https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh"},
"https://html.spec.whatwg.org/multipage/semantics.html#meta": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"meta","type":"element","url":"https://html.spec.whatwg.org/multipage/semantics.html#meta"},
"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"run steps after a timeout","type":"dfn","url":"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context": {"export":true,"for_":["environment"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"target browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin": {"export":true,"for_":["environment"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"top-level origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"},
"https://html.spec.whatwg.org/multipage/webappapis.html#environment": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"environment","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment"},
"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"environment settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#global-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#global-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"networking task source","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a global task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"},
"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"realm execution context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context"},
"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"},
"https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage": {"export":true,"for_":["WindowLocalStorage"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"localStorage","type":"attribute","url":"https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage"},
"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set": {"export":true,"for_":["WorkerGlobalScope"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"owner set","type":"dfn","url":"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"},
"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"DedicatedWorkerGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope"},
"https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"SharedWorkerGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope"},
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WorkerGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope"},
"https://httpwg.org/specs/rfc7231.html#status.3xx": {"export":true,"for_":[],"level":"","normative":true,"shortname":"http","spec":"http","status":"anchor-block","text":"http 3xx statuses","type":"dfn","url":"https://httpwg.org/specs/rfc7231.html#status.3xx"},
"https://infra.spec.whatwg.org/#assert": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"assert","type":"dfn","url":"https://infra.spec.whatwg.org/#assert"},
"https://infra.spec.whatwg.org/#implementation-defined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"implementation-defined","type":"dfn","url":"https://infra.spec.whatwg.org/#implementation-defined"},
"https://infra.spec.whatwg.org/#iteration-continue": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"continue","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-continue"},
"https://infra.spec.whatwg.org/#iteration-while": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"while","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-while"},
"https://infra.spec.whatwg.org/#list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#list-contain": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#list-contain"},
"https://infra.spec.whatwg.org/#list-empty": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"empty","type":"dfn","url":"https://infra.spec.whatwg.org/#list-empty"},
"https://infra.spec.whatwg.org/#list-iterate": {"export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"for each","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://infra.spec.whatwg.org/#map-exists": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#map-iterate": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"for each","type":"dfn","url":"https://infra.spec.whatwg.org/#map-iterate"},
"https://infra.spec.whatwg.org/#map-remove": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"remove","type":"dfn","url":"https://infra.spec.whatwg.org/#map-remove"},
"https://infra.spec.whatwg.org/#ordered-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#ordered-set": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-set"},
"https://infra.spec.whatwg.org/#queue": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"queue","type":"dfn","url":"https://infra.spec.whatwg.org/#queue"},
"https://infra.spec.whatwg.org/#queue-dequeue": {"export":true,"for_":["queue"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"dequeue","type":"dfn","url":"https://infra.spec.whatwg.org/#queue-dequeue"},
"https://infra.spec.whatwg.org/#queue-enqueue": {"export":true,"for_":["queue"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"enqueue","type":"dfn","url":"https://infra.spec.whatwg.org/#queue-enqueue"},
"https://infra.spec.whatwg.org/#set-append": {"export":true,"for_":["set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#set-append"},
"https://infra.spec.whatwg.org/#struct": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"struct","type":"dfn","url":"https://infra.spec.whatwg.org/#struct"},
"https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"storage","spec":"storage","status":"current","text":"obtain a storage bottle map","type":"dfn","url":"https://storage.spec.whatwg.org/#obtain-a-storage-bottle-map"},
"https://storage.spec.whatwg.org/#storage-key": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"storage","spec":"storage","status":"current","text":"storage key","type":"dfn","url":"https://storage.spec.whatwg.org/#storage-key"},
"https://storage.spec.whatwg.org/#storage-key-origin": {"export":false,"for_":["storage key"],"level":"1","normative":true,"shortname":"storage","spec":"storage","status":"current","text":"origin","type":"dfn","url":"https://storage.spec.whatwg.org/#storage-key-origin"},
"https://storage.spec.whatwg.org/#storage-shed": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"storage","spec":"storage","status":"current","text":"storage shed","type":"dfn","url":"https://storage.spec.whatwg.org/#storage-shed"},
"https://tools.ietf.org/html/rfc6265/#section-5.1.3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6265","spec":"rfc6265","status":"anchor-block","text":"domain-match","type":"dfn","url":"https://tools.ietf.org/html/rfc6265/#section-5.1.3"},
"https://tools.ietf.org/html/rfc6265/#section-5.2.3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6265","spec":"rfc6265","status":"anchor-block","text":"domain attribute","type":"dfn","url":"https://tools.ietf.org/html/rfc6265/#section-5.2.3"},
"https://tools.ietf.org/html/rfc6265/#section-5.3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6265","spec":"rfc6265","status":"anchor-block","text":"cookie store","type":"dfn","url":"https://tools.ietf.org/html/rfc6265/#section-5.3"},
"https://tools.ietf.org/html/rfc9111/#section-2": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9111","spec":"rfc9111","status":"anchor-block","text":"network cache","type":"dfn","url":"https://tools.ietf.org/html/rfc9111/#section-2"},
"https://url.spec.whatwg.org/#concept-host": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"host","type":"dfn","url":"https://url.spec.whatwg.org/#concept-host"},
"https://url.spec.whatwg.org/#concept-host-equals": {"export":true,"for_":["host"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"equal","type":"dfn","url":"https://url.spec.whatwg.org/#concept-host-equals"},
"https://url.spec.whatwg.org/#concept-url": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url"},
"https://url.spec.whatwg.org/#empty-host": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"empty host","type":"dfn","url":"https://url.spec.whatwg.org/#empty-host"},
"https://url.spec.whatwg.org/#host-registrable-domain": {"export":true,"for_":["host"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"registrable domain","type":"dfn","url":"https://url.spec.whatwg.org/#host-registrable-domain"},
"https://w3c.github.io/ServiceWorker/#dfn-service-worker": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"service-workers","spec":"service-workers","status":"current","text":"service worker","type":"dfn","url":"https://w3c.github.io/ServiceWorker/#dfn-service-worker"},
"https://w3c.github.io/ServiceWorker/#handle-fetch": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"service-workers","spec":"service-workers","status":"current","text":"handle fetch","type":"dfn","url":"https://w3c.github.io/ServiceWorker/#handle-fetch"},
"https://w3c.github.io/hr-time/#dfn-duration": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"duration","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-duration"},
"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time": {"export":true,"for_":["environment settings object"],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"current wall time","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time"},
"https://w3c.github.io/hr-time/#dfn-moment": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"moment","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-moment"},
"https://w3c.github.io/hr-time/#dfn-wall-clock": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"wall clock","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-wall-clock"},
"https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time": {"export":true,"for_":["wall clock"],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"unsafe current time","type":"dfn","url":"https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time"},
"https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot": {"export":true,"for_":["PublicKeyCredential"],"level":"3","normative":true,"shortname":"webauthn","spec":"webauthn-3","status":"current","text":"[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)","type":"method","url":"https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot"},
"https://w3c.github.io/webauthn/#publickeycredential": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"webauthn","spec":"webauthn-3","status":"current","text":"PublicKeyCredential","type":"interface","url":"https://w3c.github.io/webauthn/#publickeycredential"},
"https://w3c.github.io/webdriver/#dfn-error": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"webdriver","spec":"webdriver2","status":"current","text":"error","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-error"},
"https://w3c.github.io/webdriver/#dfn-error-code": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"error code","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-error-code"},
"https://w3c.github.io/webdriver/#dfn-remote-end-steps": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"webdriver","spec":"webdriver2","status":"current","text":"remote end steps","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-remote-end-steps"},
"https://w3c.github.io/webdriver/#dfn-success": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"webdriver","spec":"webdriver2","status":"current","text":"success","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-success"},
"https://w3c.github.io/webdriver/#dfn-unknown-error": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"unknown error","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-unknown-error"},
"https://w3c.github.io/webdriver/#dfn-unsupported-operation": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"unsupported operation","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-unsupported-operation"},
"https://www.w3.org/TR/tracking-dnt/#dfn-tracking": {"export":true,"for_":[],"level":"","normative":true,"shortname":"tracking-dnt","spec":"tracking-dnt","status":"anchor-block","text":"tracking","type":"dfn","url":"https://www.w3.org/TR/tracking-dnt/#dfn-tracking"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>